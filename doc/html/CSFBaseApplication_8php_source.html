<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>&quot;The Yii Extension Library Of Doom!&quot;: /usr/local/yiixl/lib/original/components/snowframe/base/CSFBaseApplication.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>/usr/local/yiixl/lib/original/components/snowframe/base/CSFBaseApplication.php</h1>  </div>
</div>
<div class="contents">
<a href="CSFBaseApplication_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00024"></a><a class="code" href="classCSFBaseApplication.html">00024</a> <span class="keyword">class </span><a class="code" href="classCSFBaseApplication.html">CSFBaseApplication</a> <span class="keyword">extends</span> <a class="code" href="classCPSApiComponent.html">CPSApiComponent</a>
<a name="l00025"></a>00025 {
<a name="l00026"></a>00026     <span class="comment">//********************************************************************************</span>
<a name="l00027"></a>00027     <span class="comment">//* Public Methods</span>
<a name="l00028"></a>00028     <span class="comment">//********************************************************************************</span>
<a name="l00029"></a>00029     
<a name="l00033"></a><a class="code" href="classCSFBaseApplication.html#a2dc262e99b1c246b56f27626bfe699ff">00033</a>     <span class="keyword">public</span> function <a class="code" href="classCSFBaseApplication.html#a2dc262e99b1c246b56f27626bfe699ff">preinit</a>()
<a name="l00034"></a>00034     {
<a name="l00035"></a>00035         <a class="code" href="classCSFBaseApplication.html#a2dc262e99b1c246b56f27626bfe699ff">parent::preinit</a>();
<a name="l00036"></a>00036         $this-&gt;addOptions( self::getBaseOptions() );
<a name="l00037"></a>00037     }
<a name="l00038"></a>00038     
<a name="l00043"></a>00043     <span class="keyword">private</span> function getBaseOptions()
<a name="l00044"></a>00044     {
<a name="l00045"></a>00045         <span class="keywordflow">return</span> <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00046"></a>00046             <span class="stringliteral">&#39;appId&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00047"></a>00047             <span class="stringliteral">&#39;appProfileId&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00048"></a>00048             <span class="stringliteral">&#39;appName&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00049"></a>00049             <span class="stringliteral">&#39;appPage&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00050"></a>00050             <span class="stringliteral">&#39;appUrl&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00051"></a>00051             <span class="stringliteral">&#39;appName&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00052"></a>00052             <span class="stringliteral">&#39;callbackUrl&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00053"></a>00053             <span class="stringliteral">&#39;pfTypeCode&#39;</span> =&gt; <span class="stringliteral">&#39;int&#39;</span>,
<a name="l00054"></a>00054             <span class="stringliteral">&#39;pfApi&#39;</span> =&gt; <span class="stringliteral">&#39;object&#39;</span>,
<a name="l00055"></a>00055             <span class="stringliteral">&#39;enableSonetrix&#39;</span> =&gt; <span class="stringliteral">&#39;bool:true&#39;</span>,
<a name="l00056"></a>00056             <span class="stringliteral">&#39;sonetrix&#39;</span> =&gt; <span class="stringliteral">&#39;object&#39;</span>,
<a name="l00057"></a>00057             <span class="stringliteral">&#39;currentUser&#39;</span> =&gt; <span class="stringliteral">&#39;object&#39;</span>,
<a name="l00058"></a>00058             <span class="stringliteral">&#39;pfUserId&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00059"></a>00059             <span class="stringliteral">&#39;pfRefUserId&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00060"></a>00060             <span class="stringliteral">&#39;banners&#39;</span> =&gt; <span class="stringliteral">&#39;array:array()&#39;</span>,
<a name="l00061"></a>00061             <span class="stringliteral">&#39;invitePlacement&#39;</span> =&gt; <span class="stringliteral">&#39;int:&#39;</span> . <a class="code" href="classSF.html#a784e119a8dc4eba2b5560832e8b737f0">SF::IP_AFTER_ADD</a>,
<a name="l00062"></a>00062             <span class="stringliteral">&#39;pageAction&#39;</span> =&gt; <span class="stringliteral">&#39;string:home&#39;</span>,
<a name="l00063"></a>00063             <span class="stringliteral">&#39;pageCommand&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00064"></a>00064             <span class="stringliteral">&#39;googleAnalyticsKey&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00065"></a>00065             <span class="stringliteral">&#39;serverUrl&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00066"></a>00066             <span class="stringliteral">&#39;dbUserClassName&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00067"></a>00067             <span class="stringliteral">&#39;clientIPAddress&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00068"></a>00068             <span class="stringliteral">&#39;httpReferrer&#39;</span> =&gt; <span class="stringliteral">&#39;string&#39;</span>,
<a name="l00069"></a>00069         );
<a name="l00070"></a>00070     }
<a name="l00071"></a>00071 
<a name="l00075"></a><a class="code" href="classCSFBaseApplication.html#a4be4055f3361d4800e16bc2e2e38cda6">00075</a>     <span class="keyword">public</span> function <a class="code" href="classCSFBaseApplication.html#a4be4055f3361d4800e16bc2e2e38cda6">init</a>()
<a name="l00076"></a>00076     {
<a name="l00077"></a>00077         <a class="code" href="classCSFBaseApplication.html#a4be4055f3361d4800e16bc2e2e38cda6">parent::init</a>();
<a name="l00078"></a>00078         
<a name="l00079"></a>00079         <span class="comment">//  Construct a platform specific object</span>
<a name="l00080"></a>00080         $this-&gt;<a class="code" href="classCSFBaseApplication.html#a96b0f4bab679378904506e1a106c4e60">initializePlatform</a>();
<a name="l00081"></a>00081 
<a name="l00082"></a>00082         <span class="comment">//  Create a new Sonetrix object...</span>
<a name="l00083"></a>00083         <span class="keywordflow">if</span> ( $this-&gt;m_bEnableSonetrix )
<a name="l00084"></a>00084         {
<a name="l00085"></a>00085             $this-&gt;sonetrix = <span class="keyword">new</span> Sonetrix( $sAppId, $iPTC, null, null, ( $iPTC == <a class="code" href="classSF.html#a9e8fafa39429831b857bb06424d74dae">SF::PT_FACEBOOK</a> &amp;&amp; $this-&gt;pfApi-&gt;PFAPI ? $this-&gt;pfApi-&gt;PFAPI : null ), $sProfileId );
<a name="l00086"></a>00086             <span class="keywordflow">if</span> ( $this-&gt;sonetrix &amp;&amp; $this-&gt;pfApi ) $this-&gt;pfApi-&gt;Sonetrix = $this-&gt;sonetrix;
<a name="l00087"></a>00087         }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="comment">//  Process the query string...</span>
<a name="l00090"></a>00090         $this-&gt;<a class="code" href="classCSFBaseApplication.html#aa40909289ffd00ccc071d938f586fc47">processQueryString</a>();
<a name="l00091"></a>00091     }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <span class="comment">/***</span>
<a name="l00094"></a>00094 <span class="comment">    * Initialize the platform api</span>
<a name="l00095"></a>00095 <span class="comment">    */</span>
<a name="l00096"></a><a class="code" href="classCSFBaseApplication.html#a96b0f4bab679378904506e1a106c4e60">00096</a>     <span class="keyword">public</span> function <a class="code" href="classCSFBaseApplication.html#a96b0f4bab679378904506e1a106c4e60">initializePlatform</a>()
<a name="l00097"></a>00097     {
<a name="l00098"></a>00098         <span class="keywordflow">switch</span> ( $this-&gt;pfTypeCode )
<a name="l00099"></a>00099         {
<a name="l00100"></a>00100             <span class="keywordflow">case</span> <a class="code" href="classSF.html#a68ee53bd9120191897b1bbf694e1312c">SF::PT_FRIENDSTER</a>:
<a name="l00101"></a>00101             <span class="keywordflow">case</span> <a class="code" href="classSF.html#a78190e4161de1deb7e2928e801539df5">SF::PT_MYSPACE</a>:
<a name="l00102"></a>00102                 <span class="keywordflow">break</span>;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104             <span class="keywordflow">case</span> <a class="code" href="classSF.html#a9e8fafa39429831b857bb06424d74dae">SF::PT_FACEBOOK</a>:
<a name="l00105"></a>00105                 $this-&gt;pfApi = <span class="keyword">new</span> CSFFacebookPlatform( $sBaseUrl, $sAppName, $sAppId, $sAPIKey, $sAPISecret );
<a name="l00106"></a>00106                 <span class="keywordflow">break</span>;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108             <span class="keywordflow">case</span> <a class="code" href="classSF.html#a44c3e775e3f80d5b3fa3e1d745705126">SF::PT_BEBO</a>:
<a name="l00109"></a>00109                 $this-&gt;pfApi = <span class="keyword">new</span> CSFBeboPlatform( $sBaseUrl, $sAppName, $sAppId, $sAPIKey, $sAPISecret, $sProfileId );
<a name="l00110"></a>00110                 <span class="keywordflow">break</span>;
<a name="l00111"></a>00111         }
<a name="l00112"></a>00112         
<a name="l00113"></a>00113         <span class="keywordflow">if</span> ( ! $this-&gt;pfApi )
<a name="l00114"></a>00114             <span class="keywordflow">throw</span> <span class="keyword">new</span> CException( <span class="stringliteral">&#39;Invalid, unsupported, or no platform type selected.&#39;</span> );
<a name="l00115"></a>00115     }
<a name="l00116"></a>00116 
<a name="l00120"></a><a class="code" href="classCSFBaseApplication.html#aa40909289ffd00ccc071d938f586fc47">00120</a>     <span class="keyword">protected</span> function <a class="code" href="classCSFBaseApplication.html#aa40909289ffd00ccc071d938f586fc47">processQueryString</a>()
<a name="l00121"></a>00121     {
<a name="l00122"></a>00122         $this-&gt;httpReferrer = PS::o( $_SERVER, <span class="stringliteral">&#39;HTTP_REFERER&#39;</span> );
<a name="l00123"></a>00123         $this-&gt;clientIPAddress = PS::o( $_SERVER, <span class="stringliteral">&#39;REMOTE_ADDR&#39;</span> );
<a name="l00124"></a>00124         $this-&gt;pageAction = PS::o( $_REQUEST, <span class="stringliteral">&#39;action&#39;</span> );
<a name="l00125"></a>00125         $this-&gt;pageSubAction = PS::o( $_REQUEST, <span class="stringliteral">&#39;sa&#39;</span> );
<a name="l00126"></a>00126 
<a name="l00127"></a>00127         <span class="keywordflow">if</span> ( null !== ( $_sCmd = PS::o( $_REQUEST, <span class="charliteral">&#39;c&#39;</span>, null, <span class="keyword">true</span> ) ) )
<a name="l00128"></a>00128             $this-&gt;<a class="code" href="classCSFBaseApplication.html#aed904ee937df5c26c42b9995d2e3a69b">processApplicationCommand</a>( $_sCmd );
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130 
<a name="l00135"></a><a class="code" href="classCSFBaseApplication.html#aed904ee937df5c26c42b9995d2e3a69b">00135</a>     <span class="keyword">protected</span> function <a class="code" href="classCSFBaseApplication.html#aed904ee937df5c26c42b9995d2e3a69b">processApplicationCommand</a>( $sCommand = null )
<a name="l00136"></a>00136     {
<a name="l00137"></a>00137         $this-&gt;pageCommand = trim( PS::nvl( $sCommand, $this-&gt;pageCommand ) );
<a name="l00138"></a>00138 
<a name="l00139"></a>00139         <span class="comment">//  Deal with screwy facebook bug where they don&#39;t parse url properly</span>
<a name="l00140"></a>00140         <span class="keywordflow">if</span> ( substr( $this-&gt;pageCommand, 0, 7 ) == <span class="stringliteral">&#39;addhttp&#39;</span> )
<a name="l00141"></a>00141         {
<a name="l00142"></a>00142             $_sUrl = substr( $this-&gt;pageCommand, 3 );
<a name="l00143"></a>00143             $this-&gt;<a class="code" href="classCSFBaseApplication.html#a83d6db3f4e5f36ddd8adad2f53133e76">redirect</a>( $this-&gt;pfApi-&gt;appUrl . <span class="stringliteral">&#39;?c=add&amp;auth_token=&#39;</span> . $_REQUEST[<span class="stringliteral">&#39;auth_token&#39;</span>] . <span class="stringliteral">&#39;&amp;installed=1&amp;refuid=&#39;</span> . ( isset( $_REQUEST[<span class="stringliteral">&#39;refuid&#39;</span>] ) ? $_REQUEST[<span class="stringliteral">&#39;refuid&#39;</span>] : <span class="stringliteral">&#39;&#39;</span> ) );
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146         <span class="keywordflow">switch</span> ( $this-&gt;pageCommand )
<a name="l00147"></a>00147         {
<a name="l00148"></a>00148             <span class="keywordflow">case</span> <span class="stringliteral">&#39;ping&#39;</span>:
<a name="l00149"></a>00149                 echo <span class="stringliteral">&#39;pong&#39;</span>;
<a name="l00150"></a>00150                 <span class="keywordflow">break</span>;
<a name="l00151"></a>00151                 
<a name="l00152"></a>00152             <span class="keywordflow">case</span> <span class="stringliteral">&#39;del&#39;</span>:
<a name="l00153"></a>00153                 <span class="keywordflow">if</span> ( $this-&gt;currentUser )
<a name="l00154"></a>00154                     $this-&gt;currentUser-&gt;remove();
<a name="l00155"></a>00155                 <span class="keywordflow">break</span>;
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157         
<a name="l00158"></a>00158         <span class="comment">//  Stop execution here.</span>
<a name="l00159"></a>00159         exit;
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161 
<a name="l00166"></a><a class="code" href="classCSFBaseApplication.html#a71fa3ba915a284747b787ab0d94869ce">00166</a>     <span class="keyword">public</span> function <a class="code" href="classCSFBaseApplication.html#a71fa3ba915a284747b787ab0d94869ce">capturePageView</a>( $sPage )
<a name="l00167"></a>00167     {
<a name="l00168"></a>00168         <span class="keywordflow">if</span> ( $this-&gt;sonetrix )
<a name="l00169"></a>00169             $this-&gt;sonetrix-&gt;user_pageView( $this-&gt;PFUserId, $sPage );
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171 
<a name="l00176"></a><a class="code" href="classCSFBaseApplication.html#a6deb2041e7ee4cbb3511c0f5a7ea8a03">00176</a>     <span class="keyword">public</span> function <a class="code" href="classCSFBaseApplication.html#a6deb2041e7ee4cbb3511c0f5a7ea8a03">inviteRedirect</a>()
<a name="l00177"></a>00177     {
<a name="l00178"></a>00178         <span class="keywordflow">if</span> ( $this-&gt;m_eInvitePlacement == SF_InvitePlacement::AfterAdd &amp;&amp; isset( $_REQUEST[<span class="stringliteral">&#39;installed&#39;</span>] ) &amp;&amp; $_REQUEST[<span class="stringliteral">&#39;installed&#39;</span>] == <span class="charliteral">&#39;1&#39;</span> )
<a name="l00179"></a>00179         {
<a name="l00180"></a>00180             <span class="comment">//  No user database? Ping sonetrix with addition</span>
<a name="l00181"></a>00181             <span class="keywordflow">if</span> ( ! $this-&gt;UserDB &amp;&amp; $this-&gt;sonetrix )
<a name="l00182"></a>00182                 $this-&gt;sonetrix-&gt;setHashUID( $this-&gt;sonetrix-&gt;user_install( $this-&gt;pfApi-&gt;PFUserId, $this-&gt;pfApi-&gt;getSessionKey() ) );
<a name="l00183"></a>00183 
<a name="l00184"></a>00184             $this-&gt;<a class="code" href="classCSFBaseApplication.html#a83d6db3f4e5f36ddd8adad2f53133e76">redirect</a>( $this-&gt;pfApi-&gt;AppUrl . <span class="stringliteral">&quot;invite.php&quot;</span> );
<a name="l00185"></a>00185         }
<a name="l00186"></a>00186     }
<a name="l00187"></a>00187 
<a name="l00188"></a>00188     <span class="comment">/***</span>
<a name="l00189"></a>00189 <span class="comment">    *@desc generic redirect</span>
<a name="l00190"></a>00190 <span class="comment">    */</span>
<a name="l00191"></a><a class="code" href="classCSFBaseApplication.html#a83d6db3f4e5f36ddd8adad2f53133e76">00191</a>     <span class="keyword">public</span> function <a class="code" href="classCSFBaseApplication.html#a83d6db3f4e5f36ddd8adad2f53133e76">redirect</a>( $sUrl )
<a name="l00192"></a>00192     {
<a name="l00193"></a>00193         $this-&gt;pfApi-&gt;redirect( $sUrl );
<a name="l00194"></a>00194     }
<a name="l00195"></a>00195 
<a name="l00201"></a><a class="code" href="classCSFBaseApplication.html#acf7865241ab5ac45a0f04674efe51d1a">00201</a>     <span class="keyword">public</span> function <a class="code" href="classCSFBaseApplication.html#acf7865241ab5ac45a0f04674efe51d1a">getInviteeList</a>()
<a name="l00202"></a>00202     {
<a name="l00203"></a>00203         <span class="keywordflow">if</span> ( $this-&gt;m_bEnableSonetrix &amp;&amp; $this-&gt;sonetrix )
<a name="l00204"></a>00204             <span class="keywordflow">return</span>( $this-&gt;sonetrix-&gt;user_getInvitees( $this-&gt;PFUserId ) );
<a name="l00205"></a>00205     }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     <span class="comment">/***</span>
<a name="l00208"></a>00208 <span class="comment">    *@desc Adds an ad vendor to the application</span>
<a name="l00209"></a>00209 <span class="comment">    */</span>
<a name="l00210"></a><a class="code" href="classCSFBaseApplication.html#af12c69561c23be5e6fc7e4e0a2808fbb">00210</a>     <span class="keyword">public</span> function <a class="code" href="classCSFBaseApplication.html#af12c69561c23be5e6fc7e4e0a2808fbb">addAdVendor</a>( $iAVC, $sIds )
<a name="l00211"></a>00211     {
<a name="l00212"></a>00212         $this-&gt;m_arBanner[ $iAVC ] = <span class="keyword">new</span> SF_BannerAd( $iAVC, explode(<span class="charliteral">&#39;,&#39;</span>,$sIds) );
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215     <span class="comment">/***</span>
<a name="l00216"></a>00216 <span class="comment">    * @desc Set ref urls for an app</span>
<a name="l00217"></a>00217 <span class="comment">    */</span>
<a name="l00218"></a><a class="code" href="classCSFBaseApplication.html#a3978cc0d9152ece4cd315601a95a38bd">00218</a>     <span class="keyword">public</span> function <a class="code" href="classCSFBaseApplication.html#a3978cc0d9152ece4cd315601a95a38bd">setRefHandle</a>( $sFBML )
<a name="l00219"></a>00219     {
<a name="l00220"></a>00220         $this-&gt;pfApi-&gt;setRefHandle( $sFBML );
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222 
<a name="l00228"></a><a class="code" href="classCSFBaseApplication.html#a99e97980251298d31efe3451470e8df5">00228</a>     <span class="keyword">public</span> function <a class="code" href="classCSFBaseApplication.html#a99e97980251298d31efe3451470e8df5">getAdCode</a>( $iAVC = null, $eType = SF_AdType::Banner )
<a name="l00229"></a>00229     {
<a name="l00230"></a>00230         $sOut = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232         <span class="keywordflow">if</span> ( isset( $this-&gt;m_arBanner[ $iAVC ] ) )
<a name="l00233"></a>00233             $sOut = $this-&gt;m_arBanner[ $iAVC ]-&gt;getAdCode( $this-&gt;pfApi-&gt;getPFType(), $eType );
<a name="l00234"></a>00234         <span class="keywordflow">else</span>
<a name="l00235"></a>00235         {
<a name="l00236"></a>00236             <span class="keywordflow">foreach</span> ( $this-&gt;m_arBanner as $sKey =&gt; $oValue )
<a name="l00237"></a>00237                 $sOut = $oValue-&gt;getAdCode( $this-&gt;pfApi-&gt;getPFType(), $eType );
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         <span class="keywordflow">return</span>( $sOut );
<a name="l00241"></a>00241     }
<a name="l00242"></a>00242     
<a name="l00243"></a><a class="code" href="classCSFBaseApplication.html#ac409888924f803214fbd2df44327242b">00243</a>     <span class="keyword">public</span> function <a class="code" href="classCSFBaseApplication.html#ac409888924f803214fbd2df44327242b">publishTemplate</a>( $sBundleId = null, &amp;$arBundleData = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(), $arTargetIds = null )
<a name="l00244"></a>00244     {
<a name="l00245"></a>00245         $_sBundleId = $sBundleId;
<a name="l00246"></a>00246         $_sAppUrl = $this-&gt;PFAPI-&gt;AppUrl;
<a name="l00247"></a>00247         
<a name="l00248"></a>00248         <span class="keywordflow">try</span>
<a name="l00249"></a>00249         {
<a name="l00250"></a>00250             <span class="comment">//  See if we can get the bundle id for this app...</span>
<a name="l00251"></a>00251             <span class="keywordflow">if</span> ( $sBundleId == null )
<a name="l00252"></a>00252             {
<a name="l00253"></a>00253                 <span class="keywordflow">if</span> ( $arBundle = $this-&gt;PFAPI-&gt;getRegisteredBundles() )
<a name="l00254"></a>00254                 {
<a name="l00255"></a>00255                     <span class="comment">//  Get the bundle id...</span>
<a name="l00256"></a>00256                     $_sBundleId = isset( $arBundle, $arBundle[ 0 ], $arBundle[ 0 ][ <span class="stringliteral">&#39;template_bundle_id&#39;</span> ] ) ? $arBundle[0][<span class="stringliteral">&#39;template_bundle_id&#39;</span>] : null;
<a name="l00257"></a>00257                     error_log( <span class="stringliteral">&#39;Found registered bundle id &#39;</span> . $_sBundleId . <span class="stringliteral">&#39; for app [&#39;</span> . $this-&gt;getQuizName() . <span class="charliteral">&#39;]&#39;</span> );
<a name="l00258"></a>00258                 }
<a name="l00259"></a>00259                 <span class="keywordflow">else</span>
<a name="l00260"></a>00260                 {
<a name="l00261"></a>00261                     <span class="comment">//  Create a default quiz bundle...</span>
<a name="l00262"></a>00262                     $arOneLine = $arShort = $arAction = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>();
<a name="l00263"></a>00263                     $arOneLine[] = <span class="stringliteral">&#39;{*actor*} just took the {*quiz_name*} quiz and the result was {*quiz_result_name*}.&#39;</span>;
<a name="l00264"></a>00264                     
<a name="l00265"></a>00265                     $arShort[] = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( 
<a name="l00266"></a>00266                         <span class="stringliteral">&#39;template_title&#39;</span> =&gt; <span class="stringliteral">&#39;{*actor*} just took the {*quiz_name*} quiz and the result was {*quiz_result_name*}.&#39;</span>,
<a name="l00267"></a>00267                         <span class="stringliteral">&#39;template_body&#39;</span> =&gt; <span class="stringliteral">&#39;{*quiz_result_full*}&#39;</span>,
<a name="l00268"></a>00268                     );
<a name="l00269"></a>00269             
<a name="l00270"></a>00270                     $arAction[] = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( <span class="stringliteral">&#39;text&#39;</span> =&gt; <span class="stringliteral">&#39;Take the quiz!&#39;</span>, <span class="stringliteral">&#39;href&#39;</span> =&gt; $this-&gt;PFAPI-&gt;AppUrl );
<a name="l00271"></a>00271                     <span class="keywordflow">if</span> ( $this-&gt;m_sFanPageUrl ) $arAction[] = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( <span class="stringliteral">&#39;text&#39;</span> =&gt; <span class="stringliteral">&#39;Become a fan!&#39;</span>, <span class="stringliteral">&#39;href&#39;</span> =&gt; $this-&gt;m_sFanPageUrl );
<a name="l00272"></a>00272                     
<a name="l00273"></a>00273                     $_sBundleId = $this-&gt;PFAPI-&gt;registerBundle( $arOneLine, $arShort, null, $arLinks );
<a name="l00274"></a>00274                     error_log( <span class="stringliteral">&#39;Registered bundle id &#39;</span> . $_sBundleId . <span class="stringliteral">&#39; for app [&#39;</span> . $this-&gt;getQuizName() . <span class="charliteral">&#39;]&#39;</span> );
<a name="l00275"></a>00275                 }
<a name="l00276"></a>00276             }
<a name="l00277"></a>00277             
<a name="l00278"></a>00278             <span class="comment">//  Do we have a bundle to publish?</span>
<a name="l00279"></a>00279             <span class="keywordflow">if</span> ( $_sBundleId )
<a name="l00280"></a>00280             {
<a name="l00281"></a>00281                 <span class="comment">//  Create array...</span>
<a name="l00282"></a>00282                 <span class="keywordflow">if</span> ( ! <span class="keyword">sizeof</span>( $arBundleData ) )
<a name="l00283"></a>00283                 {
<a name="l00284"></a>00284                     $arBundleData = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00285"></a>00285                         <span class="stringliteral">&#39;quiz_name&#39;</span> =&gt; <span class="stringliteral">&quot;&amp;quot;&lt;a href=\&quot;{$_sAppUrl}\&quot;&gt;{$this-&gt;m_sQuizName}&lt;/a&gt;&amp;quot;&quot;</span>,
<a name="l00286"></a>00286                         <span class="stringliteral">&#39;quiz_result_name&#39;</span> =&gt; <span class="stringliteral">&quot;&amp;quot;&lt;a href=\&quot;{$_sAppUrl}\&quot;&gt;{$this-&gt;m_oResult-&gt;FullName}&lt;/a&gt;&amp;quot;&quot;</span>,
<a name="l00287"></a>00287                         <span class="stringliteral">&#39;quiz_result_full&#39;</span> =&gt; $this-&gt;m_oResult-&gt;Description . <span class="stringliteral">&quot;&lt;br /&gt;&lt;br /&gt;&lt;a href=\&quot;{$_sAppUrl}\&quot;&gt;Why not take the quiz yourself?&lt;/a&gt;&quot;</span>,
<a name="l00288"></a>00288                         <span class="stringliteral">&#39;images&#39;</span> =&gt; <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( <span class="stringliteral">&#39;src&#39;</span> =&gt; $this-&gt;m_oResult-&gt;ImageUrl, <span class="stringliteral">&#39;href&#39;</span> =&gt; $_sAppUrl ) ),
<a name="l00289"></a>00289                     );
<a name="l00290"></a>00290                 }
<a name="l00291"></a>00291                     
<a name="l00292"></a>00292                 <span class="comment">//  Publish action to feed...</span>
<a name="l00293"></a>00293                 $sResult = $this-&gt;PFAPI-&gt;publishBundle( $_sBundleId, $arBundleData, $arTargetIds, null, 2 );
<a name="l00294"></a>00294             }
<a name="l00295"></a>00295         }
<a name="l00296"></a>00296         <span class="keywordflow">catch</span> ( Exception $_ex )
<a name="l00297"></a>00297         {
<a name="l00298"></a>00298             error_log( <span class="stringliteral">&#39;Error publishing bundle id &#39;</span> . $_sBundleId . <span class="stringliteral">&#39;: &#39;</span> . $_ex-&gt;getMessage() );
<a name="l00299"></a>00299         }
<a name="l00300"></a>00300     }
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Mar 24 2011 20:11:38 for "The Yii Extension Library Of Doom!" by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
