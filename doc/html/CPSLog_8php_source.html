<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>&quot;The Yii Extension Library Of Doom!&quot;: /usr/local/yiixl/lib/original/helpers/CPSLog.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>/usr/local/yiixl/lib/original/helpers/CPSLog.php</h1>  </div>
</div>
<div class="contents">
<a href="CPSLog_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00022"></a><a class="code" href="classCPSLog.html">00022</a> <span class="keyword">class </span><a class="code" href="classCPSLog.html">CPSLog</a> <span class="keyword">implements</span> <a class="code" href="interfaceIPSBase.html">IPSBase</a>
<a name="l00023"></a>00023 {
<a name="l00024"></a>00024     <span class="comment">//********************************************************************************</span>
<a name="l00025"></a>00025     <span class="comment">//* Private Members</span>
<a name="l00026"></a>00026     <span class="comment">//********************************************************************************</span>
<a name="l00027"></a>00027 
<a name="l00031"></a><a class="code" href="classCPSLog.html#aba01bbea42407ae9944e5b1247efeab2">00031</a>     <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classCPSLog.html#aba01bbea42407ae9944e5b1247efeab2">$echoData</a> = <span class="keyword">false</span>;
<a name="l00032"></a>00032 
<a name="l00036"></a><a class="code" href="classCPSLog.html#a09e8cf95b9d29955a0bfabca9b420edc">00036</a>     <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classCPSLog.html#a09e8cf95b9d29955a0bfabca9b420edc">$prefix</a> = null;
<a name="l00037"></a>00037 
<a name="l00041"></a><a class="code" href="classCPSLog.html#a0e25dd3694766f9fb978bfc87d179189">00041</a>     <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classCPSLog.html#a0e25dd3694766f9fb978bfc87d179189">$baseLevel</a> = 2;
<a name="l00042"></a>00042 
<a name="l00046"></a><a class="code" href="classCPSLog.html#ac08dfa5d5e776a071386c5aab064d0b2">00046</a>     <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classCPSLog.html#ac08dfa5d5e776a071386c5aab064d0b2">$currentIndent</a> = 0;
<a name="l00047"></a>00047 
<a name="l00048"></a><a class="code" href="classCPSLog.html#ab5b4a8d574b06602e254fdbaafc83abf">00048</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="classCPSLog.html#ab5b4a8d574b06602e254fdbaafc83abf">$_defaultLevelIndicator</a> = <span class="charliteral">&#39;.&#39;</span>;
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="classCPSLog.html#aa2c4cac0489591ad601a302dcc6c57fb">00050</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="classCPSLog.html#aa2c4cac0489591ad601a302dcc6c57fb">$_levelIndicators</a> = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00051"></a>00051         <span class="stringliteral">&#39;info&#39;</span> =&gt; <span class="charliteral">&#39;*&#39;</span>,
<a name="l00052"></a>00052         <span class="stringliteral">&#39;notice&#39;</span> =&gt; <span class="charliteral">&#39;?&#39;</span>,
<a name="l00053"></a>00053         <span class="stringliteral">&#39;warning&#39;</span> =&gt; <span class="charliteral">&#39;-&#39;</span>,
<a name="l00054"></a>00054         <span class="stringliteral">&#39;error&#39;</span> =&gt; <span class="charliteral">&#39;!&#39;</span>,
<a name="l00055"></a>00055     );
<a name="l00056"></a>00056 
<a name="l00057"></a>00057     <span class="comment">//********************************************************************************</span>
<a name="l00058"></a>00058     <span class="comment">//* Public Methods</span>
<a name="l00059"></a>00059     <span class="comment">//********************************************************************************</span>
<a name="l00060"></a>00060 
<a name="l00070"></a><a class="code" href="classCPSLog.html#a4c3be4120dc6dee2c97a6dde9428ac76">00070</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCPSLog.html#a4c3be4120dc6dee2c97a6dde9428ac76">log</a>( $category, $message, $level = <span class="stringliteral">&#39;info&#39;</span>, $options = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(), $source = null, $language = null )
<a name="l00071"></a>00071     {
<a name="l00072"></a>00072         <span class="keywordflow">if</span> ( null === $category )
<a name="l00073"></a>00073             $category = <a class="code" href="classCPSLog.html#a66291d27410fbf7ba4978f513c13e6f0">self::_getCallingMethod</a>();
<a name="l00074"></a>00074 
<a name="l00075"></a>00075         <span class="comment">//  Get the indent, if any</span>
<a name="l00076"></a>00076         $_unindent = ( 0 &gt; ( $_newIndent = <a class="code" href="classCPSLog.html#a8471574061e9457cc6e5be7c151b9cfb">self::_processMessage</a>( $message ) ) );
<a name="l00077"></a>00077 
<a name="l00078"></a>00078         $_levelList = explode( <span class="charliteral">&#39;|&#39;</span>, $level );
<a name="l00079"></a>00079 
<a name="l00080"></a>00080         <span class="comment">//  Handle writing to multiple levels at once.</span>
<a name="l00081"></a>00081         <span class="keywordflow">foreach</span> ( $_levelList as $_level )
<a name="l00082"></a>00082         {
<a name="l00083"></a>00083             $_indicator = PS::o( self::$_levelIndicators, $_level, self::$_defaultLevelIndicator );
<a name="l00084"></a>00084             $_logEntry = self::$prefix . Yii::t( $category, $message, $options, $source, $language );
<a name="l00085"></a>00085 
<a name="l00086"></a>00086             <span class="keywordflow">if</span> ( self::$echoData )
<a name="l00087"></a>00087             {
<a name="l00088"></a>00088                 echo date( <span class="stringliteral">&#39;Y.m.d h.i.s&#39;</span> ) . <span class="charliteral">&#39;[&#39;</span> . strtoupper( $_level[0] ) . <span class="stringliteral">&#39;] &#39;</span> . <span class="charliteral">&#39;[&#39;</span> . sprintf( <span class="stringliteral">&#39;%-40s&#39;</span>, $category ) . <span class="stringliteral">&#39;] &#39;</span> . $_logEntry . <span class="stringliteral">&#39;&lt;br /&gt;&#39;</span>;
<a name="l00089"></a>00089                 flush();
<a name="l00090"></a>00090             }
<a name="l00091"></a>00091 
<a name="l00092"></a>00092             <span class="comment">//  Indent...</span>
<a name="l00093"></a>00093             $_tempIndent = self::$currentIndent;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095             <span class="keywordflow">if</span> ( $_unindent )
<a name="l00096"></a>00096                 $_tempIndent--;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098             <span class="keywordflow">if</span> ( $_tempIndent &lt; 0 )
<a name="l00099"></a>00099                 $_tempIndent = 0;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101             $_logEntry = str_repeat( <span class="stringliteral">&#39;  &#39;</span>, $_tempIndent ) . $_indicator . <span class="charliteral">&#39; &#39;</span> . $message;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103             <a class="code" href="classCPSLog.html#a4c3be4120dc6dee2c97a6dde9428ac76">Yii::log</a>( $_logEntry, $_level, $category );
<a name="l00104"></a>00104         }
<a name="l00105"></a>00105 
<a name="l00106"></a>00106         <span class="comment">//  Set indent level...</span>
<a name="l00107"></a>00107         self::$currentIndent += $_newIndent;
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109 
<a name="l00118"></a><a class="code" href="classCPSLog.html#a377d71c5d7e04b1098ec85533d165ec4">00118</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCPSLog.html#a377d71c5d7e04b1098ec85533d165ec4">info</a>( $category, $message, $options = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(), $source = null, $language = null )
<a name="l00119"></a>00119     {
<a name="l00120"></a>00120         <a class="code" href="classCPSLog.html#a4c3be4120dc6dee2c97a6dde9428ac76">self::log</a>( $category, $message, <span class="stringliteral">&#39;info&#39;</span>, $options, $source, $language );
<a name="l00121"></a>00121     }
<a name="l00122"></a>00122 
<a name="l00131"></a><a class="code" href="classCPSLog.html#a99034739d5e469b037364bf2f5694e11">00131</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCPSLog.html#a99034739d5e469b037364bf2f5694e11">error</a>( $category, $message, $options = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(), $source = null, $language = null )
<a name="l00132"></a>00132     {
<a name="l00133"></a>00133         <a class="code" href="classCPSLog.html#a4c3be4120dc6dee2c97a6dde9428ac76">self::log</a>( $category, $message, <span class="stringliteral">&#39;error&#39;</span>, $options, $source, $language );
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 
<a name="l00144"></a><a class="code" href="classCPSLog.html#a53acb6b7750f2124585e95066e3c0682">00144</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCPSLog.html#a53acb6b7750f2124585e95066e3c0682">warning</a>( $category, $message, $options = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(), $source = null, $language = null )
<a name="l00145"></a>00145     {
<a name="l00146"></a>00146         <a class="code" href="classCPSLog.html#a4c3be4120dc6dee2c97a6dde9428ac76">self::log</a>( $category, $message, <span class="stringliteral">&#39;warning&#39;</span>, $options, $source, $language );
<a name="l00147"></a>00147     }
<a name="l00148"></a>00148 
<a name="l00157"></a><a class="code" href="classCPSLog.html#ab8a624f93a0bfc699dd00c01af886955">00157</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCPSLog.html#ab8a624f93a0bfc699dd00c01af886955">trace</a>( $category, $message, $options = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(), $source = null, $language = null )
<a name="l00158"></a>00158     {
<a name="l00159"></a>00159         <span class="keywordflow">if</span> ( defined( <span class="stringliteral">&#39;PYE_TRACE_LEVEL&#39;</span> ) &amp;&amp; 0 == PYE_TRACE_LEVEL )
<a name="l00160"></a>00160             <span class="keywordflow">return</span>;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162         <a class="code" href="classCPSLog.html#a4c3be4120dc6dee2c97a6dde9428ac76">self::log</a>( $category, $message, <span class="stringliteral">&#39;trace&#39;</span>, $options, $source, $language );
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164 
<a name="l00170"></a><a class="code" href="classCPSLog.html#acf48a217b13a2f1e5b5431b6113ae38b">00170</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCPSLog.html#acf48a217b13a2f1e5b5431b6113ae38b">api</a>( $apiCall, $response )
<a name="l00171"></a>00171     {
<a name="l00172"></a>00172         <a class="code" href="classCPSLog.html#a4c3be4120dc6dee2c97a6dde9428ac76">self::log</a>( $apiCall, PHP_EOL . print_r( $response, <span class="keyword">true</span> ) . PHP_EOL, <span class="stringliteral">&#39;api&#39;</span> );
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174 
<a name="l00180"></a><a class="code" href="classCPSLog.html#af84e351764728a15fc9c0d87e99deb5d">00180</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCPSLog.html#af84e351764728a15fc9c0d87e99deb5d">debug</a>( $category, $message )
<a name="l00181"></a>00181     {
<a name="l00182"></a>00182         <a class="code" href="classCPSLog.html#a4c3be4120dc6dee2c97a6dde9428ac76">self::log</a>( $category, $message, <span class="stringliteral">&#39;debug&#39;</span> );
<a name="l00183"></a>00183     }
<a name="l00184"></a>00184 
<a name="l00191"></a><a class="code" href="classCPSLog.html#a01cfe9b1c44f0c7a14c0f4ff7460e666">00191</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCPSLog.html#a01cfe9b1c44f0c7a14c0f4ff7460e666">write</a>( $message, $level, $category = null )
<a name="l00192"></a>00192     {
<a name="l00193"></a>00193         <a class="code" href="classCPSLog.html#a4c3be4120dc6dee2c97a6dde9428ac76">self::log</a>( $category, $message, $level );
<a name="l00194"></a>00194     }
<a name="l00195"></a>00195 
<a name="l00201"></a><a class="code" href="classCPSLog.html#a66291d27410fbf7ba4978f513c13e6f0">00201</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classCPSLog.html#a66291d27410fbf7ba4978f513c13e6f0">_getCallingMethod</a>( $level = null )
<a name="l00202"></a>00202     {
<a name="l00203"></a>00203         $_className = get_class();
<a name="l00204"></a>00204         $level = ( null === $level ? self::$baseLevel : $level );
<a name="l00205"></a>00205 
<a name="l00206"></a>00206         <span class="keywordflow">try</span>
<a name="l00207"></a>00207         {
<a name="l00208"></a>00208             $_trace = debug_backtrace();
<a name="l00209"></a>00209             $_count = count( $_trace );
<a name="l00210"></a>00210 
<a name="l00211"></a>00211             <span class="keywordflow">while</span> ( $level &gt;= 0 &amp;&amp; isset( $_trace[$level] ) )
<a name="l00212"></a>00212             {
<a name="l00213"></a>00213                 <span class="keywordflow">if</span> ( null === ( $_caller = PS::o( $_trace, $level ) ) )
<a name="l00214"></a>00214                     <span class="keywordflow">break</span>;
<a name="l00215"></a>00215 
<a name="l00216"></a>00216                 <span class="keywordflow">if</span> ( null !== ( $_class = PS::o( $_caller, <span class="stringliteral">&#39;class&#39;</span> ) ) )
<a name="l00217"></a>00217                 {
<a name="l00218"></a>00218                     <span class="comment">//  If we see ourself, then we must go again</span>
<a name="l00219"></a>00219                     <span class="keywordflow">if</span> ( $_class == $_className )
<a name="l00220"></a>00220                     {
<a name="l00221"></a>00221                         <span class="comment">//  One louder</span>
<a name="l00222"></a>00222                         $level++;
<a name="l00223"></a>00223                         <span class="keywordflow">continue</span>;
<a name="l00224"></a>00224                     }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226                     <span class="keywordflow">return</span> $_class . <span class="stringliteral">&#39;::&#39;</span> . PS::o( $_caller, <span class="stringliteral">&#39;function&#39;</span> );
<a name="l00227"></a>00227                 }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229                 <span class="comment">//  If we see ourself, then we must go again</span>
<a name="l00230"></a>00230                 <span class="keywordflow">if</span> ( $_className == basename( PS::o( $_caller, <span class="stringliteral">&#39;file&#39;</span> ) ) )
<a name="l00231"></a>00231                 {
<a name="l00232"></a>00232                     <span class="comment">//  One louder</span>
<a name="l00233"></a>00233                     $level++;
<a name="l00234"></a>00234                     <span class="keywordflow">continue</span>;
<a name="l00235"></a>00235                 }
<a name="l00236"></a>00236 
<a name="l00237"></a>00237                 <span class="keywordflow">return</span> basename( PS::o( $_caller, <span class="stringliteral">&#39;file&#39;</span> ) ) . <span class="stringliteral">&#39;::&#39;</span> . PS::o( $_caller, <span class="stringliteral">&#39;function&#39;</span> ) . <span class="stringliteral">&#39; (Line &#39;</span> . PS::o( $_caller, <span class="stringliteral">&#39;line&#39;</span> ) . <span class="charliteral">&#39;)&#39;</span>;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239                 $level--;
<a name="l00240"></a>00240             }
<a name="l00241"></a>00241         }
<a name="l00242"></a>00242         <span class="keywordflow">catch</span> ( Exception $_ex )
<a name="l00243"></a>00243         {
<a name="l00244"></a>00244             <span class="comment">//  Error logging shouldn&#39;t create more errors...</span>
<a name="l00245"></a>00245         }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247         <span class="keywordflow">return</span> null;
<a name="l00248"></a>00248     }
<a name="l00249"></a>00249 
<a name="l00253"></a><a class="code" href="classCPSLog.html#a155b35eda603d263e56ba06d3c3042f5">00253</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCPSLog.html#a155b35eda603d263e56ba06d3c3042f5">decrementIndent</a>( $howMuch = 1 )
<a name="l00254"></a>00254     {
<a name="l00255"></a>00255         self::$currentIndent -= $howMuch;
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="keywordflow">if</span> ( self::$currentIndent &lt; 0 )
<a name="l00258"></a>00258             self::$currentIndent = 0;
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260 
<a name="l00266"></a><a class="code" href="classCPSLog.html#a8471574061e9457cc6e5be7c151b9cfb">00266</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classCPSLog.html#a8471574061e9457cc6e5be7c151b9cfb">_processMessage</a>( &amp;$message )
<a name="l00267"></a>00267     {
<a name="l00268"></a>00268         $_newIndent = 0;
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         <span class="keywordflow">switch</span> ( substr( $message, 0, 2 ) )
<a name="l00271"></a>00271         {
<a name="l00272"></a>00272             <span class="keywordflow">case</span> <span class="stringliteral">&#39;&gt;&gt;&#39;</span>:
<a name="l00273"></a>00273                 $_newIndent = 1;
<a name="l00274"></a>00274                 $message = trim( substr( $message, 2 ) );
<a name="l00275"></a>00275                 <span class="keywordflow">break</span>;
<a name="l00276"></a>00276 
<a name="l00277"></a>00277             <span class="keywordflow">case</span> <span class="stringliteral">&#39;&lt;&lt;&#39;</span>:
<a name="l00278"></a>00278                 $_newIndent = -1;
<a name="l00279"></a>00279                 $message = trim( substr( $message, 2 ) );
<a name="l00280"></a>00280                 <span class="keywordflow">break</span>;
<a name="l00281"></a>00281         }
<a name="l00282"></a>00282 
<a name="l00283"></a>00283         <span class="keywordflow">return</span> $_newIndent;
<a name="l00284"></a>00284     }
<a name="l00285"></a>00285 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Mar 24 2011 20:11:38 for "The Yii Extension Library Of Doom!" by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
