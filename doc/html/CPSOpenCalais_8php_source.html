<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>&quot;The Yii Extension Library Of Doom!&quot;: /usr/local/yiixl/lib/original/components/openCalais/CPSOpenCalais.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>/usr/local/yiixl/lib/original/components/openCalais/CPSOpenCalais.php</h1>  </div>
</div>
<div class="contents">
<a href="CPSOpenCalais_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00028"></a>00028 <span class="comment">//  Include Files</span>
<a name="l00029"></a>00029 <span class="comment">//  Constants</span>
<a name="l00030"></a>00030 <span class="comment">//  Global Settings</span>
<a name="l00031"></a>00031 
<a name="l00043"></a><a class="code" href="classCPSOpenCalais.html">00043</a> <span class="keyword">class </span><a class="code" href="classCPSOpenCalais.html">CPSOpenCalais</a> <span class="keyword">extends</span> <a class="code" href="classCPSApiComponent.html">CPSApiComponent</a>
<a name="l00044"></a>00044 {
<a name="l00045"></a>00045     <span class="comment">//********************************************************************************</span>
<a name="l00046"></a>00046     <span class="comment">//* Constants</span>
<a name="l00047"></a>00047     <span class="comment">//********************************************************************************</span>
<a name="l00048"></a>00048 
<a name="l00052"></a><a class="code" href="classCPSOpenCalais.html#abd77e417d95ee59b739e54a62fe97fbc">00052</a>     <span class="keyword">const</span> <a class="code" href="classCPSOpenCalais.html#abd77e417d95ee59b739e54a62fe97fbc">SOAP</a> = 0;
<a name="l00053"></a><a class="code" href="classCPSOpenCalais.html#a1273e4f6dfecad5cc711360770b7d784">00053</a>     <span class="keyword">const</span> <a class="code" href="classCPSOpenCalais.html#a1273e4f6dfecad5cc711360770b7d784">REST</a> = 1;
<a name="l00054"></a><a class="code" href="classCPSOpenCalais.html#ac124904e08a9542af2a219df5f9472e6">00054</a>     <span class="keyword">const</span> <a class="code" href="classCPSOpenCalais.html#ac124904e08a9542af2a219df5f9472e6">HTML</a> = 2;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056     <span class="comment">//********************************************************************************</span>
<a name="l00057"></a>00057     <span class="comment">//* Class Members</span>
<a name="l00058"></a>00058     <span class="comment">//********************************************************************************</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060     <span class="comment">/***</span>
<a name="l00061"></a>00061 <span class="comment">    * Open Calais API Key</span>
<a name="l00062"></a>00062 <span class="comment">     *</span>
<a name="l00063"></a>00063 <span class="comment">    * @var string</span>
<a name="l00064"></a>00064 <span class="comment">    */</span>
<a name="l00065"></a><a class="code" href="classCPSOpenCalais.html#a084e3db37d1b117a3cc7212cf2eed533">00065</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#a084e3db37d1b117a3cc7212cf2eed533">$apiKey</a> = null;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067     <span class="comment">/***</span>
<a name="l00068"></a>00068 <span class="comment">    * Open Calais API Url</span>
<a name="l00069"></a>00069 <span class="comment">    *</span>
<a name="l00070"></a>00070 <span class="comment">    * @var string</span>
<a name="l00071"></a>00071 <span class="comment">    */</span>
<a name="l00072"></a><a class="code" href="classCPSOpenCalais.html#a07eadf024580d87646e290d38176c8a7">00072</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#a07eadf024580d87646e290d38176c8a7">$soapUrl</a> = <span class="stringliteral">&#39;http://api.opencalais.com/enlighten/?wsdl&#39;</span>;
<a name="l00073"></a>00073     <span class="comment">/***</span>
<a name="l00074"></a>00074 <span class="comment">    * Content type of the request</span>
<a name="l00075"></a>00075 <span class="comment">    *</span>
<a name="l00076"></a>00076 <span class="comment">    * @var string</span>
<a name="l00077"></a>00077 <span class="comment">    */</span>
<a name="l00078"></a><a class="code" href="classCPSOpenCalais.html#ab8c052d0ddebb9f14151f8682916a587">00078</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#ab8c052d0ddebb9f14151f8682916a587">$contentType</a> = <span class="stringliteral">&#39;text/txt&#39;</span>;
<a name="l00079"></a>00079     <span class="comment">/***</span>
<a name="l00080"></a>00080 <span class="comment">    * Output format of the response</span>
<a name="l00081"></a>00081 <span class="comment">    *</span>
<a name="l00082"></a>00082 <span class="comment">    * @var string</span>
<a name="l00083"></a>00083 <span class="comment">    */</span>
<a name="l00084"></a><a class="code" href="classCPSOpenCalais.html#aad6ca9fda50b25879e53039e23613449">00084</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#aad6ca9fda50b25879e53039e23613449">$outputFormat</a> = <span class="stringliteral">&#39;XML/RDF&#39;</span>;
<a name="l00090"></a><a class="code" href="classCPSOpenCalais.html#a68ec6608c1cf0f23c25f420586e31e77">00090</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#a68ec6608c1cf0f23c25f420586e31e77">$reltagBaseUrl</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00096"></a><a class="code" href="classCPSOpenCalais.html#a32ea2c52cbe7a0febc8be98c7ca57195">00096</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#a32ea2c52cbe7a0febc8be98c7ca57195">$calculateRelevanceScore</a> = <span class="stringliteral">&#39;true&#39;</span>;
<a name="l00102"></a><a class="code" href="classCPSOpenCalais.html#a465299fb5bd9cc610d83d8cc162a69ef">00102</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#a465299fb5bd9cc610d83d8cc162a69ef">$enableMetadataType</a> = <span class="stringliteral">&#39;false&#39;</span>;
<a name="l00108"></a><a class="code" href="classCPSOpenCalais.html#a0e3c2633bd75ee4bdb9bc4ad0e498a0c">00108</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#a0e3c2633bd75ee4bdb9bc4ad0e498a0c">$discardMetadata</a> = <span class="stringliteral">&#39;false&#39;</span>;
<a name="l00109"></a>00109     <span class="comment">/***</span>
<a name="l00110"></a>00110 <span class="comment">    * Indicates whether the extracted metadata can be distributed</span>
<a name="l00111"></a>00111 <span class="comment">    *</span>
<a name="l00112"></a>00112 <span class="comment">    * @var string true or false</span>
<a name="l00113"></a>00113 <span class="comment">    */</span>
<a name="l00114"></a><a class="code" href="classCPSOpenCalais.html#a2989023b45237cd246c557e99bf994b6">00114</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#a2989023b45237cd246c557e99bf994b6">$allowDistribution</a> = <span class="stringliteral">&#39;false&#39;</span>;
<a name="l00115"></a>00115     <span class="comment">/***</span>
<a name="l00116"></a>00116 <span class="comment">    * Indicates whether future searches can be performed on the extracted metadata</span>
<a name="l00117"></a>00117 <span class="comment">    *</span>
<a name="l00118"></a>00118 <span class="comment">    * @var string true or false</span>
<a name="l00119"></a>00119 <span class="comment">    */</span>
<a name="l00120"></a><a class="code" href="classCPSOpenCalais.html#a128c7ee55d4a7c1aa84c8b65a88d6862">00120</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#a128c7ee55d4a7c1aa84c8b65a88d6862">$allowSearch</a> = <span class="stringliteral">&#39;false&#39;</span>;
<a name="l00121"></a>00121     <span class="comment">/***</span>
<a name="l00122"></a>00122 <span class="comment">    * User-generated ID for the submission</span>
<a name="l00123"></a>00123 <span class="comment">    *</span>
<a name="l00124"></a>00124 <span class="comment">    * @var string</span>
<a name="l00125"></a>00125 <span class="comment">    */</span>
<a name="l00126"></a><a class="code" href="classCPSOpenCalais.html#a03cbdb5a006d142963eb1f513002bdd0">00126</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#a03cbdb5a006d142963eb1f513002bdd0">$externalID</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00127"></a>00127     <span class="comment">/***</span>
<a name="l00128"></a>00128 <span class="comment">    * Identifier for the content submitter</span>
<a name="l00129"></a>00129 <span class="comment">    *</span>
<a name="l00130"></a>00130 <span class="comment">    * @var string</span>
<a name="l00131"></a>00131 <span class="comment">    */</span>
<a name="l00132"></a><a class="code" href="classCPSOpenCalais.html#a317ab5774a65de21409c3f9715e5c50c">00132</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#a317ab5774a65de21409c3f9715e5c50c">$submitter</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00133"></a>00133     <span class="comment">/***</span>
<a name="l00134"></a>00134 <span class="comment">    * Exclude the original body from the returned RDF output</span>
<a name="l00135"></a>00135 <span class="comment">    *</span>
<a name="l00136"></a>00136 <span class="comment">    * @var string true or false</span>
<a name="l00137"></a>00137 <span class="comment">    */</span>
<a name="l00138"></a><a class="code" href="classCPSOpenCalais.html#ad0c769ee6d064c1c2e3e16ee10b3404e">00138</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#ad0c769ee6d064c1c2e3e16ee10b3404e">$omitOutputtingOriginalText</a> = <span class="stringliteral">&#39;true&#39;</span>;
<a name="l00139"></a>00139     
<a name="l00144"></a><a class="code" href="classCPSOpenCalais.html#a37c866e0dd005b2054896f4c4fb88132">00144</a>     <span class="keyword">public</span> <a class="code" href="classCPSOpenCalais.html#a37c866e0dd005b2054896f4c4fb88132">$requestMethod</a> = self::SOAP;
<a name="l00145"></a>00145 
<a name="l00146"></a>00146     <span class="comment">//********************************************************************************</span>
<a name="l00147"></a>00147     <span class="comment">//* Class Methods</span>
<a name="l00148"></a>00148     <span class="comment">//********************************************************************************</span>
<a name="l00149"></a>00149 
<a name="l00155"></a><a class="code" href="classCPSOpenCalais.html#ac0b3a7b2ac4ed8f5d6b100820faedfab">00155</a>     <span class="keyword">public</span> function <a class="code" href="classCPSOpenCalais.html#ac0b3a7b2ac4ed8f5d6b100820faedfab">semanticProxy</a>( $url )
<a name="l00156"></a>00156     {
<a name="l00157"></a>00157         $_data = null;
<a name="l00158"></a>00158 
<a name="l00159"></a>00159         <span class="comment">//  Make the call...</span>
<a name="l00160"></a>00160         <span class="keywordflow">if</span> ( $_results = PS::makeHttpRequest( <span class="stringliteral">&#39;http://service.semanticproxy.com/processurl/&#39;</span> . $this-&gt;apiKey . <span class="stringliteral">&#39;/json/&#39;</span> . $url ) )
<a name="l00161"></a>00161             $_data = json_decode( $_results, <span class="keyword">true</span> );
<a name="l00162"></a>00162 
<a name="l00163"></a>00163         <span class="comment">//  No go? Default to soap</span>
<a name="l00164"></a>00164         <span class="keywordflow">if</span> ( $_data === null )
<a name="l00165"></a>00165         {
<a name="l00166"></a>00166             <span class="comment">//  Let&#39;s try and make a soap call...</span>
<a name="l00167"></a>00167             $_sOldOF = $this-&gt;outputFormat;
<a name="l00168"></a>00168             $this-&gt;outputFormat = <span class="stringliteral">&#39;application/json&#39;</span>;
<a name="l00169"></a>00169 
<a name="l00170"></a>00170             <span class="keywordflow">try</span>
<a name="l00171"></a>00171             {
<a name="l00172"></a>00172                 $_oResult = $this-&gt;<a class="code" href="classCPSOpenCalais.html#a816ea4fdb9191868f2d0f51d182114bd">enlighten</a>( <span class="stringliteral">&#39;&#39;</span>, $url, <span class="keyword">true</span> );
<a name="l00173"></a>00173                 $_data = json_decode( $_oResult-&gt;EnlightenResult, <span class="keyword">true</span> );
<a name="l00174"></a>00174             }
<a name="l00175"></a>00175             <span class="keywordflow">catch</span> ( Exception $_ex )
<a name="l00176"></a>00176             {
<a name="l00177"></a>00177                 $this-&gt;outputFormat = $_sOldOF;
<a name="l00178"></a>00178                 Yii::log( <span class="stringliteral">&quot;Error getting SOAP request after failed SemanticProxy: &quot;</span> . $_ex-&gt;getMessage(), <span class="stringliteral">&#39;error&#39;</span>, <span class="stringliteral">&#39;system.components.COpenCalaisApi&#39;</span> );
<a name="l00179"></a>00179                 <span class="keywordflow">return</span>( null );
<a name="l00180"></a>00180             }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182             $this-&gt;outputFormat = $_sOldOF;
<a name="l00183"></a>00183         }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 <span class="comment">//      Yii::log( var_export( $_data, true ), &#39;info&#39;, &#39;system.components.COpenCalaisApi&#39; );</span>
<a name="l00186"></a>00186 
<a name="l00187"></a>00187         <span class="comment">//  Return</span>
<a name="l00188"></a>00188         <span class="keywordflow">return</span> $_data;
<a name="l00189"></a>00189     }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191     <span class="comment">/***</span>
<a name="l00192"></a>00192 <span class="comment">    * Calls the Open Calais API via SOAP and returns the results.</span>
<a name="l00193"></a>00193 <span class="comment">    *</span>
<a name="l00194"></a>00194 <span class="comment">    */</span>
<a name="l00195"></a><a class="code" href="classCPSOpenCalais.html#a816ea4fdb9191868f2d0f51d182114bd">00195</a>     <span class="keyword">public</span> function <a class="code" href="classCPSOpenCalais.html#a816ea4fdb9191868f2d0f51d182114bd">enlighten</a>( $sExternalID, $sContent, $bFetch = <span class="keyword">false</span> )
<a name="l00196"></a>00196     {
<a name="l00197"></a>00197         <span class="comment">//  Default content...</span>
<a name="l00198"></a>00198         $_sContent = $sContent;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200         <span class="comment">//  Override external id...</span>
<a name="l00201"></a>00201         <span class="keywordflow">if</span> ( $sExternalID != null )
<a name="l00202"></a>00202             $this-&gt;externalID = $sExternalID;
<a name="l00203"></a>00203 
<a name="l00204"></a>00204         <span class="comment">//  Get content if we are passing in an url...</span>
<a name="l00205"></a>00205         <span class="keywordflow">if</span> ( $bFetch )
<a name="l00206"></a>00206         {
<a name="l00207"></a>00207             $this-&gt;contentType = <span class="stringliteral">&#39;text/html&#39;</span>;
<a name="l00208"></a>00208             $_iTryCount = 0;
<a name="l00209"></a>00209             $_sDeepLink = $this-&gt;getDeepLink( $sContent );
<a name="l00210"></a>00210 
<a name="l00211"></a>00211             <span class="comment">//  Try up to five times to pull the real data...</span>
<a name="l00212"></a>00212             <span class="keywordflow">while</span> ( $_iTryCount &lt; 5 )
<a name="l00213"></a>00213             {
<a name="l00214"></a>00214                 $_sContent = PS::makeHttpRequest( $_sDeepLink );
<a name="l00215"></a>00215 
<a name="l00216"></a>00216                 <span class="comment">//  Error ...</span>
<a name="l00217"></a>00217                 <span class="keywordflow">if</span> ( $_sContent === <span class="keyword">false</span> )
<a name="l00218"></a>00218                     <span class="keywordflow">break</span>;
<a name="l00219"></a>00219 
<a name="l00220"></a>00220                 <span class="keywordflow">if</span> ( $_sContent == <span class="stringliteral">&#39;&#39;</span> || $_sContent == null )
<a name="l00221"></a>00221                 {
<a name="l00222"></a>00222                     Yii::log( <span class="stringliteral">&#39;Error fetching url:[&#39;</span> . $_sDeepLink . <span class="charliteral">&#39;]&#39;</span>, <span class="stringliteral">&#39;error&#39;</span>, <span class="stringliteral">&#39;system.components.COpenCalaisApi&#39;</span> );
<a name="l00223"></a>00223                 }
<a name="l00224"></a>00224                 <span class="keywordflow">else</span>
<a name="l00225"></a>00225                     <span class="keywordflow">break</span>;
<a name="l00226"></a>00226 
<a name="l00227"></a>00227                 $_iTryCount++;
<a name="l00228"></a>00228             }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230             <span class="keywordflow">if</span> ( strlen( $_sContent ) &gt; 99999 )
<a name="l00231"></a>00231             {
<a name="l00232"></a>00232                 Yii::log( <span class="stringliteral">&quot;Content too large, pulling out just the body&quot;</span>, <span class="stringliteral">&#39;info&#39;</span>, <span class="stringliteral">&#39;system.components.COpenCalaisApi&#39;</span> );
<a name="l00233"></a>00233 
<a name="l00234"></a>00234                 <span class="comment">//  Try and pull the body out...</span>
<a name="l00235"></a>00235                 $_sContent = PS::suckTag( $_sContent, <span class="stringliteral">&#39;&lt;body&#39;</span>, <span class="stringliteral">&#39;&lt;/body&gt;&#39;</span> );
<a name="l00236"></a>00236 
<a name="l00237"></a>00237                 <span class="comment">//  Still too long? Dammit, trim off some characters</span>
<a name="l00238"></a>00238                 <span class="keywordflow">if</span> ( strlen( $_sContent ) &gt; 99999 )
<a name="l00239"></a>00239                 {
<a name="l00240"></a>00240                     $_sContent = substr( $_sContent, 0, 99500 );
<a name="l00241"></a>00241 <span class="comment">//                  $this-&gt;contentType = &#39;text/raw&#39;;</span>
<a name="l00242"></a>00242                     Yii::log( <span class="stringliteral">&quot;Content STILL too large, forced trimmed&quot;</span>, <span class="stringliteral">&#39;error&#39;</span>, <span class="stringliteral">&#39;system.components.COpenCalaisApi&#39;</span> );
<a name="l00243"></a>00243                 }
<a name="l00244"></a>00244             }
<a name="l00245"></a>00245         }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247         <span class="comment">//  Empty Content? Bail...</span>
<a name="l00248"></a>00248         <span class="keywordflow">if</span> ( $_sContent == <span class="stringliteral">&#39;&#39;</span> || $_sContent == null )
<a name="l00249"></a>00249         {
<a name="l00250"></a>00250             Yii::log( <span class="stringliteral">&#39;No content to tag, not calling OC url:[&#39;</span> . $_sDeepLink . <span class="charliteral">&#39;]&#39;</span>, <span class="stringliteral">&#39;error&#39;</span>, <span class="stringliteral">&#39;system.components.COpenCalaisApi&#39;</span> );
<a name="l00251"></a>00251             <span class="keywordflow">return</span>( null );
<a name="l00252"></a>00252         }
<a name="l00253"></a>00253 
<a name="l00254"></a>00254         <span class="comment">//  Some temps for blank items...</span>
<a name="l00255"></a>00255         <span class="keywordflow">if</span> ( $this-&gt;reltagBaseUrl != <span class="stringliteral">&#39;&#39;</span> )
<a name="l00256"></a>00256             $_sRelTagBaseUrl = <span class="stringliteral">&#39;c:reltagBaseUrl=&quot;&#39;</span> . $this-&gt;reltagBaseUrl . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00257"></a>00257 
<a name="l00258"></a>00258         <span class="keywordflow">if</span> ( $this-&gt;enableMetadataType != <span class="stringliteral">&#39;&#39;</span> )
<a name="l00259"></a>00259             $_sEnableMetaDataType = <span class="stringliteral">&#39;c:enableMetadataType=&quot;&#39;</span> . $this-&gt;enableMetadataType . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00260"></a>00260 
<a name="l00261"></a>00261         <span class="keywordflow">if</span> ( $this-&gt;discardMetadata != <span class="stringliteral">&#39;&#39;</span> )
<a name="l00262"></a>00262             $_sDiscardMetaData = <span class="stringliteral">&#39;c:discardMetaData=&quot;&#39;</span> . $this-&gt;discardMetadata . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264         <span class="keywordflow">if</span> ( $this-&gt;externalID != <span class="stringliteral">&#39;&#39;</span> )
<a name="l00265"></a>00265             $_sExternalID = <span class="stringliteral">&#39;c:externalID=&quot;&#39;</span> . $this-&gt;externalID . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00266"></a>00266 
<a name="l00267"></a>00267         $_xmlParams = &lt;&lt;&lt;XML
<a name="l00268"></a>00268 &lt;c:params xmlns:c=<span class="stringliteral">&quot;http://s.opencalais.com/1/pred/&quot;</span> xmlns:rdf=<span class="stringliteral">&quot;http://www.w3.org/1999/02/22-rdf-syntax-ns#&quot;</span>&gt;
<a name="l00269"></a>00269     &lt;c:processingDirectives {$_sRelTagBaseUrl} c:calculateRelevanceScore=<span class="stringliteral">&quot;{$this-&gt;calculateRelevanceScore}&quot;</span> c:omitOutputtingOriginalText=<span class="stringliteral">&quot;{$this-&gt;omitOutputtingOriginalText}&quot;</span> c:contentType=<span class="stringliteral">&quot;{$this-&gt;contentType}&quot;</span> {$_sEnableMetaDataType} {$_sDiscardMetaData} c:outputFormat=<span class="stringliteral">&quot;{$this-&gt;outputFormat}&quot;</span>&gt;
<a name="l00270"></a>00270     &lt;/c:processingDirectives&gt;
<a name="l00271"></a>00271     &lt;c:userDirectives c:allowDistribution=<span class="stringliteral">&quot;{$this-&gt;allowDistribution}&quot;</span> c:allowSearch=<span class="stringliteral">&quot;{$this-&gt;allowSearch}&quot;</span> {$_sExternalID} c:submitter=<span class="stringliteral">&quot;{$this-&gt;submitter}&quot;</span>&gt;
<a name="l00272"></a>00272     &lt;/c:userDirectives&gt;
<a name="l00273"></a>00273     &lt;c:externalMetadata&gt;
<a name="l00274"></a>00274     &lt;/c:externalMetadata&gt;
<a name="l00275"></a>00275 &lt;/c:params&gt;
<a name="l00276"></a>00276 XML;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278         $_oClient = <span class="keyword">new</span> SoapClient( $this-&gt;soapUrl );
<a name="l00279"></a>00279 
<a name="l00280"></a>00280         <span class="keywordflow">try</span>
<a name="l00281"></a>00281         {
<a name="l00282"></a>00282             $_sEncContent = utf8_encode( $_sContent );
<a name="l00283"></a>00283 
<a name="l00284"></a>00284             $_oResponse = $_oClient-&gt;Enlighten(
<a name="l00285"></a>00285                 <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00286"></a>00286                     <span class="stringliteral">&#39;licenseID&#39;</span> =&gt; $this-&gt;apiKey,
<a name="l00287"></a>00287                     <span class="stringliteral">&#39;content&#39;</span> =&gt; $_sEncContent,
<a name="l00288"></a>00288                     <span class="stringliteral">&#39;paramsXML&#39;</span> =&gt; $_xmlParams,
<a name="l00289"></a>00289                 )
<a name="l00290"></a>00290             );
<a name="l00291"></a>00291         }
<a name="l00292"></a>00292         <span class="keywordflow">catch</span> ( SoapFault $_ex )
<a name="l00293"></a>00293         {
<a name="l00294"></a>00294             Yii::log( <span class="stringliteral">&quot;Error calling Open Calais SOAP method:[&quot;</span> . $_ex-&gt;getMessage() . <span class="charliteral">&#39;]&#39;</span>, <span class="stringliteral">&#39;error&#39;</span>, <span class="stringliteral">&#39;system.components.COpenCalaisApi&#39;</span> );
<a name="l00295"></a>00295             $_oResponse = null;
<a name="l00296"></a>00296         }
<a name="l00297"></a>00297 
<a name="l00298"></a>00298         <span class="keywordflow">return</span>( $_oResponse );
<a name="l00299"></a>00299     }
<a name="l00300"></a>00300 
<a name="l00307"></a>00307     <span class="keyword">private</span> function getDeepLink( $url )
<a name="l00308"></a>00308     {
<a name="l00309"></a>00309         $_sLink = $url;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         <span class="comment">//  Is this a digg link?</span>
<a name="l00312"></a>00312         <span class="keywordflow">if</span> (
<a name="l00313"></a>00313             substr( $_sLink, 0, 15 ) == <span class="stringliteral">&#39;http://digg.com&#39;</span> ||
<a name="l00314"></a>00314             substr( $_sLink, 0, 21 ) == <span class="stringliteral">&#39;http://feeds.digg.com&#39;</span>
<a name="l00315"></a>00315             )
<a name="l00316"></a>00316         {
<a name="l00317"></a>00317             $_sData = PS::makeHttpRequest( $_sLink );
<a name="l00318"></a>00318             <span class="keywordflow">if</span> ( $_sData != <span class="stringliteral">&#39;&#39;</span> )
<a name="l00319"></a>00319             {
<a name="l00320"></a>00320                 $_sTemp = PS::suckTag( $_sData, <span class="stringliteral">&#39;&lt;a href=&quot;&#39;</span>, <span class="stringliteral">&#39;&lt;/a&gt;&#39;</span>, 0, <span class="stringliteral">&#39;&lt;h1 id=&quot;title&quot;&gt;&#39;</span> );
<a name="l00321"></a>00321                 <span class="keywordflow">if</span> ( $_sTemp != <span class="stringliteral">&#39;&#39;</span> )
<a name="l00322"></a>00322                 {
<a name="l00323"></a>00323                     $_i = stripos( $_sTemp, <span class="charliteral">&#39;&quot;&#39;</span> );
<a name="l00324"></a>00324                     <span class="keywordflow">if</span> ( $_i !== <span class="keyword">false</span> )
<a name="l00325"></a>00325                     {
<a name="l00326"></a>00326                         $_sLink = substr( $_sTemp, 0, $_i );
<a name="l00327"></a>00327                         Yii::trace( <span class="stringliteral">&#39;Deeplink pull [&#39;</span> . $url .<span class="stringliteral">&#39; / &#39;</span> . $_sLink . <span class="charliteral">&#39;]&#39;</span>, <span class="stringliteral">&#39;system.commands.CheckFeedsCommand&#39;</span>);
<a name="l00328"></a>00328                     }
<a name="l00329"></a>00329                 }
<a name="l00330"></a>00330             }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332             unset( $_sData );
<a name="l00333"></a>00333         }
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         <span class="comment">//  How about google news?</span>
<a name="l00336"></a>00336         <span class="keywordflow">if</span> (
<a name="l00337"></a>00337             substr( $_sLink, 0, 32 ) == <span class="stringliteral">&#39;http://news.google.com/news/url?&#39;</span>
<a name="l00338"></a>00338             )
<a name="l00339"></a>00339         {
<a name="l00340"></a>00340             $_i = stripos( $_sLink, <span class="stringliteral">&#39;url=&#39;</span> );
<a name="l00341"></a>00341             <span class="keywordflow">if</span> ( $_i &gt;= 0 )
<a name="l00342"></a>00342             {
<a name="l00343"></a>00343                 $_sLink = substr( $_sLink, $_i + 4, stripos( $_sLink, <span class="stringliteral">&#39;&amp;amp;cid=&#39;</span>, $_i + 4 ) - $_i - 4 );
<a name="l00344"></a>00344                 Yii::trace( <span class="stringliteral">&#39;Deeplink pull [&#39;</span> . $url .<span class="stringliteral">&#39; / &#39;</span> . $_sLink . <span class="charliteral">&#39;]&#39;</span>, <span class="stringliteral">&#39;system.commands.CheckFeedsCommand&#39;</span>);
<a name="l00345"></a>00345             }
<a name="l00346"></a>00346         }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348         <span class="keywordflow">return</span>( $_sLink );
<a name="l00349"></a>00349     }
<a name="l00350"></a>00350 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Mar 24 2011 20:11:38 for "The Yii Extension Library Of Doom!" by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
