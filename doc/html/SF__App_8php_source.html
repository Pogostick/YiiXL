<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>&quot;The Yii Extension Library Of Doom!&quot;: /usr/local/yiixl/lib/original/components/snowframe/base/SF_App.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>/usr/local/yiixl/lib/original/components/snowframe/base/SF_App.php</h1>  </div>
</div>
<div class="contents">
<a href="SF__App_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">//error_reporting(E_ALL);</span>
<a name="l00003"></a>00003 <span class="comment">//  $Id: SF_App.php,v 1.6 2008/04/29 18:57:17 jablan Exp $</span>
<a name="l00004"></a>00004 <span class="comment">// +---------------------------------------------------------------------------+</span>
<a name="l00005"></a>00005 <span class="comment">// | Pogostick SnowFrame™ (PHP5)                                               |</span>
<a name="l00006"></a>00006 <span class="comment">// | http://www.snowframe.com                                                  |</span>
<a name="l00007"></a>00007 <span class="comment">// +---------------------------------------------------------------------------+</span>
<a name="l00008"></a>00008 <span class="comment">// | Copyright (c) 2007-2008 Pogostick, LLC.                                   |</span>
<a name="l00009"></a>00009 <span class="comment">// | All rights reserved.                                                      |</span>
<a name="l00010"></a>00010 <span class="comment">// |                                                                           |</span>
<a name="l00011"></a>00011 <span class="comment">// | This file is part of SnowFrame™.                                          |</span>
<a name="l00012"></a>00012 <span class="comment">// |                                                                           |</span>
<a name="l00013"></a>00013 <span class="comment">// | SnowFrame™ is free software: you can redistribute it and/or modify        |</span>
<a name="l00014"></a>00014 <span class="comment">// | it under the terms of the GNU General Public License as published by      |</span>
<a name="l00015"></a>00015 <span class="comment">// | the Free Software Foundation, either version 3 of the License, or         |</span>
<a name="l00016"></a>00016 <span class="comment">// | (at your option) any later version.                                       |</span>
<a name="l00017"></a>00017 <span class="comment">// |                                                                           |</span>
<a name="l00018"></a>00018 <span class="comment">// | SnowFrame™ is distributed in the hope that it will be useful,             |</span>
<a name="l00019"></a>00019 <span class="comment">// | but WITHOUT ANY WARRANTY; without even the implied warranty of            |</span>
<a name="l00020"></a>00020 <span class="comment">// | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             |</span>
<a name="l00021"></a>00021 <span class="comment">// | GNU General Public License for more details.                              |</span>
<a name="l00022"></a>00022 <span class="comment">// |                                                                           |</span>
<a name="l00023"></a>00023 <span class="comment">// | Please visit http://www.gnu.org/licenses for a copy of the license        |</span>
<a name="l00024"></a>00024 <span class="comment">// +---------------------------------------------------------------------------+</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="comment">//  Includes</span>
<a name="l00027"></a>00027 require_once( <span class="stringliteral">&quot;SnowFrame.php&quot;</span> );
<a name="l00028"></a>00028 
<a name="l00032"></a><a class="code" href="classSF__App.html">00032</a> <span class="keyword">class </span><a class="code" href="classSF__App.html">SF_App</a>
<a name="l00033"></a>00033 {
<a name="l00037"></a><a class="code" href="classSF__App.html#a23d5b5190ee32c4eb8fff028844b1fa6">00037</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#a23d5b5190ee32c4eb8fff028844b1fa6">$m_oPFAPI</a> = null;
<a name="l00041"></a><a class="code" href="classSF__App.html#a22d1091f94c58e3533304abe3eb9e9fe">00041</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#a22d1091f94c58e3533304abe3eb9e9fe">$m_oSntx</a> = null;
<a name="l00045"></a><a class="code" href="classSF__App.html#af0fd242fc474881efab473522eec0748">00045</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#af0fd242fc474881efab473522eec0748">$m_oDB</a> = null;
<a name="l00049"></a><a class="code" href="classSF__App.html#a480a834e33015cc9a001d1d84972bb12">00049</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#a480a834e33015cc9a001d1d84972bb12">$m_oUserDB</a> = null;
<a name="l00053"></a><a class="code" href="classSF__App.html#a55534a049a693ced372dba4331e5e9bd">00053</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#a55534a049a693ced372dba4331e5e9bd">$m_bEnableSonetrix</a> = <span class="keyword">true</span>;
<a name="l00057"></a><a class="code" href="classSF__App.html#a21ffd6ebc459ccba9514cbaee05b2ece">00057</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#a21ffd6ebc459ccba9514cbaee05b2ece">$m_sCmd</a> = <span class="stringliteral">&#39;show&#39;</span>;
<a name="l00058"></a>00058     <span class="comment">/***</span>
<a name="l00059"></a>00059 <span class="comment">    *@desc The IP address of the user</span>
<a name="l00060"></a>00060 <span class="comment">    */</span>
<a name="l00061"></a><a class="code" href="classSF__App.html#a2db945fecc9d0f95e19093d7829be78d">00061</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#a2db945fecc9d0f95e19093d7829be78d">$m_sIPAddr</a> = null;
<a name="l00062"></a>00062     <span class="comment">/***</span>
<a name="l00063"></a>00063 <span class="comment">    *@desc The referring IP address of the user</span>
<a name="l00064"></a>00064 <span class="comment">    */</span>
<a name="l00065"></a><a class="code" href="classSF__App.html#a251ed856d45aa28d717a012291b71d26">00065</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#a251ed856d45aa28d717a012291b71d26">$m_sReferrer</a> = null;
<a name="l00066"></a>00066     <span class="comment">/***</span>
<a name="l00067"></a>00067 <span class="comment">    *@desc Array of advertisers</span>
<a name="l00068"></a>00068 <span class="comment">    */</span>
<a name="l00069"></a><a class="code" href="classSF__App.html#a03606a66e78d358c6094f05f0857845d">00069</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#a03606a66e78d358c6094f05f0857845d">$m_arBanner</a> = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>();
<a name="l00073"></a><a class="code" href="classSF__App.html#a78a5b97e38e7a2bc9e36cca0a97a2cca">00073</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#a78a5b97e38e7a2bc9e36cca0a97a2cca">$m_eInvitePlacement</a> = SF_InvitePlacement::AfterAdd;
<a name="l00077"></a><a class="code" href="classSF__App.html#a82cc1f3844569fa451cac5abc03b1a4d">00077</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#a82cc1f3844569fa451cac5abc03b1a4d">$m_sPageAction</a> = <span class="stringliteral">&#39;home&#39;</span>;
<a name="l00078"></a>00078     <span class="comment">/***</span>
<a name="l00079"></a>00079 <span class="comment">    *@desc The current page sub-action</span>
<a name="l00080"></a>00080 <span class="comment">    */</span>
<a name="l00081"></a><a class="code" href="classSF__App.html#a980e6fd9e83172281b1e6dac50f16e9c">00081</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#a980e6fd9e83172281b1e6dac50f16e9c">$m_sPageSubAction</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00082"></a>00082     <span class="comment">/***</span>
<a name="l00083"></a>00083 <span class="comment">    *@desc The application config object</span>
<a name="l00084"></a>00084 <span class="comment">    */</span>
<a name="l00085"></a><a class="code" href="classSF__App.html#a0af2b37a09c1015be10cfa60f3f1d1b9">00085</a>     <span class="keyword">protected</span> <a class="code" href="classSF__App.html#a0af2b37a09c1015be10cfa60f3f1d1b9">$m_oConfig</a> = null;
<a name="l00086"></a>00086 
<a name="l00096"></a><a class="code" href="classSF__App.html#a00d6c37e1b068b8a5987da26d04b6059">00096</a>     function <a class="code" href="classSF__App.html#a00d6c37e1b068b8a5987da26d04b6059">__construct</a>( $iPTC, $sBaseUrl, $sAppName, $sAppId, $sAPIKey, $sAPISecret, $sProfileId = null, $oConfig = null )
<a name="l00097"></a>00097     {
<a name="l00098"></a>00098         <span class="comment">//  Get the config container loaded</span>
<a name="l00099"></a>00099         <span class="keywordflow">if</span> ( $oConfig != null )
<a name="l00100"></a>00100         {
<a name="l00101"></a>00101             $this-&gt;m_oConfig = $oConfig;
<a name="l00102"></a>00102         }
<a name="l00103"></a>00103         <span class="keywordflow">else</span>
<a name="l00104"></a>00104         {
<a name="l00105"></a>00105             $this-&gt;m_oConfig = <span class="keyword">new</span> <a class="code" href="classSF__AppConfig.html">SF_AppConfig</a>();
<a name="l00106"></a>00106 
<a name="l00107"></a>00107             <span class="comment">//  Populate container a bit...</span>
<a name="l00108"></a>00108             $this-&gt;m_oConfig-&gt;BaseUrl = $sBaseUrl;
<a name="l00109"></a>00109             $this-&gt;m_oConfig-&gt;AppName = $sAppName;
<a name="l00110"></a>00110             $this-&gt;m_oConfig-&gt;AppId = $sAppId;
<a name="l00111"></a>00111             $this-&gt;m_oConfig-&gt;APIKey = $sAPIKey;
<a name="l00112"></a>00112             $this-&gt;m_oConfig-&gt;APISecret = $sAPISecret;
<a name="l00113"></a>00113             $this-&gt;m_oConfig-&gt;AppProfileId = $sProfileId;
<a name="l00114"></a>00114             $this-&gt;m_oConfig-&gt;PTC = $iPTC;
<a name="l00115"></a>00115         }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117         <span class="comment">//  Construct a platform specific object</span>
<a name="l00118"></a>00118         $this-&gt;<a class="code" href="classSF__App.html#a87941bc6e0f9b9f2d7f1d77f9906eb08">initializePlatform</a>( $iPTC, $sBaseUrl, $sAppName, $sAppId, $sAPIKey, $sAPISecret, $sProfileId );
<a name="l00119"></a>00119 
<a name="l00120"></a>00120         <span class="comment">//  Create a new Sonetrix object...</span>
<a name="l00121"></a>00121         <span class="keywordflow">if</span> ( $this-&gt;m_bEnableSonetrix )
<a name="l00122"></a>00122         {
<a name="l00123"></a>00123             $this-&gt;m_oSntx = <span class="keyword">new</span> Sonetrix( $sAppId, $iPTC, null, null, ( $iPTC == SF_PlatformTypes::Facebook &amp;&amp; $this-&gt;m_oPFAPI-&gt;PFAPI ? $this-&gt;m_oPFAPI-&gt;PFAPI : null ), $sProfileId );
<a name="l00124"></a>00124 
<a name="l00125"></a>00125             <span class="keywordflow">if</span> ( $this-&gt;m_oSntx &amp;&amp; $this-&gt;m_oPFAPI )
<a name="l00126"></a>00126                 $this-&gt;m_oPFAPI-&gt;Sonetrix = $this-&gt;m_oSntx;
<a name="l00127"></a>00127         }
<a name="l00128"></a>00128 
<a name="l00129"></a>00129         <span class="comment">//  If we have the info in the config object, open the database...</span>
<a name="l00130"></a>00130         <span class="keywordflow">if</span> ( null != $this-&gt;m_oConfig &amp;&amp; $this-&gt;DBHost != <span class="stringliteral">&#39;&#39;</span> )
<a name="l00131"></a>00131         {
<a name="l00132"></a>00132             $this-&gt;<a class="code" href="classSF__App.html#a1a2c07721f5c3d4bcc78eb557e2dfd21">openDatabase</a>( $this-&gt;DBHost, $this-&gt;DBUser, $this-&gt;DBPass, $this-&gt;DBName, $this-&gt;UserDBClassName );
<a name="l00133"></a>00133         }
<a name="l00134"></a>00134         <span class="keywordflow">else</span>
<a name="l00135"></a>00135         {
<a name="l00136"></a>00136             <span class="comment">//  Open database if method exists...</span>
<a name="l00137"></a>00137             <span class="keywordflow">if</span> ( method_exists( $this, <span class="stringliteral">&quot;dbConnect&quot;</span> ) )
<a name="l00138"></a>00138                 $this-&gt;dbConnect();
<a name="l00139"></a>00139         }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141         <span class="comment">//  Process the query string...</span>
<a name="l00142"></a>00142         $this-&gt;<a class="code" href="classSF__App.html#aa40909289ffd00ccc071d938f586fc47">processQueryString</a>();
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144 
<a name="l00149"></a><a class="code" href="classSF__App.html#a421831a265621325e1fdd19aace0c758">00149</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a421831a265621325e1fdd19aace0c758">__destruct</a>()
<a name="l00150"></a>00150     {
<a name="l00151"></a>00151         <span class="keywordflow">if</span> ( $this-&gt;m_oDB )
<a name="l00152"></a>00152             $this-&gt;m_oDB-&gt;closeDatabase();
<a name="l00153"></a>00153     }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="comment">/***</span>
<a name="l00156"></a>00156 <span class="comment">    *@desc Initialize the platform api</span>
<a name="l00157"></a>00157 <span class="comment">    */</span>
<a name="l00158"></a><a class="code" href="classSF__App.html#a87941bc6e0f9b9f2d7f1d77f9906eb08">00158</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a87941bc6e0f9b9f2d7f1d77f9906eb08">initializePlatform</a>( $iPTC, $sBaseUrl, $sAppName, $sAppId, $sAPIKey, $sAPISecret, $sProfileId )
<a name="l00159"></a>00159     {
<a name="l00160"></a>00160         <span class="keywordflow">switch</span> ( $iPTC )
<a name="l00161"></a>00161         {
<a name="l00162"></a>00162             <span class="keywordflow">case</span> SF_PlatformTypes::Friendster:
<a name="l00163"></a>00163                 <span class="keywordflow">break</span>;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165             <span class="keywordflow">case</span> SF_PlatformTypes::MySpace:
<a name="l00166"></a>00166                 <span class="keywordflow">break</span>;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168             <span class="keywordflow">case</span> SF_PlatformTypes::Facebook:
<a name="l00169"></a>00169                 $this-&gt;m_oPFAPI = <span class="keyword">new</span> <a class="code" href="classSF__Facebook.html">SF_Facebook</a>( $sBaseUrl, $sAppName, $sAppId, $sAPIKey, $sAPISecret );
<a name="l00170"></a>00170                 <span class="keywordflow">break</span>;
<a name="l00171"></a>00171 
<a name="l00172"></a>00172             <span class="keywordflow">case</span> SF_PlatformTypes::Bebo:
<a name="l00173"></a>00173                 $this-&gt;m_oPFAPI = <span class="keyword">new</span> SF_Bebo( $sBaseUrl, $sAppName, $sAppId, $sAPIKey, $sAPISecret, $sProfileId );
<a name="l00174"></a>00174                 <span class="keywordflow">break</span>;
<a name="l00175"></a>00175         }
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177 
<a name="l00181"></a><a class="code" href="classSF__App.html#a9ad3d2905b2a50dfbee6d5f473e758a9">00181</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a9ad3d2905b2a50dfbee6d5f473e758a9">__set</a>( $sProp, $oValue )
<a name="l00182"></a>00182     {
<a name="l00183"></a>00183         <span class="keywordflow">switch</span> ( $sProp )
<a name="l00184"></a>00184         {
<a name="l00185"></a>00185             <span class="keywordflow">case</span> <span class="stringliteral">&quot;SubAction&quot;</span>:
<a name="l00186"></a>00186                 $this-&gt;m_sPageSubAction = $oValue;
<a name="l00187"></a>00187                 <span class="keywordflow">break</span>;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189             <span class="keywordflow">case</span> <span class="stringliteral">&quot;Action&quot;</span>:
<a name="l00190"></a>00190                 $this-&gt;m_sPageAction = $oValue;
<a name="l00191"></a>00191                 <span class="keywordflow">break</span>;
<a name="l00192"></a>00192         }
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194 
<a name="l00198"></a><a class="code" href="classSF__App.html#a9519b5bba407a1a89f324fcc7f26c0e2">00198</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a9519b5bba407a1a89f324fcc7f26c0e2">__get</a>( $sProp )
<a name="l00199"></a>00199     {
<a name="l00200"></a>00200         <span class="keywordflow">switch</span> ( $sProp )
<a name="l00201"></a>00201         {
<a name="l00202"></a>00202             <span class="keywordflow">case</span> <span class="stringliteral">&quot;Config&quot;</span>:
<a name="l00203"></a>00203                 <span class="keywordflow">return</span>( $this-&gt;m_oConfig );
<a name="l00204"></a>00204 
<a name="l00205"></a>00205             <span class="keywordflow">case</span> <span class="stringliteral">&quot;PFUserId&quot;</span>:
<a name="l00206"></a>00206                 <span class="keywordflow">return</span>( $this-&gt;m_oPFAPI-&gt;PFUserId );
<a name="l00207"></a>00207 
<a name="l00208"></a>00208             <span class="keywordflow">case</span> <span class="stringliteral">&quot;PFAPI&quot;</span>:
<a name="l00209"></a>00209                 <span class="keywordflow">return</span>( $this-&gt;m_oPFAPI );
<a name="l00210"></a>00210 
<a name="l00211"></a>00211             <span class="keywordflow">case</span> <span class="stringliteral">&quot;UserDB&quot;</span>:
<a name="l00212"></a>00212                 <span class="keywordflow">return</span>( $this-&gt;m_oUserDB );
<a name="l00213"></a>00213 
<a name="l00214"></a>00214             <span class="keywordflow">case</span> <span class="stringliteral">&quot;DB&quot;</span>:
<a name="l00215"></a>00215                 <span class="keywordflow">return</span>( $this-&gt;m_oDB );
<a name="l00216"></a>00216 
<a name="l00217"></a>00217             <span class="keywordflow">case</span> <span class="stringliteral">&quot;Sonetrix&quot;</span>:
<a name="l00218"></a>00218                 <span class="keywordflow">return</span>( $this-&gt;m_oSntx );
<a name="l00219"></a>00219 
<a name="l00220"></a>00220             <span class="keywordflow">case</span> <span class="stringliteral">&quot;Command&quot;</span>:
<a name="l00221"></a>00221                 <span class="keywordflow">return</span>( $this-&gt;m_sCmd );
<a name="l00222"></a>00222 
<a name="l00223"></a>00223             <span class="keywordflow">case</span> <span class="stringliteral">&quot;Action&quot;</span>:
<a name="l00224"></a>00224                 <span class="keywordflow">return</span>( $this-&gt;m_sPageAction );
<a name="l00225"></a>00225 
<a name="l00226"></a>00226             <span class="keywordflow">case</span> <span class="stringliteral">&quot;SubAction&quot;</span>:
<a name="l00227"></a>00227                 <span class="keywordflow">return</span>( $this-&gt;m_sPageSubAction );
<a name="l00228"></a>00228         }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230         <span class="comment">//  Try and get it from config object if we get here...</span>
<a name="l00231"></a>00231         <span class="keywordflow">return</span>( $this-&gt;m_oConfig-&gt;__get( $sProp ) );
<a name="l00232"></a>00232     }
<a name="l00233"></a>00233 
<a name="l00239"></a><a class="code" href="classSF__App.html#ae1ecd9ab5b45268eb8405fcd83011fb0">00239</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#ae1ecd9ab5b45268eb8405fcd83011fb0">loadPage</a>( $sPageName = <span class="stringliteral">&quot;index.php&quot;</span> )
<a name="l00240"></a>00240     {
<a name="l00241"></a>00241         <span class="comment">//  Validate the user...</span>
<a name="l00242"></a>00242         $this-&gt;<a class="code" href="classSF__App.html#a18a992b92ee5ff3ad60ec30d8e0cba60">validateUser</a>();
<a name="l00243"></a>00243 
<a name="l00244"></a>00244         <span class="comment">//  First time? Go to invite page...</span>
<a name="l00245"></a>00245         <span class="keywordflow">if</span> ( $sPageName == <span class="stringliteral">&quot;index.php&quot;</span> )
<a name="l00246"></a>00246         {
<a name="l00247"></a>00247             $this-&gt;<a class="code" href="classSF__App.html#a6deb2041e7ee4cbb3511c0f5a7ea8a03">inviteRedirect</a>();
<a name="l00248"></a>00248         }
<a name="l00249"></a>00249     }
<a name="l00250"></a>00250 
<a name="l00255"></a><a class="code" href="classSF__App.html#a1404a2a435e6df83c906a296e1c5461b">00255</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a1404a2a435e6df83c906a296e1c5461b">preRender</a>( $sPage = <span class="stringliteral">&quot;index.php&quot;</span> )
<a name="l00256"></a>00256     {
<a name="l00257"></a>00257         <span class="comment">//  Track the hit...</span>
<a name="l00258"></a>00258         $this-&gt;<a class="code" href="classSF__App.html#a06cc1f1b035e423dce27f7db925a17c0">trackPageView</a>( $sPage );
<a name="l00259"></a>00259 
<a name="l00260"></a>00260         <span class="keywordflow">if</span> ( $this-&gt;m_oSntx )
<a name="l00261"></a>00261             echo <span class="stringliteral">&quot;&lt;!-- huid &quot;</span> . $this-&gt;m_oSntx-&gt;getHashUID() . <span class="stringliteral">&quot; --&gt;&quot;</span>;
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263 
<a name="l00268"></a><a class="code" href="classSF__App.html#a79f6c757cc35a847495f9254503dfa8f">00268</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a79f6c757cc35a847495f9254503dfa8f">render</a>( $sPage = <span class="stringliteral">&quot;index.php&quot;</span>, $iTitle = <span class="stringliteral">&quot;1&quot;</span> )
<a name="l00269"></a>00269     {
<a name="l00270"></a>00270         $this-&gt;<a class="code" href="classSF__App.html#a1404a2a435e6df83c906a296e1c5461b">preRender</a>( $sPage );
<a name="l00271"></a>00271 
<a name="l00272"></a>00272         <span class="comment">//  Spit out GA code...</span>
<a name="l00273"></a>00273         <span class="keywordflow">if</span> ( null != $this-&gt;m_oPFAPI &amp;&amp; method_exists( $this-&gt;m_oPFAPI, <span class="stringliteral">&quot;render&quot;</span> ) )
<a name="l00274"></a>00274             $this-&gt;m_oPFAPI-&gt;render( $sPage, $iTitle );
<a name="l00275"></a>00275     }
<a name="l00276"></a>00276 
<a name="l00285"></a><a class="code" href="classSF__App.html#a1a2c07721f5c3d4bcc78eb557e2dfd21">00285</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a1a2c07721f5c3d4bcc78eb557e2dfd21">openDatabase</a>( $sDBHost, $sDBUser, $sDBPass, $sDBName, $sUserDBClassName = null )
<a name="l00286"></a>00286     {
<a name="l00287"></a>00287         $this-&gt;m_oUserDB = null;
<a name="l00288"></a>00288         $this-&gt;m_oDB = <span class="keyword">new</span> <a class="code" href="classSF__Database.html">SF_Database</a>( $sDBHost, $sDBUser, $sDBPass, $sDBName, <span class="keyword">true</span> );
<a name="l00289"></a>00289 
<a name="l00290"></a>00290         <span class="keywordflow">if</span> ( $sUserDBClassName != null )
<a name="l00291"></a>00291         {
<a name="l00292"></a>00292             <span class="keywordflow">try</span>
<a name="l00293"></a>00293             {
<a name="l00294"></a>00294                 require_once( $sUserDBClassName . <span class="stringliteral">&quot;.php&quot;</span> );
<a name="l00295"></a>00295                 $this-&gt;m_oUserDB = <span class="keyword">new</span> $sUserDBClassName( $this-&gt;m_oDB, $this-&gt;m_oPFAPI-&gt;AppId, $this-&gt;m_oPFAPI-&gt;getPFType(), $this-&gt;m_oSntx, $this-&gt;m_oPFAPI );
<a name="l00296"></a>00296 
<a name="l00297"></a>00297                 <span class="comment">//  Set user database in platform api...</span>
<a name="l00298"></a>00298                 <span class="keywordflow">if</span> ( $this-&gt;m_oPFAPI &amp;&amp; $this-&gt;m_oUserDB )
<a name="l00299"></a>00299                     $this-&gt;m_oPFAPI-&gt;UserDB = $this-&gt;m_oUserDB;
<a name="l00300"></a>00300             }
<a name="l00301"></a>00301             <span class="keywordflow">catch</span> ( Exception $_ex )
<a name="l00302"></a>00302             {
<a name="l00303"></a>00303                 <span class="comment">//  No user database available...</span>
<a name="l00304"></a>00304             }
<a name="l00305"></a>00305         }
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308     <span class="comment">/***</span>
<a name="l00309"></a>00309 <span class="comment">    *@desc Validates the user...</span>
<a name="l00310"></a>00310 <span class="comment">    */</span>
<a name="l00311"></a><a class="code" href="classSF__App.html#a18a992b92ee5ff3ad60ec30d8e0cba60">00311</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a18a992b92ee5ff3ad60ec30d8e0cba60">validateUser</a>( $bRequireFrame = <span class="keyword">true</span>, $bRequireAdd = <span class="keyword">true</span>, $bRequireLogin = <span class="keyword">false</span>, $bUsePrefs = <span class="keyword">true</span>, $bAddUser = <span class="keyword">true</span> )
<a name="l00312"></a>00312     {
<a name="l00313"></a>00313         <span class="keywordflow">if</span> ( $this-&gt;m_oPFAPI )
<a name="l00314"></a>00314             $this-&gt;m_oPFAPI-&gt;validateUser( $bRequireFrame, $bRequireAdd, $bRequireLogin, $bUsePrefs, $bAddUser );
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <span class="comment">//  Let the user database have a look</span>
<a name="l00317"></a>00317         <span class="keywordflow">if</span> ( $this-&gt;m_oUserDB &amp;&amp; method_exists( $this-&gt;m_oUserDB, <span class="stringliteral">&quot;processQueryString&quot;</span> ) )
<a name="l00318"></a>00318             $this-&gt;m_oUserDB-&gt;processQueryString( $this-&gt;m_oPFAPI-&gt;PFUserId );
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320 
<a name="l00325"></a><a class="code" href="classSF__App.html#aa40909289ffd00ccc071d938f586fc47">00325</a>     <span class="keyword">protected</span> function <a class="code" href="classSF__App.html#aa40909289ffd00ccc071d938f586fc47">processQueryString</a>()
<a name="l00326"></a>00326     {
<a name="l00327"></a>00327         <span class="keywordflow">if</span> ( isset( $_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>] ) )
<a name="l00328"></a>00328             $this-&gt;m_sReferrer = $_SERVER[<span class="stringliteral">&#39;HTTP_REFERER&#39;</span>];
<a name="l00329"></a>00329 
<a name="l00330"></a>00330         <span class="comment">//  Default values...</span>
<a name="l00331"></a>00331         $this-&gt;m_sIPAddr = $_SERVER[<span class="stringliteral">&#39;REMOTE_ADDR&#39;</span>];
<a name="l00332"></a>00332 
<a name="l00333"></a>00333         <span class="comment">//  What&#39;s this page&#39;s command?</span>
<a name="l00334"></a>00334         <span class="keywordflow">if</span> ( isset( $_REQUEST[<span class="stringliteral">&quot;c&quot;</span>] ) )
<a name="l00335"></a>00335             $this-&gt;<a class="code" href="classSF__App.html#ac5e7c32ce7cbcf1f9f6e8684e8cefa5f">processAppCommands</a>();
<a name="l00336"></a>00336 
<a name="l00337"></a>00337         <span class="comment">//  Any page actions?</span>
<a name="l00338"></a>00338         <span class="keywordflow">if</span> ( isset( $_REQUEST[ <span class="stringliteral">&#39;action&#39;</span> ] ) )
<a name="l00339"></a>00339             $this-&gt;m_sPageAction = $_REQUEST[ <span class="stringliteral">&#39;action&#39;</span> ];
<a name="l00340"></a>00340 
<a name="l00341"></a>00341         <span class="comment">//  Any page sub-actions?</span>
<a name="l00342"></a>00342         <span class="keywordflow">if</span> ( isset( $_REQUEST[ <span class="stringliteral">&#39;sa&#39;</span> ] ) )
<a name="l00343"></a>00343             $this-&gt;m_sPageSubAction = $_REQUEST[ <span class="stringliteral">&#39;sa&#39;</span> ];
<a name="l00344"></a>00344 
<a name="l00345"></a>00345         <span class="comment">//  Let the platform take a look at the query string...</span>
<a name="l00346"></a>00346         <span class="keywordflow">if</span> ( $this-&gt;m_oPFAPI &amp;&amp; method_exists( $this-&gt;m_oPFAPI, <span class="stringliteral">&quot;processQueryString&quot;</span> ) )
<a name="l00347"></a>00347             $this-&gt;m_oPFAPI-&gt;processQueryString();
<a name="l00348"></a>00348 
<a name="l00349"></a>00349         <span class="comment">//  Let sonetrix have a look at the query string...</span>
<a name="l00350"></a>00350         <span class="keywordflow">if</span> ( $this-&gt;m_bEnableSonetrix &amp;&amp; $this-&gt;m_oSntx &amp;&amp; $this-&gt;m_oPFAPI &amp;&amp; method_exists( $this-&gt;m_oSntx, <span class="stringliteral">&quot;processQueryString&quot;</span> ) )
<a name="l00351"></a>00351             $this-&gt;m_oSntx-&gt;processQueryString( $this-&gt;m_oPFAPI-&gt;PFUserId );
<a name="l00352"></a>00352 
<a name="l00353"></a>00353         <span class="comment">//  Return page command...</span>
<a name="l00354"></a>00354         <span class="keywordflow">return</span>( $this-&gt;m_sCmd );
<a name="l00355"></a>00355     }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="comment">/***</span>
<a name="l00358"></a>00358 <span class="comment">    *@desc Process special app commands (&#39;c&#39;)</span>
<a name="l00359"></a>00359 <span class="comment">    */</span>
<a name="l00360"></a><a class="code" href="classSF__App.html#ac5e7c32ce7cbcf1f9f6e8684e8cefa5f">00360</a>     <span class="keyword">protected</span> function <a class="code" href="classSF__App.html#ac5e7c32ce7cbcf1f9f6e8684e8cefa5f">processAppCommands</a>()
<a name="l00361"></a>00361     {
<a name="l00362"></a>00362         <span class="comment">//  Store it...</span>
<a name="l00363"></a>00363         $this-&gt;m_sCmd = $_REQUEST[ <span class="charliteral">&#39;c&#39;</span> ];
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         <span class="comment">//  Deal with screwy facebook bug where they don&#39;t parse url properly</span>
<a name="l00366"></a>00366         <span class="keywordflow">if</span> ( substr( $this-&gt;m_sCmd, 0, 7 ) == <span class="stringliteral">&#39;addhttp&#39;</span> )
<a name="l00367"></a>00367         {
<a name="l00368"></a>00368             $_sUrl = substr( $this-&gt;m_sCmd, 3 );
<a name="l00369"></a>00369             $this-&gt;<a class="code" href="classSF__App.html#a83d6db3f4e5f36ddd8adad2f53133e76">redirect</a>( $this-&gt;PFAPI-&gt;AppUrl . <span class="stringliteral">&#39;?c=add&amp;auth_token=&#39;</span> . $_REQUEST[<span class="stringliteral">&#39;auth_token&#39;</span>] . <span class="stringliteral">&#39;&amp;installed=1&amp;refuid=&#39;</span> . ( isset( $_REQUEST[<span class="stringliteral">&#39;refuid&#39;</span>] ) ? $_REQUEST[<span class="stringliteral">&#39;refuid&#39;</span>] : <span class="stringliteral">&#39;&#39;</span> ) );
<a name="l00370"></a>00370         }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372         <span class="comment">//  Process a ping request</span>
<a name="l00373"></a>00373         <span class="keywordflow">if</span> ( $this-&gt;m_sCmd == <span class="stringliteral">&#39;ping&#39;</span> )
<a name="l00374"></a>00374         {
<a name="l00375"></a>00375             echo <span class="stringliteral">&#39;pong&#39;</span>;
<a name="l00376"></a>00376             exit;
<a name="l00377"></a>00377         }
<a name="l00378"></a>00378 
<a name="l00379"></a>00379         <span class="comment">//  Handle app removal here...</span>
<a name="l00380"></a>00380         <span class="keywordflow">if</span> ( $this-&gt;m_sCmd == <span class="stringliteral">&quot;del&quot;</span> )
<a name="l00381"></a>00381         {
<a name="l00382"></a>00382             <span class="keywordflow">if</span> ( $this-&gt;m_oUserDB != null )
<a name="l00383"></a>00383             {
<a name="l00384"></a>00384                 <span class="comment">//  If user is in database, remove him/her</span>
<a name="l00385"></a>00385                 <span class="keywordflow">if</span> ( $this-&gt;UserDB-&gt;userIsInDB( $this-&gt;PFUserId ) )
<a name="l00386"></a>00386                 {
<a name="l00387"></a>00387                     $this-&gt;UserDB-&gt;removeApp( $this-&gt;PFUserId );
<a name="l00388"></a>00388                     echo <span class="stringliteral">&quot;RFD&quot;</span>;
<a name="l00389"></a>00389                 }
<a name="l00390"></a>00390                 <span class="keywordflow">else</span>
<a name="l00391"></a>00391                     echo <span class="stringliteral">&quot;NID&quot;</span>;
<a name="l00392"></a>00392             }
<a name="l00393"></a>00393             <span class="keywordflow">else</span>
<a name="l00394"></a>00394                 echo <span class="stringliteral">&quot;NOD&quot;</span>;
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 
<a name="l00397"></a>00397             <span class="comment">//  Now bail...</span>
<a name="l00398"></a>00398             exit;
<a name="l00399"></a>00399         }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402 
<a name="l00408"></a><a class="code" href="classSF__App.html#a245ca49c58ae5e1c2efcdea0369d5b22">00408</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a245ca49c58ae5e1c2efcdea0369d5b22">getCurrentCommand</a>()
<a name="l00409"></a>00409     {
<a name="l00410"></a>00410         <span class="keywordflow">return</span>( $this-&gt;m_sCmd );
<a name="l00411"></a>00411     }
<a name="l00412"></a>00412 
<a name="l00419"></a><a class="code" href="classSF__App.html#aac5925714018c3a661eba69a737d6597">00419</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#aac5925714018c3a661eba69a737d6597">isPageCommand</a>( $sCmd )
<a name="l00420"></a>00420     {
<a name="l00421"></a>00421         <span class="keywordflow">return</span>( strtolower( $this-&gt;m_sCmd ) == strtolower( $sCmd ) );
<a name="l00422"></a>00422     }
<a name="l00423"></a>00423 
<a name="l00430"></a><a class="code" href="classSF__App.html#a06cc1f1b035e423dce27f7db925a17c0">00430</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a06cc1f1b035e423dce27f7db925a17c0">trackPageView</a>( $sPage )
<a name="l00431"></a>00431     {
<a name="l00432"></a>00432         <span class="keywordflow">if</span> ( $this-&gt;m_bEnableSonetrix &amp;&amp; $this-&gt;m_oSntx )
<a name="l00433"></a>00433             $this-&gt;m_oSntx-&gt;user_pageView( $this-&gt;PFUserId, $sPage );
<a name="l00434"></a>00434     }
<a name="l00435"></a>00435 
<a name="l00440"></a><a class="code" href="classSF__App.html#a6deb2041e7ee4cbb3511c0f5a7ea8a03">00440</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a6deb2041e7ee4cbb3511c0f5a7ea8a03">inviteRedirect</a>()
<a name="l00441"></a>00441     {
<a name="l00442"></a>00442         <span class="keywordflow">if</span> ( $this-&gt;m_eInvitePlacement == SF_InvitePlacement::AfterAdd &amp;&amp; isset( $_REQUEST[<span class="stringliteral">&#39;installed&#39;</span>] ) &amp;&amp; $_REQUEST[<span class="stringliteral">&#39;installed&#39;</span>] == <span class="charliteral">&#39;1&#39;</span> )
<a name="l00443"></a>00443         {
<a name="l00444"></a>00444             <span class="comment">//  No user database? Ping sonetrix with addition</span>
<a name="l00445"></a>00445             <span class="keywordflow">if</span> ( ! $this-&gt;UserDB &amp;&amp; $this-&gt;m_oSntx )
<a name="l00446"></a>00446                 $this-&gt;m_oSntx-&gt;setHashUID( $this-&gt;m_oSntx-&gt;user_install( $this-&gt;m_oPFAPI-&gt;PFUserId, $this-&gt;m_oPFAPI-&gt;getSessionKey() ) );
<a name="l00447"></a>00447 
<a name="l00448"></a>00448             $this-&gt;<a class="code" href="classSF__App.html#a83d6db3f4e5f36ddd8adad2f53133e76">redirect</a>( $this-&gt;m_oPFAPI-&gt;AppUrl . <span class="stringliteral">&quot;invite.php&quot;</span> );
<a name="l00449"></a>00449         }
<a name="l00450"></a>00450     }
<a name="l00451"></a>00451 
<a name="l00452"></a>00452     <span class="comment">/***</span>
<a name="l00453"></a>00453 <span class="comment">    *@desc generic redirect</span>
<a name="l00454"></a>00454 <span class="comment">    */</span>
<a name="l00455"></a><a class="code" href="classSF__App.html#a83d6db3f4e5f36ddd8adad2f53133e76">00455</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a83d6db3f4e5f36ddd8adad2f53133e76">redirect</a>( $sUrl )
<a name="l00456"></a>00456     {
<a name="l00457"></a>00457         $this-&gt;m_oPFAPI-&gt;redirect( $sUrl );
<a name="l00458"></a>00458     }
<a name="l00459"></a>00459 
<a name="l00465"></a><a class="code" href="classSF__App.html#acf7865241ab5ac45a0f04674efe51d1a">00465</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#acf7865241ab5ac45a0f04674efe51d1a">getInviteeList</a>()
<a name="l00466"></a>00466     {
<a name="l00467"></a>00467         <span class="keywordflow">if</span> ( $this-&gt;m_bEnableSonetrix &amp;&amp; $this-&gt;m_oSntx )
<a name="l00468"></a>00468             <span class="keywordflow">return</span>( $this-&gt;m_oSntx-&gt;user_getInvitees( $this-&gt;PFUserId ) );
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471     <span class="comment">/***</span>
<a name="l00472"></a>00472 <span class="comment">    *@desc Adds an ad vendor to the application</span>
<a name="l00473"></a>00473 <span class="comment">    */</span>
<a name="l00474"></a><a class="code" href="classSF__App.html#af12c69561c23be5e6fc7e4e0a2808fbb">00474</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#af12c69561c23be5e6fc7e4e0a2808fbb">addAdVendor</a>( $iAVC, $sIds )
<a name="l00475"></a>00475     {
<a name="l00476"></a>00476         $this-&gt;m_arBanner[ $iAVC ] = <span class="keyword">new</span> SF_BannerAd( $iAVC, explode(<span class="charliteral">&#39;,&#39;</span>,$sIds) );
<a name="l00477"></a>00477     }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479     <span class="comment">/***</span>
<a name="l00480"></a>00480 <span class="comment">    * @desc Set ref urls for an app</span>
<a name="l00481"></a>00481 <span class="comment">    */</span>
<a name="l00482"></a><a class="code" href="classSF__App.html#a3978cc0d9152ece4cd315601a95a38bd">00482</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a3978cc0d9152ece4cd315601a95a38bd">setRefHandle</a>( $sFBML )
<a name="l00483"></a>00483     {
<a name="l00484"></a>00484         $this-&gt;m_oPFAPI-&gt;setRefHandle( $sFBML );
<a name="l00485"></a>00485     }
<a name="l00486"></a>00486 
<a name="l00492"></a><a class="code" href="classSF__App.html#a99e97980251298d31efe3451470e8df5">00492</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#a99e97980251298d31efe3451470e8df5">getAdCode</a>( $iAVC = null, $eType = SF_AdType::Banner )
<a name="l00493"></a>00493     {
<a name="l00494"></a>00494         $sOut = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00495"></a>00495 
<a name="l00496"></a>00496         <span class="keywordflow">if</span> ( isset( $this-&gt;m_arBanner[ $iAVC ] ) )
<a name="l00497"></a>00497             $sOut = $this-&gt;m_arBanner[ $iAVC ]-&gt;getAdCode( $this-&gt;m_oPFAPI-&gt;getPFType(), $eType );
<a name="l00498"></a>00498         <span class="keywordflow">else</span>
<a name="l00499"></a>00499         {
<a name="l00500"></a>00500             <span class="keywordflow">foreach</span> ( $this-&gt;m_arBanner as $sKey =&gt; $oValue )
<a name="l00501"></a>00501                 $sOut = $oValue-&gt;getAdCode( $this-&gt;m_oPFAPI-&gt;getPFType(), $eType );
<a name="l00502"></a>00502         }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504         <span class="keywordflow">return</span>( $sOut );
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506     
<a name="l00507"></a><a class="code" href="classSF__App.html#ac409888924f803214fbd2df44327242b">00507</a>     <span class="keyword">public</span> function <a class="code" href="classSF__App.html#ac409888924f803214fbd2df44327242b">publishTemplate</a>( $sBundleId = null, &amp;$arBundleData = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(), $arTargetIds = null )
<a name="l00508"></a>00508     {
<a name="l00509"></a>00509         $_sBundleId = $sBundleId;
<a name="l00510"></a>00510         $_sAppUrl = $this-&gt;PFAPI-&gt;AppUrl;
<a name="l00511"></a>00511         
<a name="l00512"></a>00512         <span class="keywordflow">try</span>
<a name="l00513"></a>00513         {
<a name="l00514"></a>00514             <span class="comment">//  See if we can get the bundle id for this app...</span>
<a name="l00515"></a>00515             <span class="keywordflow">if</span> ( $sBundleId == null )
<a name="l00516"></a>00516             {
<a name="l00517"></a>00517                 <span class="keywordflow">if</span> ( $arBundle = $this-&gt;PFAPI-&gt;getRegisteredBundles() )
<a name="l00518"></a>00518                 {
<a name="l00519"></a>00519                     <span class="comment">//  Get the bundle id...</span>
<a name="l00520"></a>00520                     $_sBundleId = isset( $arBundle, $arBundle[ 0 ], $arBundle[ 0 ][ <span class="stringliteral">&#39;template_bundle_id&#39;</span> ] ) ? $arBundle[0][<span class="stringliteral">&#39;template_bundle_id&#39;</span>] : null;
<a name="l00521"></a>00521                     error_log( <span class="stringliteral">&#39;Found registered bundle id &#39;</span> . $_sBundleId . <span class="stringliteral">&#39; for app [&#39;</span> . $this-&gt;getQuizName() . <span class="charliteral">&#39;]&#39;</span> );
<a name="l00522"></a>00522                 }
<a name="l00523"></a>00523                 <span class="keywordflow">else</span>
<a name="l00524"></a>00524                 {
<a name="l00525"></a>00525                     <span class="comment">//  Create a default quiz bundle...</span>
<a name="l00526"></a>00526                     $arOneLine = $arShort = $arAction = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>();
<a name="l00527"></a>00527                     $arOneLine[] = <span class="stringliteral">&#39;{*actor*} just took the {*quiz_name*} quiz and the result was {*quiz_result_name*}.&#39;</span>;
<a name="l00528"></a>00528                     
<a name="l00529"></a>00529                     $arShort[] = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( 
<a name="l00530"></a>00530                         <span class="stringliteral">&#39;template_title&#39;</span> =&gt; <span class="stringliteral">&#39;{*actor*} just took the {*quiz_name*} quiz and the result was {*quiz_result_name*}.&#39;</span>,
<a name="l00531"></a>00531                         <span class="stringliteral">&#39;template_body&#39;</span> =&gt; <span class="stringliteral">&#39;{*quiz_result_full*}&#39;</span>,
<a name="l00532"></a>00532                     );
<a name="l00533"></a>00533             
<a name="l00534"></a>00534                     $arAction[] = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( <span class="stringliteral">&#39;text&#39;</span> =&gt; <span class="stringliteral">&#39;Take the quiz!&#39;</span>, <span class="stringliteral">&#39;href&#39;</span> =&gt; $this-&gt;PFAPI-&gt;AppUrl );
<a name="l00535"></a>00535                     <span class="keywordflow">if</span> ( $this-&gt;m_sFanPageUrl ) $arAction[] = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( <span class="stringliteral">&#39;text&#39;</span> =&gt; <span class="stringliteral">&#39;Become a fan!&#39;</span>, <span class="stringliteral">&#39;href&#39;</span> =&gt; $this-&gt;m_sFanPageUrl );
<a name="l00536"></a>00536                     
<a name="l00537"></a>00537                     $_sBundleId = $this-&gt;PFAPI-&gt;registerBundle( $arOneLine, $arShort, null, $arLinks );
<a name="l00538"></a>00538                     error_log( <span class="stringliteral">&#39;Registered bundle id &#39;</span> . $_sBundleId . <span class="stringliteral">&#39; for app [&#39;</span> . $this-&gt;getQuizName() . <span class="charliteral">&#39;]&#39;</span> );
<a name="l00539"></a>00539                 }
<a name="l00540"></a>00540             }
<a name="l00541"></a>00541             
<a name="l00542"></a>00542             <span class="comment">//  Do we have a bundle to publish?</span>
<a name="l00543"></a>00543             <span class="keywordflow">if</span> ( $_sBundleId )
<a name="l00544"></a>00544             {
<a name="l00545"></a>00545                 <span class="comment">//  Create array...</span>
<a name="l00546"></a>00546                 <span class="keywordflow">if</span> ( ! <span class="keyword">sizeof</span>( $arBundleData ) )
<a name="l00547"></a>00547                 {
<a name="l00548"></a>00548                     $arBundleData = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00549"></a>00549                         <span class="stringliteral">&#39;quiz_name&#39;</span> =&gt; <span class="stringliteral">&quot;&amp;quot;&lt;a href=\&quot;{$_sAppUrl}\&quot;&gt;{$this-&gt;m_sQuizName}&lt;/a&gt;&amp;quot;&quot;</span>,
<a name="l00550"></a>00550                         <span class="stringliteral">&#39;quiz_result_name&#39;</span> =&gt; <span class="stringliteral">&quot;&amp;quot;&lt;a href=\&quot;{$_sAppUrl}\&quot;&gt;{$this-&gt;m_oResult-&gt;FullName}&lt;/a&gt;&amp;quot;&quot;</span>,
<a name="l00551"></a>00551                         <span class="stringliteral">&#39;quiz_result_full&#39;</span> =&gt; $this-&gt;m_oResult-&gt;Description . <span class="stringliteral">&quot;&lt;br /&gt;&lt;br /&gt;&lt;a href=\&quot;{$_sAppUrl}\&quot;&gt;Why not take the quiz yourself?&lt;/a&gt;&quot;</span>,
<a name="l00552"></a>00552                         <span class="stringliteral">&#39;images&#39;</span> =&gt; <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( <span class="stringliteral">&#39;src&#39;</span> =&gt; $this-&gt;m_oResult-&gt;ImageUrl, <span class="stringliteral">&#39;href&#39;</span> =&gt; $_sAppUrl ) ),
<a name="l00553"></a>00553                     );
<a name="l00554"></a>00554                 }
<a name="l00555"></a>00555                     
<a name="l00556"></a>00556                 <span class="comment">//  Publish action to feed...</span>
<a name="l00557"></a>00557                 $sResult = $this-&gt;PFAPI-&gt;publishBundle( $_sBundleId, $arBundleData, $arTargetIds, null, 2 );
<a name="l00558"></a>00558             }
<a name="l00559"></a>00559         }
<a name="l00560"></a>00560         <span class="keywordflow">catch</span> ( Exception $_ex )
<a name="l00561"></a>00561         {
<a name="l00562"></a>00562             error_log( <span class="stringliteral">&#39;Error publishing bundle id &#39;</span> . $_sBundleId . <span class="stringliteral">&#39;: &#39;</span> . $_ex-&gt;getMessage() );
<a name="l00563"></a>00563         }
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Mar 24 2011 20:11:38 for "The Yii Extension Library Of Doom!" by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
