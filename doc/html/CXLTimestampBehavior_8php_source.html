<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>YiiXL -- The Yii Extension Library Of Doom!: CXLTimestampBehavior.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
  <div class="navpath">
    <ul>
      <li><a class="el" href="dir_1ec655711e29b55f31ff264c2bb65c33.html">usr</a>      </li>
      <li><a class="el" href="dir_6bb76cc6f95ff18987242ff417c6ce46.html">local</a>      </li>
      <li><a class="el" href="dir_c5bf51a4bce5f6288acec49aaf0c7f09.html">yiixl</a>      </li>
      <li><a class="el" href="dir_61700af67871dcbdf05fae1643014cc7.html">lib</a>      </li>
      <li><a class="el" href="dir_1fe0dc3b670ebeef3b7eceb42bf96cab.html">core</a>      </li>
      <li><a class="el" href="dir_7698770312b1c9dcc5505d70d6e88f90.html">behaviors</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>CXLTimestampBehavior.php</h1>  </div>
</div>
<div class="contents">
<a href="CXLTimestampBehavior_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00028"></a><a class="code" href="classCXLTimeStampBehavior.html">00028</a> <span class="keyword">class </span><a class="code" href="classCXLTimeStampBehavior.html">CXLTimeStampBehavior</a> <span class="keyword">extends</span> <a class="code" href="classCXLActiveRecordBehavior.html" title="CXLActiveRecordBehavior The base class for all AR behaviors in the YiiXL system.">CXLActiveRecordBehavior</a>
<a name="l00029"></a>00029 {
<a name="l00030"></a>00030   <span class="comment">//********************************************************************************</span>
<a name="l00031"></a>00031   <span class="comment">//* Member Variables</span>
<a name="l00032"></a>00032   <span class="comment">//********************************************************************************</span>
<a name="l00033"></a>00033 
<a name="l00037"></a><a class="code" href="classCXLTimeStampBehavior.html#a99123cf87dc35241fa4de90963dfcb55">00037</a>   <span class="keyword">protected</span> <a class="code" href="classCXLTimeStampBehavior.html#a99123cf87dc35241fa4de90963dfcb55">$_createdColumnName</a> = null;
<a name="l00038"></a><a class="code" href="classCXLTimeStampBehavior.html#af4acef2afbd2be93afee6dcc132b5634">00038</a>   <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#af4acef2afbd2be93afee6dcc132b5634">getCreatedColumnName</a>() { <span class="keywordflow">return</span> $this-&gt;_createdColumnName; }
<a name="l00039"></a><a class="code" href="classCXLTimeStampBehavior.html#aefa0bd89eae6e37ce37bca6738781c61">00039</a>   <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#aefa0bd89eae6e37ce37bca6738781c61">setCreatedColumnName</a>( $sValue ) { $this-&gt;_createdColumnName = $sValue; }
<a name="l00040"></a>00040 
<a name="l00044"></a><a class="code" href="classCXLTimeStampBehavior.html#a1cc2ac641f86886d76944efce3a63bd9">00044</a>   <span class="keyword">protected</span> <a class="code" href="classCXLTimeStampBehavior.html#a1cc2ac641f86886d76944efce3a63bd9">$_createdByColumnName</a> = null;
<a name="l00045"></a><a class="code" href="classCXLTimeStampBehavior.html#a14d422fab23670511b207155a0657557">00045</a>   <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#a14d422fab23670511b207155a0657557">getCreatedByColumnName</a>() { <span class="keywordflow">return</span> $this-&gt;_createdByColumnName; }
<a name="l00046"></a><a class="code" href="classCXLTimeStampBehavior.html#af3cf22407098fb8c99099ace3f51fa16">00046</a>   <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#af3cf22407098fb8c99099ace3f51fa16">setCreatedByColumnName</a>( $sValue ) { $this-&gt;_createdByColumnName = $sValue; }
<a name="l00047"></a>00047 
<a name="l00051"></a><a class="code" href="classCXLTimeStampBehavior.html#a8f1b45a01bfe979c5ae98050cfcf804f">00051</a>   <span class="keyword">protected</span> <a class="code" href="classCXLTimeStampBehavior.html#a8f1b45a01bfe979c5ae98050cfcf804f">$_lastModifiedColumnName</a> = null;
<a name="l00052"></a><a class="code" href="classCXLTimeStampBehavior.html#a0905d98612ed716b9368a0e0ac5e5aeb">00052</a>   <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#a0905d98612ed716b9368a0e0ac5e5aeb">getLastModifiedColumnName</a>() { <span class="keywordflow">return</span> $this-&gt;_lastModifiedColumnName; }
<a name="l00053"></a><a class="code" href="classCXLTimeStampBehavior.html#aa43f21092ab8266b9991a5399ec94c44">00053</a>   <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#aa43f21092ab8266b9991a5399ec94c44">setLastModifiedColumnName</a>( $sValue ) { $this-&gt;_lastModifiedColumnName = $sValue; }
<a name="l00054"></a>00054 
<a name="l00058"></a><a class="code" href="classCXLTimeStampBehavior.html#a8aed01de613f89819b5268c88f933969">00058</a>   <span class="keyword">protected</span> <a class="code" href="classCXLTimeStampBehavior.html#a8aed01de613f89819b5268c88f933969">$_lastModifiedByColumnName</a> = null;
<a name="l00059"></a><a class="code" href="classCXLTimeStampBehavior.html#a3f2fd113a089ac3e6523c758c5452d64">00059</a>   <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#a3f2fd113a089ac3e6523c758c5452d64">getLastModifiedByColumnName</a>() { <span class="keywordflow">return</span> $this-&gt;_lastModifiedByColumnName; }
<a name="l00060"></a><a class="code" href="classCXLTimeStampBehavior.html#add7a6532e6d878ba7a4446657a2b3b5d">00060</a>   <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#add7a6532e6d878ba7a4446657a2b3b5d">setLastModifiedByColumnName</a>( $sValue ) { $this-&gt;_lastModifiedByColumnName = $sValue; }
<a name="l00061"></a>00061 
<a name="l00065"></a><a class="code" href="classCXLTimeStampBehavior.html#a32224a162adf0502123d01d3fcbbcce7">00065</a>   <span class="keyword">protected</span> <a class="code" href="classCXLTimeStampBehavior.html#a32224a162adf0502123d01d3fcbbcce7">$_dateTimeFunction</a> = null;
<a name="l00066"></a><a class="code" href="classCXLTimeStampBehavior.html#a256dd113f3eddd49910867cd68ec8fc3">00066</a>   <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#a256dd113f3eddd49910867cd68ec8fc3">getDateTimeFunction</a>() { <span class="keywordflow">return</span> $this-&gt;_dateTimeFunction; }
<a name="l00067"></a><a class="code" href="classCXLTimeStampBehavior.html#aefc5940715628851cc5f6a8c0889b9cd">00067</a>   <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#aefc5940715628851cc5f6a8c0889b9cd">setDateTimeFunction</a>( $sValue ) { $this-&gt;_dateTimeFunction = $sValue; }
<a name="l00068"></a>00068 
<a name="l00069"></a>00069   <span class="comment">//********************************************************************************</span>
<a name="l00070"></a>00070   <span class="comment">//*  Event Handlers</span>
<a name="l00071"></a>00071   <span class="comment">//********************************************************************************</span>
<a name="l00072"></a>00072 
<a name="l00077"></a><a class="code" href="classCXLTimeStampBehavior.html#a586e177c0e7073ec63f7ccd6546ff3fd">00077</a>   <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#a586e177c0e7073ec63f7ccd6546ff3fd" title="Timestamps row.">beforeValidate</a>( $event )
<a name="l00078"></a>00078   {
<a name="l00079"></a>00079     <span class="comment">//  Handle created stamp</span>
<a name="l00080"></a>00080     <span class="keywordflow">if</span> ( $event-&gt;sender-&gt;isNewRecord )
<a name="l00081"></a>00081     {
<a name="l00082"></a>00082       <span class="keywordflow">if</span> ( $this-&gt;_createdColumnName &amp;&amp; $event-&gt;sender-&gt;hasAttribute( $this-&gt;_createdColumnName ) )
<a name="l00083"></a>00083         $this-&gt;getOwner()-&gt;setAttribute( $this-&gt;_createdColumnName, ( null === $this-&gt;_dateTimeFunction ) ? date(<span class="stringliteral">&#39;Y-m-d H:i:s&#39;</span>) : eval(<span class="stringliteral">&#39;return &#39;</span> . $this-&gt;_dateTimeFunction . <span class="charliteral">&#39;;&#39;</span>) );
<a name="l00084"></a>00084 
<a name="l00085"></a>00085       <span class="keywordflow">if</span> ( $this-&gt;_createdByColumnName &amp;&amp; $event-&gt;sender-&gt;hasAttribute( $this-&gt;_createdByColumnName ) &amp;&amp; ! $event-&gt;sender-&gt;getAttribute( $this-&gt;_createdByColumnName ) )
<a name="l00086"></a>00086         $this-&gt;getOwner()-&gt;setAttribute( $this-&gt;_createdByColumnName, Yii::app()-&gt;user-&gt;getId() );
<a name="l00087"></a>00087     }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <span class="comment">//  Handle lmod stamp</span>
<a name="l00090"></a>00090     <span class="keywordflow">if</span> ( $this-&gt;_lastModifiedColumnName &amp;&amp; $event-&gt;sender-&gt;hasAttribute( $this-&gt;_lastModifiedColumnName ) )
<a name="l00091"></a>00091         $this-&gt;getOwner()-&gt;setAttribute( $this-&gt;_lastModifiedColumnName, ( null === $this-&gt;_dateTimeFunction ) ? date(<span class="stringliteral">&#39;Y-m-d H:i:s&#39;</span>) : eval(<span class="stringliteral">&#39;return &#39;</span> . $this-&gt;_dateTimeFunction . <span class="charliteral">&#39;;&#39;</span>) );
<a name="l00092"></a>00092 
<a name="l00093"></a>00093     <span class="comment">//  Handle user id stamp</span>
<a name="l00094"></a>00094     <span class="keywordflow">if</span> ( $this-&gt;_lastModifiedByColumnName &amp;&amp; $event-&gt;sender-&gt;hasAttribute( $this-&gt;_lastModifiedByColumnName ) &amp;&amp; ! $event-&gt;sender-&gt;getAttribute( $this-&gt;_lastModifiedByColumnName ) )
<a name="l00095"></a>00095       $this-&gt;getOwner()-&gt;setAttribute( $this-&gt;_lastModifiedByColumnName, Yii::app()-&gt;user-&gt;getId() );
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     <span class="keywordflow">return</span> <a class="code" href="classCXLTimeStampBehavior.html#a586e177c0e7073ec63f7ccd6546ff3fd" title="Timestamps row.">parent::beforeValidate</a>( $event );
<a name="l00098"></a>00098   }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100   <span class="comment">//********************************************************************************</span>
<a name="l00101"></a>00101   <span class="comment">//* Public Methods</span>
<a name="l00102"></a>00102   <span class="comment">//********************************************************************************</span>
<a name="l00103"></a>00103 
<a name="l00108"></a><a class="code" href="classCXLTimeStampBehavior.html#ae99ec12f90f0458dbd6e2d9dcce34620">00108</a>     <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#ae99ec12f90f0458dbd6e2d9dcce34620" title="Returns formatted create/lmod dates for forms.">showDates</a>()
<a name="l00109"></a>00109     {
<a name="l00110"></a>00110       <span class="keywordflow">if</span> ( ! $this-&gt;getOwner()-&gt;isNewRecord )
<a name="l00111"></a>00111       <span class="keywordflow">return</span> <a class="code" href="classCXLTimeStampBehavior.html#ae99ec12f90f0458dbd6e2d9dcce34620" title="Returns formatted create/lmod dates for forms.">XL::showDates</a>( $this-&gt;getOwner(), $this-&gt;_createdColumnName, $this-&gt;_lastModifiedColumnName, <span class="stringliteral">&#39;D M j, Y&#39;</span> );
<a name="l00112"></a>00112   }
<a name="l00113"></a>00113 
<a name="l00123"></a><a class="code" href="classCXLTimeStampBehavior.html#aa5ac765fd764508a2e486e01a725b4a1">00123</a>     <span class="keyword">public</span> function <a class="code" href="classCXLTimeStampBehavior.html#aa5ac765fd764508a2e486e01a725b4a1" title="Sets lmod date(s) and saves Will optionally touch other columns.">touch</a>( $additionalColumns = null )
<a name="l00124"></a>00124     {
<a name="l00125"></a>00125       $_touchValue = ( null === $this-&gt;_dateTimeFunction ) ? date( <span class="stringliteral">&#39;Y-m-d H:i:s&#39;</span> ) : eval( <span class="stringliteral">&#39;return &#39;</span> . $this-&gt;_dateTimeFunction . <span class="charliteral">&#39;;&#39;</span> );
<a name="l00126"></a>00126       $_updateList = array();
<a name="l00127"></a>00127 
<a name="l00128"></a>00128       <span class="comment">//  Any other columns to touch?</span>
<a name="l00129"></a>00129       <span class="keywordflow">if</span> ( null !== $additionalColumns )
<a name="l00130"></a>00130       {
<a name="l00131"></a>00131         <span class="keywordflow">foreach</span> ( <a class="code" href="classYiiXLBase.html#afe0c023a25109be01e517d26f99d85db" title="Takes parameters and returns an array of the values.">XL::makeArray</a>( $additionalColumns ) as $_attribute )
<a name="l00132"></a>00132         {
<a name="l00133"></a>00133           <span class="keywordflow">if</span> ( $this-&gt;getOwner()-&gt;hasAttribute( $_attribute ) )
<a name="l00134"></a>00134           {
<a name="l00135"></a>00135             $this-&gt;getOwner()-&gt;setAttribute( $_attribute, $_touchValue );
<a name="l00136"></a>00136             $_updateList[] = $_attribute;
<a name="l00137"></a>00137         }
<a name="l00138"></a>00138         }
<a name="l00139"></a>00139     }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141     <span class="keywordflow">if</span> ( $this-&gt;_lastModifiedColumnName &amp;&amp; $this-&gt;getOwner()-&gt;hasAttribute( $this-&gt;_lastModifiedColumnName ) )
<a name="l00142"></a>00142     {
<a name="l00143"></a>00143       $this-&gt;getOwner()-&gt;setAttribute( $this-&gt;_lastModifiedColumnName, $_touchValue );
<a name="l00144"></a>00144         $_updateList[] = $this-&gt;_lastModifiedColumnName;
<a name="l00145"></a>00145     }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147     <span class="comment">//  Only update if and what we&#39;ve touched...</span>
<a name="l00148"></a>00148     <span class="keywordflow">return</span> count( $_updateList ) ? $this-&gt;getOwner()-&gt;update( $_updateList ) : <span class="keyword">true</span>;
<a name="l00149"></a>00149   }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Fri Mar 25 2011 21:10:39 for YiiXL -- The Yii Extension Library Of Doom! by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
