<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>&quot;The Yii Extension Library Of Doom!&quot;: /usr/local/yiixl/lib/original/components/facebook/CPSFacebook.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>/usr/local/yiixl/lib/original/components/facebook/CPSFacebook.php</h1>  </div>
</div>
<div class="contents">
<a href="CPSFacebook_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00029"></a><a class="code" href="classCPSFacebook.html">00029</a> <span class="keyword">class </span><a class="code" href="classCPSFacebook.html">CPSFacebook</a> <span class="keyword">extends</span> <a class="code" href="classCPSApiComponent.html">CPSApiComponent</a>
<a name="l00030"></a>00030 {
<a name="l00031"></a>00031     <span class="comment">//********************************************************************************</span>
<a name="l00032"></a>00032     <span class="comment">//* Constants</span>
<a name="l00033"></a>00033     <span class="comment">//********************************************************************************</span>
<a name="l00034"></a>00034 
<a name="l00038"></a><a class="code" href="classCPSFacebook.html#af71005841ce53adac00581ab0ba24c1f">00038</a>     <span class="keyword">const</span>   <a class="code" href="classCPSFacebook.html#af71005841ce53adac00581ab0ba24c1f">VERSION</a> = <span class="stringliteral">&#39;2.1.2&#39;</span>;
<a name="l00039"></a><a class="code" href="classCPSFacebook.html#aad50057168703fbd6bcab2c2c6e4d628">00039</a>     <span class="keyword">const</span>   <a class="code" href="classCPSFacebook.html#aad50057168703fbd6bcab2c2c6e4d628">USER_AGENT</a> = <span class="stringliteral">&#39;pYe-facebook-php-2.1.2&#39;</span>;
<a name="l00040"></a>00040 
<a name="l00044"></a><a class="code" href="classCPSFacebook.html#afba99abd768bc1f4376bbd82d153d50b">00044</a>     <span class="keyword">const</span>   <a class="code" href="classCPSFacebook.html#afba99abd768bc1f4376bbd82d153d50b">PHOTO_CACHE</a> = <span class="stringliteral">&#39;_photoListCache&#39;</span>;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046     <span class="comment">//********************************************************************************</span>
<a name="l00047"></a>00047     <span class="comment">//* Statics</span>
<a name="l00048"></a>00048     <span class="comment">//********************************************************************************</span>
<a name="l00049"></a>00049 
<a name="l00053"></a><a class="code" href="classCPSFacebook.html#a386bcc77c2c57c89359cc7632ac521ad">00053</a>     <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classCPSFacebook.html#a386bcc77c2c57c89359cc7632ac521ad">$_CURL_OPTS</a> = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00054"></a>00054         CURLOPT_CONNECTTIMEOUT =&gt; 10,
<a name="l00055"></a>00055         CURLOPT_RETURNTRANSFER =&gt; <span class="keyword">true</span>,
<a name="l00056"></a>00056         CURLOPT_TIMEOUT =&gt; 60,
<a name="l00057"></a>00057         CURLOPT_USERAGENT =&gt; self::USER_AGENT,
<a name="l00058"></a>00058     );
<a name="l00059"></a>00059 
<a name="l00063"></a><a class="code" href="classCPSFacebook.html#aced13da18a88b032dcdbe41db9c09ed3">00063</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="classCPSFacebook.html#aced13da18a88b032dcdbe41db9c09ed3">$_DROP_QUERY_PARAMS</a> = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00064"></a>00064         <span class="stringliteral">&#39;session&#39;</span>,
<a name="l00065"></a>00065         <span class="stringliteral">&#39;signed_request&#39;</span>,
<a name="l00066"></a>00066     );
<a name="l00067"></a>00067 
<a name="l00071"></a><a class="code" href="classCPSFacebook.html#af39417a7550a728b1f3486fd0a9d3f55">00071</a>     <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classCPSFacebook.html#af39417a7550a728b1f3486fd0a9d3f55">$_DOMAIN_MAP</a> = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00072"></a>00072         <span class="stringliteral">&#39;api&#39;</span> =&gt; <span class="stringliteral">&#39;https://api.facebook.com/&#39;</span>,
<a name="l00073"></a>00073         <span class="stringliteral">&#39;api_read&#39;</span> =&gt; <span class="stringliteral">&#39;https://api-read.facebook.com/&#39;</span>,
<a name="l00074"></a>00074         <span class="stringliteral">&#39;graph&#39;</span> =&gt; <span class="stringliteral">&#39;https://graph.facebook.com/&#39;</span>,
<a name="l00075"></a>00075         <span class="stringliteral">&#39;www&#39;</span> =&gt; <span class="stringliteral">&#39;https://www.facebook.com/&#39;</span>,
<a name="l00076"></a>00076     );
<a name="l00077"></a>00077 
<a name="l00081"></a><a class="code" href="classCPSFacebook.html#ae5e971be39413de8adc0e47624dbee86">00081</a>     <span class="keyword">protected</span> <span class="keyword">static</span> <a class="code" href="classCPSFacebook.html#ae5e971be39413de8adc0e47624dbee86">$READ_ONLY_CALLS</a> = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00082"></a>00082         <span class="stringliteral">&#39;admin.getallocation&#39;</span> =&gt; 1,
<a name="l00083"></a>00083         <span class="stringliteral">&#39;admin.getappproperties&#39;</span> =&gt; 1,
<a name="l00084"></a>00084         <span class="stringliteral">&#39;admin.getbannedusers&#39;</span> =&gt; 1,
<a name="l00085"></a>00085         <span class="stringliteral">&#39;admin.getlivestreamvialink&#39;</span> =&gt; 1,
<a name="l00086"></a>00086         <span class="stringliteral">&#39;admin.getmetrics&#39;</span> =&gt; 1,
<a name="l00087"></a>00087         <span class="stringliteral">&#39;admin.getrestrictioninfo&#39;</span> =&gt; 1,
<a name="l00088"></a>00088         <span class="stringliteral">&#39;application.getpublicinfo&#39;</span> =&gt; 1,
<a name="l00089"></a>00089         <span class="stringliteral">&#39;auth.getapppublickey&#39;</span> =&gt; 1,
<a name="l00090"></a>00090         <span class="stringliteral">&#39;auth.getsession&#39;</span> =&gt; 1,
<a name="l00091"></a>00091         <span class="stringliteral">&#39;auth.getsignedpublicsessiondata&#39;</span> =&gt; 1,
<a name="l00092"></a>00092         <span class="stringliteral">&#39;comments.get&#39;</span> =&gt; 1,
<a name="l00093"></a>00093         <span class="stringliteral">&#39;connect.getunconnectedfriendscount&#39;</span> =&gt; 1,
<a name="l00094"></a>00094         <span class="stringliteral">&#39;dashboard.getactivity&#39;</span> =&gt; 1,
<a name="l00095"></a>00095         <span class="stringliteral">&#39;dashboard.getcount&#39;</span> =&gt; 1,
<a name="l00096"></a>00096         <span class="stringliteral">&#39;dashboard.getglobalnews&#39;</span> =&gt; 1,
<a name="l00097"></a>00097         <span class="stringliteral">&#39;dashboard.getnews&#39;</span> =&gt; 1,
<a name="l00098"></a>00098         <span class="stringliteral">&#39;dashboard.multigetcount&#39;</span> =&gt; 1,
<a name="l00099"></a>00099         <span class="stringliteral">&#39;dashboard.multigetnews&#39;</span> =&gt; 1,
<a name="l00100"></a>00100         <span class="stringliteral">&#39;data.getcookies&#39;</span> =&gt; 1,
<a name="l00101"></a>00101         <span class="stringliteral">&#39;events.get&#39;</span> =&gt; 1,
<a name="l00102"></a>00102         <span class="stringliteral">&#39;events.getmembers&#39;</span> =&gt; 1,
<a name="l00103"></a>00103         <span class="stringliteral">&#39;fbml.getcustomtags&#39;</span> =&gt; 1,
<a name="l00104"></a>00104         <span class="stringliteral">&#39;feed.getappfriendstories&#39;</span> =&gt; 1,
<a name="l00105"></a>00105         <span class="stringliteral">&#39;feed.getregisteredtemplatebundlebyid&#39;</span> =&gt; 1,
<a name="l00106"></a>00106         <span class="stringliteral">&#39;feed.getregisteredtemplatebundles&#39;</span> =&gt; 1,
<a name="l00107"></a>00107         <span class="stringliteral">&#39;fql.multiquery&#39;</span> =&gt; 1,
<a name="l00108"></a>00108         <span class="stringliteral">&#39;fql.query&#39;</span> =&gt; 1,
<a name="l00109"></a>00109         <span class="stringliteral">&#39;friends.arefriends&#39;</span> =&gt; 1,
<a name="l00110"></a>00110         <span class="stringliteral">&#39;friends.get&#39;</span> =&gt; 1,
<a name="l00111"></a>00111         <span class="stringliteral">&#39;friends.getappusers&#39;</span> =&gt; 1,
<a name="l00112"></a>00112         <span class="stringliteral">&#39;friends.getlists&#39;</span> =&gt; 1,
<a name="l00113"></a>00113         <span class="stringliteral">&#39;friends.getmutualfriends&#39;</span> =&gt; 1,
<a name="l00114"></a>00114         <span class="stringliteral">&#39;gifts.get&#39;</span> =&gt; 1,
<a name="l00115"></a>00115         <span class="stringliteral">&#39;groups.get&#39;</span> =&gt; 1,
<a name="l00116"></a>00116         <span class="stringliteral">&#39;groups.getmembers&#39;</span> =&gt; 1,
<a name="l00117"></a>00117         <span class="stringliteral">&#39;intl.gettranslations&#39;</span> =&gt; 1,
<a name="l00118"></a>00118         <span class="stringliteral">&#39;links.get&#39;</span> =&gt; 1,
<a name="l00119"></a>00119         <span class="stringliteral">&#39;notes.get&#39;</span> =&gt; 1,
<a name="l00120"></a>00120         <span class="stringliteral">&#39;notifications.get&#39;</span> =&gt; 1,
<a name="l00121"></a>00121         <span class="stringliteral">&#39;pages.getinfo&#39;</span> =&gt; 1,
<a name="l00122"></a>00122         <span class="stringliteral">&#39;pages.isadmin&#39;</span> =&gt; 1,
<a name="l00123"></a>00123         <span class="stringliteral">&#39;pages.isappadded&#39;</span> =&gt; 1,
<a name="l00124"></a>00124         <span class="stringliteral">&#39;pages.isfan&#39;</span> =&gt; 1,
<a name="l00125"></a>00125         <span class="stringliteral">&#39;permissions.checkavailableapiaccess&#39;</span> =&gt; 1,
<a name="l00126"></a>00126         <span class="stringliteral">&#39;permissions.checkgrantedapiaccess&#39;</span> =&gt; 1,
<a name="l00127"></a>00127         <span class="stringliteral">&#39;photos.get&#39;</span> =&gt; 1,
<a name="l00128"></a>00128         <span class="stringliteral">&#39;photos.getalbums&#39;</span> =&gt; 1,
<a name="l00129"></a>00129         <span class="stringliteral">&#39;photos.gettags&#39;</span> =&gt; 1,
<a name="l00130"></a>00130         <span class="stringliteral">&#39;profile.getinfo&#39;</span> =&gt; 1,
<a name="l00131"></a>00131         <span class="stringliteral">&#39;profile.getinfooptions&#39;</span> =&gt; 1,
<a name="l00132"></a>00132         <span class="stringliteral">&#39;stream.get&#39;</span> =&gt; 1,
<a name="l00133"></a>00133         <span class="stringliteral">&#39;stream.getcomments&#39;</span> =&gt; 1,
<a name="l00134"></a>00134         <span class="stringliteral">&#39;stream.getfilters&#39;</span> =&gt; 1,
<a name="l00135"></a>00135         <span class="stringliteral">&#39;users.getinfo&#39;</span> =&gt; 1,
<a name="l00136"></a>00136         <span class="stringliteral">&#39;users.getloggedinuser&#39;</span> =&gt; 1,
<a name="l00137"></a>00137         <span class="stringliteral">&#39;users.getstandardinfo&#39;</span> =&gt; 1,
<a name="l00138"></a>00138         <span class="stringliteral">&#39;users.hasapppermission&#39;</span> =&gt; 1,
<a name="l00139"></a>00139         <span class="stringliteral">&#39;users.isappuser&#39;</span> =&gt; 1,
<a name="l00140"></a>00140         <span class="stringliteral">&#39;users.isverified&#39;</span> =&gt; 1,
<a name="l00141"></a>00141         <span class="stringliteral">&#39;video.getuploadlimits&#39;</span> =&gt; 1,
<a name="l00142"></a>00142     );
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="comment">//********************************************************************************</span>
<a name="l00145"></a>00145     <span class="comment">//* Member Variables</span>
<a name="l00146"></a>00146     <span class="comment">//********************************************************************************</span>
<a name="l00147"></a>00147 
<a name="l00151"></a><a class="code" href="classCPSFacebook.html#a26f5b0452f151ceda4f18979a5eb1058">00151</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#a26f5b0452f151ceda4f18979a5eb1058">$_appId</a>;
<a name="l00152"></a><a class="code" href="classCPSFacebook.html#a3686abfe34c828287edc1d6a8f77367d">00152</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a3686abfe34c828287edc1d6a8f77367d">getAppId</a>() { <span class="keywordflow">return</span> $this-&gt;_appId; }
<a name="l00153"></a><a class="code" href="classCPSFacebook.html#a5d184a71ba30a0fedb1006f15df66177">00153</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a5d184a71ba30a0fedb1006f15df66177">setAppId</a>( $newValue ) { $this-&gt;_appId = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00154"></a>00154 
<a name="l00158"></a><a class="code" href="classCPSFacebook.html#ab1025f24b9ab01061327e23b10552116">00158</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#ab1025f24b9ab01061327e23b10552116">$_appName</a>;
<a name="l00159"></a><a class="code" href="classCPSFacebook.html#a36da26e368f80dfa10ab2fcedde8b12b">00159</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a36da26e368f80dfa10ab2fcedde8b12b">getAppName</a>() { <span class="keywordflow">return</span> $this-&gt;_appName; }
<a name="l00160"></a><a class="code" href="classCPSFacebook.html#ad9727261836418005a302bf42802a84f">00160</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#ad9727261836418005a302bf42802a84f">setAppName</a>( $newValue ) { $this-&gt;_appName = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00161"></a>00161 
<a name="l00165"></a><a class="code" href="classCPSFacebook.html#a4416500680a7b92e95184727c36eec91">00165</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#a4416500680a7b92e95184727c36eec91">$_appUrl</a>;
<a name="l00166"></a><a class="code" href="classCPSFacebook.html#aec474172017ccece67a1c46e1a5a3460">00166</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#aec474172017ccece67a1c46e1a5a3460">getAppUrl</a>() { <span class="keywordflow">return</span> $this-&gt;_appUrl; }
<a name="l00167"></a><a class="code" href="classCPSFacebook.html#ab759f3978697fbd0d6de43c959c69664">00167</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#ab759f3978697fbd0d6de43c959c69664">setAppUrl</a>( $newValue ) { $this-&gt;_appUrl = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00168"></a>00168 
<a name="l00172"></a><a class="code" href="classCPSFacebook.html#a6adcddc9592544d2e65aed888e2bfdfa">00172</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#a6adcddc9592544d2e65aed888e2bfdfa">$_appPermissions</a> = <span class="stringliteral">&#39;publish_stream&#39;</span>;
<a name="l00173"></a><a class="code" href="classCPSFacebook.html#a9784c3b68605f689b41f10aa28fffcca">00173</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a9784c3b68605f689b41f10aa28fffcca">getAppPermissions</a>() { <span class="keywordflow">return</span> $this-&gt;_appPermissions; }
<a name="l00174"></a><a class="code" href="classCPSFacebook.html#a466f4d1985a506c8e3be3d9929e4111e">00174</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a466f4d1985a506c8e3be3d9929e4111e">setAppPermissions</a>( $newValue ) { $this-&gt;_appPermissions = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00175"></a>00175 
<a name="l00179"></a><a class="code" href="classCPSFacebook.html#a30d859488ed1921f08a7e8191363d9a4">00179</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#a30d859488ed1921f08a7e8191363d9a4">$_apiKey</a>;
<a name="l00180"></a><a class="code" href="classCPSFacebook.html#afdd5b6b54737f556694975ca3d93d773">00180</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#afdd5b6b54737f556694975ca3d93d773">getApiKey</a>() { <span class="keywordflow">return</span> $this-&gt;_apiKey; }
<a name="l00181"></a><a class="code" href="classCPSFacebook.html#a5459ba27b6f139cf3f10bab4aec9b6e4">00181</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a5459ba27b6f139cf3f10bab4aec9b6e4">setApiKey</a>( $newValue ) { $this-&gt;_apiKey = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00182"></a>00182 
<a name="l00186"></a><a class="code" href="classCPSFacebook.html#ae5bcbc03d954a2feca80ddd77054501d">00186</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#ae5bcbc03d954a2feca80ddd77054501d">$_apiSecretKey</a>;
<a name="l00187"></a><a class="code" href="classCPSFacebook.html#ac01814ac1bd26175f55f538e3a4752cc">00187</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#ac01814ac1bd26175f55f538e3a4752cc">getApiSecretKey</a>() { <span class="keywordflow">return</span> $this-&gt;_apiSecretKey; }
<a name="l00188"></a><a class="code" href="classCPSFacebook.html#a8b556659e1d182ba42b528f47f1f217c">00188</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a8b556659e1d182ba42b528f47f1f217c">setApiSecretKey</a>( $newValue ) { $this-&gt;_apiSecretKey = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00189"></a>00189 
<a name="l00193"></a><a class="code" href="classCPSFacebook.html#a98f1263247e46ae35ef0b714c702d0bd">00193</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#a98f1263247e46ae35ef0b714c702d0bd">$_apiCallbackUrl</a>;
<a name="l00194"></a><a class="code" href="classCPSFacebook.html#aca0af56a33a1d36ef2c9c3283d842d9c">00194</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#aca0af56a33a1d36ef2c9c3283d842d9c">getApiCallbackUrl</a>() { <span class="keywordflow">return</span> $this-&gt;_apiCallbackUrl; }
<a name="l00195"></a><a class="code" href="classCPSFacebook.html#aecbe7fa989ff4870e8284982d2b4908b">00195</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#aecbe7fa989ff4870e8284982d2b4908b">setApiCallbackUrl</a>( $newValue ) { $this-&gt;_apiCallbackUrl = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00196"></a>00196 
<a name="l00200"></a><a class="code" href="classCPSFacebook.html#aee8e9816087942dab4fb8bd62f413cd6">00200</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#aee8e9816087942dab4fb8bd62f413cd6">$_sessionLoaded</a> = <span class="keyword">false</span>;
<a name="l00201"></a><a class="code" href="classCPSFacebook.html#abd67157f9e772183733ad7a9112c822b">00201</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#abd67157f9e772183733ad7a9112c822b">getSessionLoaded</a>() { <span class="keywordflow">return</span> $this-&gt;_sessionLoaded; }
<a name="l00202"></a><a class="code" href="classCPSFacebook.html#ad4202dd31fb79a9d1e1f4031fffd8623">00202</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#ad4202dd31fb79a9d1e1f4031fffd8623">setSessionLoaded</a>( $newValue ) { $this-&gt;_sessionLoaded = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00203"></a>00203 
<a name="l00207"></a><a class="code" href="classCPSFacebook.html#a6b432430b58baf6351a7507208363d80">00207</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#a6b432430b58baf6351a7507208363d80">$_signedRequest</a>;
<a name="l00208"></a><a class="code" href="classCPSFacebook.html#aa89cc38937ab8f8f132f3712c49c6e37">00208</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#aa89cc38937ab8f8f132f3712c49c6e37">getSignedRequest</a>()
<a name="l00209"></a>00209     {
<a name="l00210"></a>00210         <span class="keywordflow">if</span> ( ! $this-&gt;_signedRequest )
<a name="l00211"></a>00211         {
<a name="l00212"></a>00212             <span class="keywordflow">if</span> ( null !== ( $_request = PS::o( $_REQUEST, <span class="stringliteral">&#39;signed_request&#39;</span> ) ) )
<a name="l00213"></a>00213                 $this-&gt;_signedRequest = $this-&gt;<a class="code" href="classCPSFacebook.html#a2b963de2da5e5d03684f94c360f948ea">_parseSignedRequest</a>( $_request );
<a name="l00214"></a>00214         }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216         <span class="keywordflow">return</span> $this-&gt;_signedRequest;
<a name="l00217"></a>00217     }
<a name="l00218"></a><a class="code" href="classCPSFacebook.html#a0d55959bc29df7526c0dfcd1c87e750d">00218</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a0d55959bc29df7526c0dfcd1c87e750d">setSignedRequest</a>( $newValue ) { $this-&gt;_signedRequest = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00219"></a>00219 
<a name="l00223"></a><a class="code" href="classCPSFacebook.html#a6302bfba02d83c085b22d2aea1fc3bd6">00223</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#a6302bfba02d83c085b22d2aea1fc3bd6">$_enableCookieSupport</a> = <span class="keyword">false</span>;
<a name="l00224"></a><a class="code" href="classCPSFacebook.html#ab002401bbd20f1d945afc24377102294">00224</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#ab002401bbd20f1d945afc24377102294">getEnableCookieSupport</a>() { <span class="keywordflow">return</span> $this-&gt;_enableCookieSupport; }
<a name="l00225"></a><a class="code" href="classCPSFacebook.html#a38dc6e2f0ac551d3ec16ab03fa9d725b">00225</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a38dc6e2f0ac551d3ec16ab03fa9d725b">setEnableCookieSupport</a>( $newValue ) { $this-&gt;_enableCookieSupport = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00226"></a>00226 
<a name="l00230"></a><a class="code" href="classCPSFacebook.html#ac054a508d06da60c6ffc3aab3fd7b3e7">00230</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#ac054a508d06da60c6ffc3aab3fd7b3e7">$_baseDomain</a> = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00231"></a><a class="code" href="classCPSFacebook.html#ab0b9668fe081b3b7eb36307bcb7688e8">00231</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#ab0b9668fe081b3b7eb36307bcb7688e8">getBaseDomain</a>() { <span class="keywordflow">return</span> $this-&gt;_baseDomain; }
<a name="l00232"></a><a class="code" href="classCPSFacebook.html#a5438481a4c2c43b1ccf2dc5c8de9b7b7">00232</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a5438481a4c2c43b1ccf2dc5c8de9b7b7">setbaseDomain</a>( $newValue ) { $this-&gt;_baseDomain = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00233"></a>00233 
<a name="l00237"></a><a class="code" href="classCPSFacebook.html#a851bf23affeafd6281b06ff919d23a7f">00237</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#a851bf23affeafd6281b06ff919d23a7f">$_fileUploadSupport</a> = <span class="keyword">false</span>;
<a name="l00238"></a><a class="code" href="classCPSFacebook.html#a11a2fe55342959e85616440f6287f24a">00238</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a11a2fe55342959e85616440f6287f24a">getFileUploadSupport</a>() { <span class="keywordflow">return</span> $this-&gt;_fileUploadSupport; }
<a name="l00239"></a><a class="code" href="classCPSFacebook.html#af19c4491f0d526c7b4194ca9217fc966">00239</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#af19c4491f0d526c7b4194ca9217fc966">setFileUploadSupport</a>( $newValue ) { $this-&gt;_fileUploadSupport = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00240"></a>00240 
<a name="l00244"></a><a class="code" href="classCPSFacebook.html#a26d05a26685e4c898e34328911b708d3">00244</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#a26d05a26685e4c898e34328911b708d3">$_redirectToLoginUrl</a> = <span class="keyword">true</span>;
<a name="l00245"></a><a class="code" href="classCPSFacebook.html#af338297425aef1a6322e4f096b0b8a34">00245</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#af338297425aef1a6322e4f096b0b8a34">getRedirectToLoginUrl</a>() { <span class="keywordflow">return</span> $this-&gt;_redirectToLoginUrl; }
<a name="l00246"></a><a class="code" href="classCPSFacebook.html#a38575b53e5d51921b89d693e88bacaa9">00246</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a38575b53e5d51921b89d693e88bacaa9">setRedirectToLoginUrl</a>( $newValue ) { $this-&gt;_redirectToLoginUrl = $newValue; <span class="keywordflow">return</span> $this; }
<a name="l00247"></a>00247 
<a name="l00251"></a><a class="code" href="classCPSFacebook.html#a7e2b66c375158928ec4cfa9de801ac0b">00251</a>     <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="classCPSFacebook.html#a7e2b66c375158928ec4cfa9de801ac0b">$_photoList</a> = null;
<a name="l00252"></a><a class="code" href="classCPSFacebook.html#ab3989d2377763fb40cb29086ef272f6e">00252</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCPSFacebook.html#ab3989d2377763fb40cb29086ef272f6e">getPhotoList</a>() { <span class="keywordflow">return</span> self::$_photoList; }
<a name="l00253"></a><a class="code" href="classCPSFacebook.html#ad35e44440b0eff84cccdfd1db697c639">00253</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCPSFacebook.html#ad35e44440b0eff84cccdfd1db697c639">setPhotoList</a>( $_value ) { self::$_photoList = $_value; }
<a name="l00254"></a>00254 
<a name="l00258"></a><a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">00258</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260     <span class="comment">//********************************************************************************</span>
<a name="l00261"></a>00261     <span class="comment">//* Public Methods</span>
<a name="l00262"></a>00262     <span class="comment">//********************************************************************************</span>
<a name="l00263"></a>00263 
<a name="l00276"></a><a class="code" href="classCPSFacebook.html#af7f9493844d2d66e924e3c1df51ce616">00276</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#af7f9493844d2d66e924e3c1df51ce616">__construct</a>( <a class="code" href="advanced_8php.html#aea8fdfb38b8f02d1fc431d35e6dfc892">$config</a> = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>() )
<a name="l00277"></a>00277     {
<a name="l00278"></a>00278         <span class="keywordflow">if</span> ( ! function_exists( <span class="stringliteral">&#39;curl_init&#39;</span> ) )
<a name="l00279"></a>00279             <span class="keywordflow">throw</span> <span class="keyword">new</span> CHttpException( 405, <span class="stringliteral">&#39;This class requires the CURL PHP extension.&#39;</span> );
<a name="l00280"></a>00280 
<a name="l00281"></a>00281         <span class="keywordflow">if</span> ( ! function_exists( <span class="stringliteral">&#39;json_decode&#39;</span> ) )
<a name="l00282"></a>00282             <span class="keywordflow">throw</span> <span class="keyword">new</span> CHttpException( 405, <span class="stringliteral">&#39;This class requires the JSON PHP extension.&#39;</span> );
<a name="l00283"></a>00283 
<a name="l00284"></a>00284         $this-&gt;_appId = PS::o( <a class="code" href="advanced_8php.html#aea8fdfb38b8f02d1fc431d35e6dfc892">$config</a>, <span class="stringliteral">&#39;appId&#39;</span> );
<a name="l00285"></a>00285         $this-&gt;_apiSecretKey = PS::o( <a class="code" href="advanced_8php.html#aea8fdfb38b8f02d1fc431d35e6dfc892">$config</a>, <span class="stringliteral">&#39;secret&#39;</span> );
<a name="l00286"></a>00286         $this-&gt;_enableCookieSupport = PS::o( <a class="code" href="advanced_8php.html#aea8fdfb38b8f02d1fc431d35e6dfc892">$config</a>, <span class="stringliteral">&#39;cookie&#39;</span>, <span class="keyword">false</span> );
<a name="l00287"></a>00287         $this-&gt;_baseDomain = PS::o( <a class="code" href="advanced_8php.html#aea8fdfb38b8f02d1fc431d35e6dfc892">$config</a>, <span class="stringliteral">&#39;domain&#39;</span>, <span class="stringliteral">&#39;&#39;</span> );
<a name="l00288"></a>00288         $this-&gt;_fileUploadSupport = PS::o( <a class="code" href="advanced_8php.html#aea8fdfb38b8f02d1fc431d35e6dfc892">$config</a>, <span class="stringliteral">&#39;fileUploadSupport&#39;</span>, <span class="keyword">false</span> );
<a name="l00289"></a>00289     }
<a name="l00290"></a>00290 
<a name="l00294"></a><a class="code" href="classCPSFacebook.html#a4be4055f3361d4800e16bc2e2e38cda6">00294</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a4be4055f3361d4800e16bc2e2e38cda6">init</a>()
<a name="l00295"></a>00295     {
<a name="l00296"></a>00296         <a class="code" href="classCPSFacebook.html#a4be4055f3361d4800e16bc2e2e38cda6">parent::init</a>();
<a name="l00297"></a>00297         self::$_photoList = PS::_gs( self::PHOTO_CACHE );
<a name="l00298"></a>00298     }
<a name="l00299"></a>00299 
<a name="l00303"></a><a class="code" href="classCPSFacebook.html#a421831a265621325e1fdd19aace0c758">00303</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a421831a265621325e1fdd19aace0c758">__destruct</a>()
<a name="l00304"></a>00304     {
<a name="l00305"></a>00305         <span class="keywordflow">if</span> ( ! empty( self::$_photoList ) )
<a name="l00306"></a>00306             PS::_ss( self::PHOTO_CACHE, self::$_photoList );
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308 
<a name="l00315"></a><a class="code" href="classCPSFacebook.html#a83fd4ea8255385abd72c27a762691e2d">00315</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a83fd4ea8255385abd72c27a762691e2d">setSession</a>( $session = null, $writeCookie = <span class="keyword">true</span> )
<a name="l00316"></a>00316     {
<a name="l00317"></a>00317         $this-&gt;_session = $this-&gt;<a class="code" href="classCPSFacebook.html#a7dd3fb0ddff204e195f91b8719104a61">_validateSessionObject</a>( $session );
<a name="l00318"></a>00318         $this-&gt;_sessionLoaded = <span class="keyword">true</span>;
<a name="l00319"></a>00319 
<a name="l00320"></a>00320         <span class="keywordflow">if</span> ( $writeCookie ) $this-&gt;<a class="code" href="classCPSFacebook.html#a818b7c88630a9f0a6318aecb55160c38">_setCookieFromSession</a>( $this-&gt;_session );
<a name="l00321"></a>00321 
<a name="l00322"></a>00322         <span class="keywordflow">return</span> $this;
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 
<a name="l00331"></a><a class="code" href="classCPSFacebook.html#aefa4c5bd150e2a7d525576d7959c6911">00331</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#aefa4c5bd150e2a7d525576d7959c6911">getSession</a>()
<a name="l00332"></a>00332     {
<a name="l00333"></a>00333         <span class="keywordflow">if</span> ( ! $this-&gt;_sessionLoaded )
<a name="l00334"></a>00334         {
<a name="l00335"></a>00335             <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = null;
<a name="l00336"></a>00336             $_writeCookie = <span class="keyword">true</span>;
<a name="l00337"></a>00337 
<a name="l00338"></a>00338             <span class="comment">//  Try loading session from signed_request in $_REQUEST</span>
<a name="l00339"></a>00339             <span class="keywordflow">if</span> ( <a class="code" href="classCPSFacebook.html#a6b432430b58baf6351a7507208363d80">$_signedRequest</a> = $this-&gt;<a class="code" href="classCPSFacebook.html#aa89cc38937ab8f8f132f3712c49c6e37">getSignedRequest</a>() )
<a name="l00340"></a>00340                 <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = $this-&gt;<a class="code" href="classCPSFacebook.html#ad095f729036d48a23d321839f3ea7853">_createSessionFromSignedRequest</a>( <a class="code" href="classCPSFacebook.html#a6b432430b58baf6351a7507208363d80">$_signedRequest</a> );
<a name="l00341"></a>00341 
<a name="l00342"></a>00342             <span class="comment">//  Try loading session from $_REQUEST</span>
<a name="l00343"></a>00343             <span class="keywordflow">if</span> ( ! <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> &amp;&amp; <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = PS::o( $_REQUEST, <span class="stringliteral">&#39;session&#39;</span> ) )
<a name="l00344"></a>00344             {
<a name="l00345"></a>00345                 <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = json_decode( get_magic_quotes_gpc() ? stripslashes( <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> ) : <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>, <span class="keyword">true</span> );
<a name="l00346"></a>00346                 $_session = $this-&gt;<a class="code" href="classCPSFacebook.html#a7dd3fb0ddff204e195f91b8719104a61">_validateSessionObject</a>( $_session );
<a name="l00347"></a>00347             }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349             <span class="comment">//  Try getting unsigned fb_sig request...</span>
<a name="l00350"></a>00350             <span class="keywordflow">if</span> ( ! <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> )
<a name="l00351"></a>00351             {
<a name="l00352"></a>00352                 <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = $this-&gt;<a class="code" href="classCPSFacebook.html#ad8d438fe02fb781abe815fd5972795ff">_getUnsignedSession</a>();
<a name="l00353"></a>00353                 <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = $this-&gt;<a class="code" href="classCPSFacebook.html#a7dd3fb0ddff204e195f91b8719104a61">_validateSessionObject</a>( <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> );
<a name="l00354"></a>00354             }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356             <span class="comment">//  Try loading session from cookie if necessary</span>
<a name="l00357"></a>00357             <span class="keywordflow">if</span> ( ! <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> &amp;&amp; $this-&gt;_enableCookieSupport )
<a name="l00358"></a>00358             {
<a name="l00359"></a>00359                 $_name = $this-&gt;<a class="code" href="classCPSFacebook.html#a69c13b5e61215433a48b9a6742f16660">_getSessionCookieName</a>();
<a name="l00360"></a>00360 
<a name="l00361"></a>00361                 <span class="keywordflow">if</span> ( $_cookie = PS::o( $_COOKIE, $_name ) )
<a name="l00362"></a>00362                 {
<a name="l00363"></a>00363                     <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>();
<a name="l00364"></a>00364                     parse_str( trim( get_magic_quotes_gpc() ? stripslashes( $_cookie ) : $_cookie, <span class="charliteral">&#39;&quot;&#39;</span> ), <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> );
<a name="l00365"></a>00365                     <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = $this-&gt;<a class="code" href="classCPSFacebook.html#a7dd3fb0ddff204e195f91b8719104a61">_validateSessionObject</a>( <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> );
<a name="l00366"></a>00366 
<a name="l00367"></a>00367                     <span class="comment">//  Write only if we need to delete a invalid session cookie</span>
<a name="l00368"></a>00368                     $_writeCookie = empty( <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> );
<a name="l00369"></a>00369                 }
<a name="l00370"></a>00370             }
<a name="l00371"></a>00371 
<a name="l00372"></a>00372             $this-&gt;<a class="code" href="classCPSFacebook.html#a83fd4ea8255385abd72c27a762691e2d">setSession</a>( <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>, $_writeCookie );
<a name="l00373"></a>00373         }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375         <span class="keywordflow">return</span> $this-&gt;_session;
<a name="l00376"></a>00376     }
<a name="l00377"></a>00377 
<a name="l00382"></a><a class="code" href="classCPSFacebook.html#ae81b7186fb97a7c6457edcc68c9aa2ef">00382</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#ae81b7186fb97a7c6457edcc68c9aa2ef">getUser</a>()
<a name="l00383"></a>00383     {
<a name="l00384"></a>00384         <span class="keywordflow">if</span> ( <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = $this-&gt;<a class="code" href="classCPSFacebook.html#aefa4c5bd150e2a7d525576d7959c6911">getSession</a>() )
<a name="l00385"></a>00385             <span class="keywordflow">return</span> PS::o( <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>, <span class="stringliteral">&#39;uid&#39;</span> );
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         <span class="keywordflow">return</span> null;
<a name="l00388"></a>00388     }
<a name="l00389"></a>00389 
<a name="l00395"></a><a class="code" href="classCPSFacebook.html#a5d251c70a3f9f9daaff7f00ec5f894c0">00395</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a5d251c70a3f9f9daaff7f00ec5f894c0">getAccessToken</a>()
<a name="l00396"></a>00396     {
<a name="l00397"></a>00397         <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = $this-&gt;<a class="code" href="classCPSFacebook.html#aefa4c5bd150e2a7d525576d7959c6911">getSession</a>();
<a name="l00398"></a>00398 
<a name="l00399"></a>00399         <span class="comment">//  Either user session signed, or app signed</span>
<a name="l00400"></a>00400         <span class="keywordflow">if</span> ( <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> )
<a name="l00401"></a>00401             <span class="keywordflow">return</span> PS::o( <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>, <span class="stringliteral">&#39;access_token&#39;</span> );
<a name="l00402"></a>00402 
<a name="l00403"></a>00403         <span class="keywordflow">return</span> $this-&gt;_appId . <span class="charliteral">&#39;|&#39;</span> . $this-&gt;_apiSecretKey;
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405 
<a name="l00420"></a><a class="code" href="classCPSFacebook.html#a3fc2a3b447d666e9f8607da999a1ea2d">00420</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#a3fc2a3b447d666e9f8607da999a1ea2d">getLoginUrl</a>( $paramList = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>() )
<a name="l00421"></a>00421     {
<a name="l00422"></a>00422         $_currentUrl = $this-&gt;<a class="code" href="classCPSFacebook.html#a1d2b68391ad44fe79ecef5ecd09feec3">_getCurrentUrl</a>();
<a name="l00423"></a>00423 
<a name="l00424"></a>00424         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCPSFacebook.html#a719203fb2a7e839997705e75e0bcc9a1">_getUrl</a>(
<a name="l00425"></a>00425             <span class="stringliteral">&#39;www&#39;</span>,
<a name="l00426"></a>00426             <span class="stringliteral">&#39;login.php&#39;</span>,
<a name="l00427"></a>00427             array_merge( <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00428"></a>00428                 <span class="stringliteral">&#39;api_key&#39;</span> =&gt; $this-&gt;_appId,
<a name="l00429"></a>00429                 <span class="stringliteral">&#39;cancel_url&#39;</span> =&gt; $_currentUrl,
<a name="l00430"></a>00430                 <span class="stringliteral">&#39;display&#39;</span> =&gt; <span class="stringliteral">&#39;page&#39;</span>,
<a name="l00431"></a>00431                 <span class="stringliteral">&#39;fbconnect&#39;</span> =&gt; 1,
<a name="l00432"></a>00432                 <span class="stringliteral">&#39;next&#39;</span> =&gt; $_currentUrl,
<a name="l00433"></a>00433                 <span class="stringliteral">&#39;return_session&#39;</span> =&gt; 1,
<a name="l00434"></a>00434                 <span class="stringliteral">&#39;session_version&#39;</span> =&gt; 3,
<a name="l00435"></a>00435                 <span class="charliteral">&#39;v&#39;</span> =&gt; <span class="stringliteral">&#39;1.0&#39;</span>,
<a name="l00436"></a>00436             ), $paramList )
<a name="l00437"></a>00437         );
<a name="l00438"></a>00438     }
<a name="l00439"></a>00439 
<a name="l00449"></a><a class="code" href="classCPSFacebook.html#ade0c69c82aebca82fd8bd98ad74439f2">00449</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#ade0c69c82aebca82fd8bd98ad74439f2">getLogoutUrl</a>( $paramList = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>() )
<a name="l00450"></a>00450     {
<a name="l00451"></a>00451         <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = $this-&gt;<a class="code" href="classCPSFacebook.html#aefa4c5bd150e2a7d525576d7959c6911">getSession</a>();
<a name="l00452"></a>00452 
<a name="l00453"></a>00453         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCPSFacebook.html#a719203fb2a7e839997705e75e0bcc9a1">_getUrl</a>(
<a name="l00454"></a>00454             <span class="stringliteral">&#39;www&#39;</span>,
<a name="l00455"></a>00455             <span class="stringliteral">&#39;logout.php&#39;</span>,
<a name="l00456"></a>00456             array_merge( <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00457"></a>00457                 <span class="stringliteral">&#39;next&#39;</span> =&gt; $this-&gt;<a class="code" href="classCPSFacebook.html#a1d2b68391ad44fe79ecef5ecd09feec3">_getCurrentUrl</a>(),
<a name="l00458"></a>00458                 <span class="stringliteral">&#39;access_token&#39;</span> =&gt; $this-&gt;<a class="code" href="classCPSFacebook.html#a5d251c70a3f9f9daaff7f00ec5f894c0">getAccessToken</a>(),
<a name="l00459"></a>00459             ), $paramList )
<a name="l00460"></a>00460         );
<a name="l00461"></a>00461     }
<a name="l00462"></a>00462 
<a name="l00474"></a><a class="code" href="classCPSFacebook.html#ac6277cff127391498ddceffc115a6f94">00474</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#ac6277cff127391498ddceffc115a6f94">getLoginStatusUrl</a>( $paramList = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>() )
<a name="l00475"></a>00475     {
<a name="l00476"></a>00476         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCPSFacebook.html#a719203fb2a7e839997705e75e0bcc9a1">_getUrl</a>(
<a name="l00477"></a>00477             <span class="stringliteral">&#39;www&#39;</span>,
<a name="l00478"></a>00478             <span class="stringliteral">&#39;extern/login_status.php&#39;</span>,
<a name="l00479"></a>00479             array_merge( <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00480"></a>00480                 <span class="stringliteral">&#39;api_key&#39;</span> =&gt; $this-&gt;_appId,
<a name="l00481"></a>00481                 <span class="stringliteral">&#39;no_session&#39;</span> =&gt; $this-&gt;<a class="code" href="classCPSFacebook.html#a1d2b68391ad44fe79ecef5ecd09feec3">_getCurrentUrl</a>(),
<a name="l00482"></a>00482                 <span class="stringliteral">&#39;no_user&#39;</span> =&gt; $this-&gt;<a class="code" href="classCPSFacebook.html#a1d2b68391ad44fe79ecef5ecd09feec3">_getCurrentUrl</a>(),
<a name="l00483"></a>00483                 <span class="stringliteral">&#39;ok_session&#39;</span> =&gt; $this-&gt;<a class="code" href="classCPSFacebook.html#a1d2b68391ad44fe79ecef5ecd09feec3">_getCurrentUrl</a>(),
<a name="l00484"></a>00484                 <span class="stringliteral">&#39;session_version&#39;</span> =&gt; 3,
<a name="l00485"></a>00485             ), $paramList )
<a name="l00486"></a>00486         );
<a name="l00487"></a>00487     }
<a name="l00488"></a>00488 
<a name="l00495"></a><a class="code" href="classCPSFacebook.html#aa238fcc5cb30759876aa89cd2e0711c1">00495</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebook.html#aa238fcc5cb30759876aa89cd2e0711c1">api</a>( <span class="comment">/* polymorphic */</span> )
<a name="l00496"></a>00496     {
<a name="l00497"></a>00497         $_args = func_get_args();
<a name="l00498"></a>00498 
<a name="l00499"></a>00499         <span class="keywordflow">if</span> ( is_array( $_args ) &amp;&amp; count( $_args ) &amp;&amp; is_array( $_args[0] ) )
<a name="l00500"></a>00500             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCPSFacebook.html#a896336f5000bed98a0e59b3b38b8b8e1">_restserver</a>( $_args[0] );
<a name="l00501"></a>00501 
<a name="l00502"></a>00502         <span class="keywordflow">return</span> call_user_func_array( <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( &amp;$this, <span class="stringliteral">&#39;_graph&#39;</span> ), $_args );
<a name="l00503"></a>00503     }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505     <span class="comment">//********************************************************************************</span>
<a name="l00506"></a>00506     <span class="comment">//* Private Methods</span>
<a name="l00507"></a>00507     <span class="comment">//********************************************************************************</span>
<a name="l00508"></a>00508 
<a name="l00513"></a><a class="code" href="classCPSFacebook.html#a69c13b5e61215433a48b9a6742f16660">00513</a>     <span class="keyword">protected</span> function <a class="code" href="classCPSFacebook.html#a69c13b5e61215433a48b9a6742f16660">_getSessionCookieName</a>()
<a name="l00514"></a>00514     {
<a name="l00515"></a>00515         <span class="keywordflow">return</span> <span class="stringliteral">&#39;pYe_fb_&#39;</span> . $this-&gt;_appId;
<a name="l00516"></a>00516     }
<a name="l00517"></a>00517 
<a name="l00525"></a><a class="code" href="classCPSFacebook.html#a896336f5000bed98a0e59b3b38b8b8e1">00525</a>     <span class="keyword">protected</span> function <a class="code" href="classCPSFacebook.html#a896336f5000bed98a0e59b3b38b8b8e1">_restserver</a>( $paramList )
<a name="l00526"></a>00526     {
<a name="l00527"></a>00527         <span class="comment">//  Generic application level parameters</span>
<a name="l00528"></a>00528         $paramList[<span class="stringliteral">&#39;api_key&#39;</span>] = $this-&gt;_appId;
<a name="l00529"></a>00529         $paramList[<span class="stringliteral">&#39;format&#39;</span>] = <span class="stringliteral">&#39;json-strings&#39;</span>;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531         $_result = json_decode( $this-&gt;<a class="code" href="classCPSFacebook.html#a0519e81c281afecdca2d58dd75d164f0">_oauthRequest</a>( $this-&gt;<a class="code" href="classCPSFacebook.html#a0e0a4234900c6b099259f0fc0ab65a67">_getApiUrl</a>( PS::o( $paramList, <span class="stringliteral">&#39;method&#39;</span> ) ), $paramList ), <span class="keyword">true</span> );
<a name="l00532"></a>00532 
<a name="l00533"></a>00533         <span class="comment">//  Results are returned, errors are thrown</span>
<a name="l00534"></a>00534         <span class="keywordflow">if</span> ( PS::o( $_result, <span class="stringliteral">&#39;error_code&#39;</span> ) )
<a name="l00535"></a>00535             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCPSFacebookApiException.html">CPSFacebookApiException</a>( $_result );
<a name="l00536"></a>00536 
<a name="l00537"></a>00537         <span class="keywordflow">return</span> $_result;
<a name="l00538"></a>00538     }
<a name="l00539"></a>00539 
<a name="l00549"></a><a class="code" href="classCPSFacebook.html#a3fc1ae91766eca08b5a6fc48a6c6ebe2">00549</a>     <span class="keyword">protected</span> function <a class="code" href="classCPSFacebook.html#a3fc1ae91766eca08b5a6fc48a6c6ebe2">_graph</a>( $path, $method = <span class="stringliteral">&#39;GET&#39;</span>, $paramList = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>() )
<a name="l00550"></a>00550     {
<a name="l00551"></a>00551         <span class="keywordflow">if</span> ( is_array( $method ) &amp;&amp; empty( $paramList ) )
<a name="l00552"></a>00552         {
<a name="l00553"></a>00553             $paramList = $method;
<a name="l00554"></a>00554             $method = <span class="stringliteral">&#39;GET&#39;</span>;
<a name="l00555"></a>00555         }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557         <span class="comment">//  Method override as we always do a POST</span>
<a name="l00558"></a>00558         $paramList[<span class="stringliteral">&#39;method&#39;</span>] = $method;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560         $_result = $this-&gt;<a class="code" href="classCPSFacebook.html#a0519e81c281afecdca2d58dd75d164f0">_oauthRequest</a>( $this-&gt;<a class="code" href="classCPSFacebook.html#a719203fb2a7e839997705e75e0bcc9a1">_getUrl</a>( <span class="stringliteral">&#39;graph&#39;</span>, $path ), $paramList );
<a name="l00561"></a>00561         $_result = json_decode( $_result, <span class="keyword">true</span> );
<a name="l00562"></a>00562 
<a name="l00563"></a>00563         <span class="comment">//  Results are returned, errors are thrown</span>
<a name="l00564"></a>00564         <span class="keywordflow">if</span> ( PS::o( $_result, <span class="stringliteral">&#39;error&#39;</span> ) )
<a name="l00565"></a>00565         {
<a name="l00566"></a>00566             $_ex = <span class="keyword">new</span> <a class="code" href="classCPSFacebookApiException.html">CPSFacebookApiException</a>( $_result );
<a name="l00567"></a>00567 
<a name="l00568"></a>00568             <span class="keywordflow">switch</span> ( $_ex-&gt;getType() )
<a name="l00569"></a>00569             {
<a name="l00570"></a>00570                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;OAuthException&#39;</span>:          <span class="comment">//  OAuth 2.0 Draft 00 style</span>
<a name="l00571"></a>00571                 <span class="keywordflow">case</span> <span class="stringliteral">&#39;invalid_token&#39;</span>:           <span class="comment">//  OAuth 2.0 Draft 10 style</span>
<a name="l00572"></a>00572                     $this-&gt;<a class="code" href="classCPSFacebook.html#a83fd4ea8255385abd72c27a762691e2d">setSession</a>( null );
<a name="l00573"></a>00573                     <span class="keywordflow">break</span>;
<a name="l00574"></a>00574             }
<a name="l00575"></a>00575 
<a name="l00576"></a>00576             <span class="keywordflow">throw</span> $_ex;
<a name="l00577"></a>00577         }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579         <span class="keywordflow">return</span> $_result;
<a name="l00580"></a>00580     }
<a name="l00581"></a>00581 
<a name="l00590"></a><a class="code" href="classCPSFacebook.html#a0519e81c281afecdca2d58dd75d164f0">00590</a>     <span class="keyword">protected</span> function <a class="code" href="classCPSFacebook.html#a0519e81c281afecdca2d58dd75d164f0">_oauthRequest</a>( $url, $paramList )
<a name="l00591"></a>00591     {
<a name="l00592"></a>00592         <span class="keywordflow">if</span> ( ! isset( $paramList[<span class="stringliteral">&#39;access_token&#39;</span>] ) )
<a name="l00593"></a>00593             $paramList[<span class="stringliteral">&#39;access_token&#39;</span>] = $this-&gt;<a class="code" href="classCPSFacebook.html#a5d251c70a3f9f9daaff7f00ec5f894c0">getAccessToken</a>();
<a name="l00594"></a>00594 
<a name="l00595"></a>00595         <span class="comment">//  json_encode all params values that are not strings</span>
<a name="l00596"></a>00596         <span class="keywordflow">foreach</span> ( $paramList as $_key =&gt; $_value )
<a name="l00597"></a>00597         {
<a name="l00598"></a>00598             <span class="keywordflow">if</span> ( ! is_string( $_value ) )
<a name="l00599"></a>00599                 $paramList[$_key] = json_encode( $_value );
<a name="l00600"></a>00600         }
<a name="l00601"></a>00601 
<a name="l00602"></a>00602         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCPSFacebook.html#ae101534735ff109fc2b6ce694033e42e">_makeRequest</a>( $url, $paramList );
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604 
<a name="l00615"></a><a class="code" href="classCPSFacebook.html#ae101534735ff109fc2b6ce694033e42e">00615</a>     <span class="keyword">protected</span> function <a class="code" href="classCPSFacebook.html#ae101534735ff109fc2b6ce694033e42e">_makeRequest</a>( $url, $paramList, $curl = null )
<a name="l00616"></a>00616     {
<a name="l00617"></a>00617         <span class="keywordflow">if</span> ( ! $curl ) $curl = curl_init();
<a name="l00618"></a>00618 
<a name="l00619"></a>00619         $_options = self::$_CURL_OPTS;
<a name="l00620"></a>00620 
<a name="l00621"></a>00621         <span class="keywordflow">if</span> ( $this-&gt;_fileUploadSupport )
<a name="l00622"></a>00622             $_options[CURLOPT_POSTFIELDS] = $paramList;
<a name="l00623"></a>00623         <span class="keywordflow">else</span>
<a name="l00624"></a>00624             $_options[CURLOPT_POSTFIELDS] = http_build_query( $paramList, null, <span class="charliteral">&#39;&amp;&#39;</span> );
<a name="l00625"></a>00625 
<a name="l00626"></a>00626         $_options[CURLOPT_URL] = $url;
<a name="l00627"></a>00627 
<a name="l00632"></a>00632         <span class="keywordflow">if</span> ( ! isset( $_options[CURLOPT_HTTPHEADER] ) )
<a name="l00633"></a>00633             $_options[CURLOPT_HTTPHEADER] = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( <span class="stringliteral">&#39;Expect:&#39;</span> );
<a name="l00634"></a>00634         <span class="keywordflow">else</span>
<a name="l00635"></a>00635         {
<a name="l00636"></a>00636             $_headers = $opts[CURLOPT_HTTPHEADER];
<a name="l00637"></a>00637             $_headers[] = <span class="stringliteral">&#39;Expect:&#39;</span>;
<a name="l00638"></a>00638             $_options[CURLOPT_HTTPHEADER] = $_headers;
<a name="l00639"></a>00639         }
<a name="l00640"></a>00640 
<a name="l00641"></a>00641         curl_setopt_array( $curl, $_options );
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         $_result = curl_exec( $curl );
<a name="l00644"></a>00644 
<a name="l00645"></a>00645         <span class="keywordflow">if</span> ( <span class="keyword">false</span> === $_result )
<a name="l00646"></a>00646         {
<a name="l00647"></a>00647             $_ex = <span class="keyword">new</span> <a class="code" href="classCPSFacebookApiException.html">CPSFacebookApiException</a>(
<a name="l00648"></a>00648                 <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00649"></a>00649                     <span class="stringliteral">&#39;error_code&#39;</span> =&gt; curl_errno( $curl ),
<a name="l00650"></a>00650                     <span class="stringliteral">&#39;error&#39;</span> =&gt; <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00651"></a>00651                         <span class="stringliteral">&#39;message&#39;</span> =&gt; curl_error( $curl ),
<a name="l00652"></a>00652                         <span class="stringliteral">&#39;type&#39;</span> =&gt; <span class="stringliteral">&#39;CurlException&#39;</span>,
<a name="l00653"></a>00653                     ),
<a name="l00654"></a>00654                 )
<a name="l00655"></a>00655             );
<a name="l00656"></a>00656 
<a name="l00657"></a>00657             curl_close( $curl );
<a name="l00658"></a>00658 
<a name="l00659"></a>00659             <span class="keywordflow">throw</span> $_ex;
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661 
<a name="l00662"></a>00662         curl_close( $curl );
<a name="l00663"></a>00663         <span class="keywordflow">return</span> $_result;
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665 
<a name="l00672"></a><a class="code" href="classCPSFacebook.html#a818b7c88630a9f0a6318aecb55160c38">00672</a>     <span class="keyword">protected</span> function <a class="code" href="classCPSFacebook.html#a818b7c88630a9f0a6318aecb55160c38">_setCookieFromSession</a>( $session = null )
<a name="l00673"></a>00673     {
<a name="l00674"></a>00674         <span class="keywordflow">if</span> ( ! $this-&gt;_enableCookieSupport )
<a name="l00675"></a>00675             <span class="keywordflow">return</span>;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677         $_cookieName = $this-&gt;<a class="code" href="classCPSFacebook.html#a69c13b5e61215433a48b9a6742f16660">_getSessionCookieName</a>();
<a name="l00678"></a>00678         $_value = <span class="stringliteral">&#39;deleted&#39;</span>;
<a name="l00679"></a>00679         $_expires = time() - 3600;
<a name="l00680"></a>00680 
<a name="l00681"></a>00681         $_domain = $this-&gt;<a class="code" href="classCPSFacebook.html#ab0b9668fe081b3b7eb36307bcb7688e8">getBaseDomain</a>();
<a name="l00682"></a>00682 
<a name="l00683"></a>00683         <span class="keywordflow">if</span> ( $session )
<a name="l00684"></a>00684         {
<a name="l00685"></a>00685             $_value = <span class="charliteral">&#39;&quot;&#39;</span> . http_build_query( $session, null, <span class="charliteral">&#39;&amp;&#39;</span> ) . <span class="charliteral">&#39;&quot;&#39;</span>;
<a name="l00686"></a>00686 
<a name="l00687"></a>00687             <span class="keywordflow">if</span> ( isset( $session[<span class="stringliteral">&#39;base_domain&#39;</span>] ) )
<a name="l00688"></a>00688                 $_domain = $session[<span class="stringliteral">&#39;base_domain&#39;</span>];
<a name="l00689"></a>00689 
<a name="l00690"></a>00690             $_expires = $session[<span class="stringliteral">&#39;expires&#39;</span>];
<a name="l00691"></a>00691         }
<a name="l00692"></a>00692 
<a name="l00693"></a>00693         <span class="comment">//  prepend dot if a domain is found</span>
<a name="l00694"></a>00694         <span class="keywordflow">if</span> ( $_domain ) $_domain = <span class="charliteral">&#39;.&#39;</span> . $_domain;
<a name="l00695"></a>00695 
<a name="l00696"></a>00696         <span class="comment">//  if an existing cookie is not set, we dont need to delete it</span>
<a name="l00697"></a>00697         <span class="keywordflow">if</span> ( $_value == <span class="stringliteral">&#39;deleted&#39;</span> &amp;&amp; empty( $_COOKIE[$_cookieName] ) )
<a name="l00698"></a>00698             <span class="keywordflow">return</span>;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700         <span class="keywordflow">if</span> ( headers_sent() )
<a name="l00701"></a>00701         {
<a name="l00702"></a>00702             <span class="comment">// disable error log if we are running in a CLI environment</span>
<a name="l00703"></a>00703             <span class="comment">// @codeCoverageIgnoreStart</span>
<a name="l00704"></a>00704             <span class="keywordflow">if</span> ( php_sapi_name() != <span class="stringliteral">&#39;cli&#39;</span> )
<a name="l00705"></a>00705                 <a class="code" href="classCPSLog.html#a99034739d5e469b037364bf2f5694e11">CPSLog::error</a>( __METHOD__, <span class="stringliteral">&#39;Could not set cookie. Headers already sent.&#39;</span> );
<a name="l00706"></a>00706             <span class="comment">// @codeCoverageIgnoreEnd</span>
<a name="l00707"></a>00707 
<a name="l00708"></a>00708         <span class="comment">// ignore for code coverage as we will never be able to setcookie in a CLI</span>
<a name="l00709"></a>00709         <span class="comment">// environment</span>
<a name="l00710"></a>00710         <span class="comment">// @codeCoverageIgnoreStart</span>
<a name="l00711"></a>00711         }
<a name="l00712"></a>00712         <span class="keywordflow">else</span>
<a name="l00713"></a>00713         {
<a name="l00714"></a>00714             setcookie( $_cookieName, $_value, $_expires, <span class="charliteral">&#39;/&#39;</span>, $_domain );
<a name="l00715"></a>00715         }
<a name="l00716"></a>00716         <span class="comment">// @codeCoverageIgnoreEnd</span>
<a name="l00717"></a>00717     }
<a name="l00718"></a>00718 
<a name="l00725"></a><a class="code" href="classCPSFacebook.html#a7dd3fb0ddff204e195f91b8719104a61">00725</a>     <span class="keyword">protected</span> function <a class="code" href="classCPSFacebook.html#a7dd3fb0ddff204e195f91b8719104a61">_validateSessionObject</a>( $session )
<a name="l00726"></a>00726     {
<a name="l00727"></a>00727         <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = null;
<a name="l00728"></a>00728 
<a name="l00729"></a>00729         <span class="comment">//  Make sure some essential fields exist</span>
<a name="l00730"></a>00730         <span class="keywordflow">if</span> ( is_array( $session ) &amp;&amp; isset( $session[<span class="stringliteral">&#39;uid&#39;</span>], $session[<span class="stringliteral">&#39;access_token&#39;</span>], $session[<span class="stringliteral">&#39;sig&#39;</span>] ) )
<a name="l00731"></a>00731         {
<a name="l00732"></a>00732             <span class="comment">//  Validate the signature</span>
<a name="l00733"></a>00733             $_noSigSession = $session;
<a name="l00734"></a>00734             unset( $_noSigSession[<span class="stringliteral">&#39;sig&#39;</span>] );
<a name="l00735"></a>00735 
<a name="l00736"></a>00736             $_expectedSig = <a class="code" href="classCPSFacebook.html#a9a1bb3c0a4009df8453e84cb39506723">self::_generateSignature</a>(
<a name="l00737"></a>00737                 $_noSigSession,
<a name="l00738"></a>00738                 $this-&gt;_apiSecretKey
<a name="l00739"></a>00739             );
<a name="l00740"></a>00740 
<a name="l00741"></a>00741             <span class="keywordflow">if</span> ( $session[<span class="stringliteral">&#39;sig&#39;</span>] != $_expectedSig )
<a name="l00742"></a>00742             {
<a name="l00743"></a>00743                 <span class="comment">//  Disable error log if we are running in a CLI environment</span>
<a name="l00744"></a>00744                 <span class="comment">//  @codeCoverageIgnoreStart</span>
<a name="l00745"></a>00745                 <span class="keywordflow">if</span> ( php_sapi_name() != <span class="stringliteral">&#39;cli&#39;</span> )
<a name="l00746"></a>00746                     <a class="code" href="classCPSLog.html#a99034739d5e469b037364bf2f5694e11">CPSLog::error</a>( __METHOD__, <span class="stringliteral">&#39;Got invalid session signature in cookie.&#39;</span> );
<a name="l00747"></a>00747                 <span class="comment">// @codeCoverageIgnoreEnd</span>
<a name="l00748"></a>00748                 $session = null;
<a name="l00749"></a>00749             }
<a name="l00750"></a>00750 
<a name="l00751"></a>00751             <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = $session;
<a name="l00752"></a>00752         }
<a name="l00753"></a>00753 
<a name="l00754"></a>00754         <span class="keywordflow">return</span> <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>;
<a name="l00755"></a>00755     }
<a name="l00756"></a>00756 
<a name="l00765"></a><a class="code" href="classCPSFacebook.html#ad095f729036d48a23d321839f3ea7853">00765</a>     <span class="keyword">protected</span> function <a class="code" href="classCPSFacebook.html#ad095f729036d48a23d321839f3ea7853">_createSessionFromSignedRequest</a>( $data )
<a name="l00766"></a>00766     {
<a name="l00767"></a>00767         <span class="keywordflow">if</span> ( ! PS::o( $data, <span class="stringliteral">&#39;oauth_token&#39;</span> ) )
<a name="l00768"></a>00768             <span class="keywordflow">return</span> null;
<a name="l00769"></a>00769 
<a name="l00770"></a>00770         <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
<a name="l00771"></a>00771             <span class="stringliteral">&#39;uid&#39;</span> =&gt; PS::o( $data, <span class="stringliteral">&#39;user_id&#39;</span> ),
<a name="l00772"></a>00772             <span class="stringliteral">&#39;access_token&#39;</span> =&gt; PS::o( $data, <span class="stringliteral">&#39;oauth_token&#39;</span> ),
<a name="l00773"></a>00773             <span class="stringliteral">&#39;expires&#39;</span> =&gt; PS::o( $data, <span class="stringliteral">&#39;expires&#39;</span> ),
<a name="l00774"></a>00774         );
<a name="l00775"></a>00775 
<a name="l00776"></a>00776         <span class="comment">//  Put a real sig, so that validateSignature works</span>
<a name="l00777"></a>00777         <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>[<span class="stringliteral">&#39;sig&#39;</span>] = <a class="code" href="classCPSFacebook.html#a9a1bb3c0a4009df8453e84cb39506723">self::_generateSignature</a>(
<a name="l00778"></a>00778             <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>,
<a name="l00779"></a>00779             $this-&gt;_apiSecretKey
<a name="l00780"></a>00780         );
<a name="l00781"></a>00781 
<a name="l00782"></a>00782         <span class="keywordflow">return</span> <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>;
<a name="l00783"></a>00783     }
<a name="l00784"></a>00784 
<a name="l00793"></a><a class="code" href="classCPSFacebook.html#a2b963de2da5e5d03684f94c360f948ea">00793</a>     <span class="keyword">protected</span> function <a class="code" href="classCPSFacebook.html#a2b963de2da5e5d03684f94c360f948ea">_parseSignedRequest</a>( <a class="code" href="classCPSFacebook.html#a6b432430b58baf6351a7507208363d80">$_signedRequest</a> )
<a name="l00794"></a>00794     {
<a name="l00795"></a>00795         list( $_encodedSignature, <a class="code" href="classCPSApiComponent.html#a01bc135256923b2605138f01e3f81d76">$_payload</a> ) = explode( <span class="charliteral">&#39;.&#39;</span>, <a class="code" href="classCPSFacebook.html#a6b432430b58baf6351a7507208363d80">$_signedRequest</a>, 2 );
<a name="l00796"></a>00796 
<a name="l00797"></a>00797         <span class="comment">//  decode the data</span>
<a name="l00798"></a>00798         $_signature = <a class="code" href="classCPSFacebook.html#a7cc54c00b8b799176e515bd2d26a6868">self::_base64UrlDecode</a>( $_encodedSignature );
<a name="l00799"></a>00799         $data = json_decode( self::_base64UrlDecode( <a class="code" href="classCPSApiComponent.html#a01bc135256923b2605138f01e3f81d76">$_payload</a> ), <span class="keyword">true</span> );
<a name="l00800"></a>00800 
<a name="l00801"></a>00801         <span class="keywordflow">if</span> ( <span class="stringliteral">&#39;HMAC-SHA256&#39;</span> !== strtoupper( $data[<span class="stringliteral">&#39;algorithm&#39;</span>] ) )
<a name="l00802"></a>00802         {
<a name="l00803"></a>00803             <span class="comment">//  Disable error log if we are running in a CLI environment</span>
<a name="l00804"></a>00804             <span class="comment">//  @codeCoverageIgnoreStart</span>
<a name="l00805"></a>00805             <span class="keywordflow">if</span> ( php_sapi_name() != <span class="stringliteral">&#39;cli&#39;</span> )
<a name="l00806"></a>00806                 <a class="code" href="classCPSLog.html#a99034739d5e469b037364bf2f5694e11">CPSLog::error</a>( __METHOD__, <span class="stringliteral">&#39;Unknown algorithm. Expected HMAC-SHA256&#39;</span> );
<a name="l00807"></a>00807             <span class="comment">// @codeCoverageIgnoreEnd</span>
<a name="l00808"></a>00808             <span class="keywordflow">return</span> null;
<a name="l00809"></a>00809         }
<a name="l00810"></a>00810 
<a name="l00811"></a>00811         <span class="comment">//  Check signature</span>
<a name="l00812"></a>00812         $_expectedSignature = hash_hmac( <span class="stringliteral">&#39;sha256&#39;</span>, <a class="code" href="classCPSApiComponent.html#a01bc135256923b2605138f01e3f81d76">$_payload</a>, $this-&gt;_apiSecretKey, <span class="keyword">true</span> );
<a name="l00813"></a>00813 
<a name="l00814"></a>00814         <span class="keywordflow">if</span> ( defined( <span class="stringliteral">&#39;PYE_TRACE_LEVEL&#39;</span> ) &amp;&amp; PYE_TRACE_LEVEL &gt; 3 )
<a name="l00815"></a>00815             <a class="code" href="classCPSLog.html#ab8a624f93a0bfc699dd00c01af886955">CPSLog::trace</a>( __METHOD__, <span class="stringliteral">&#39;Sig:[&#39;</span> . $_signature . <span class="stringliteral">&#39;] expect:[&#39;</span> . $_expectedSignature . <span class="charliteral">&#39;]&#39;</span> );
<a name="l00816"></a>00816 
<a name="l00817"></a>00817         <span class="keywordflow">if</span> ( $_signature !== $_expectedSignature )
<a name="l00818"></a>00818         {
<a name="l00819"></a>00819             <span class="comment">//  Disable error log if we are running in a CLI environment</span>
<a name="l00820"></a>00820             <span class="comment">//  @codeCoverageIgnoreStart</span>
<a name="l00821"></a>00821             <span class="keywordflow">if</span> ( php_sapi_name() != <span class="stringliteral">&#39;cli&#39;</span> )
<a name="l00822"></a>00822                 <a class="code" href="classCPSLog.html#a99034739d5e469b037364bf2f5694e11">CPSLog::error</a>( __METHOD__, <span class="stringliteral">&#39;Bad Signed JSON signature!&#39;</span> );
<a name="l00823"></a>00823             <span class="comment">// @codeCoverageIgnoreEnd</span>
<a name="l00824"></a>00824             <span class="keywordflow">return</span> null;
<a name="l00825"></a>00825         }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827         <span class="keywordflow">return</span> $data;
<a name="l00828"></a>00828     }
<a name="l00829"></a>00829 
<a name="l00836"></a><a class="code" href="classCPSFacebook.html#a0e0a4234900c6b099259f0fc0ab65a67">00836</a>     <span class="keyword">protected</span> function <a class="code" href="classCPSFacebook.html#a0e0a4234900c6b099259f0fc0ab65a67">_getApiUrl</a>( $method )
<a name="l00837"></a>00837     {
<a name="l00838"></a>00838         $_name = <span class="stringliteral">&#39;api&#39;</span>;
<a name="l00839"></a>00839 
<a name="l00840"></a>00840         <span class="keywordflow">if</span> ( PS::o( <a class="code" href="classCPSFacebook.html#ae5e971be39413de8adc0e47624dbee86">$READ_ONLY_CALLS</a>, strtolower( $method ) ) )
<a name="l00841"></a>00841             $_name = <span class="stringliteral">&#39;api_read&#39;</span>;
<a name="l00842"></a>00842 
<a name="l00843"></a>00843         <span class="keywordflow">return</span> <a class="code" href="classCPSFacebook.html#a719203fb2a7e839997705e75e0bcc9a1">self::_getUrl</a>( $_name, <span class="stringliteral">&#39;restserver.php&#39;</span> );
<a name="l00844"></a>00844     }
<a name="l00845"></a>00845 
<a name="l00854"></a><a class="code" href="classCPSFacebook.html#a719203fb2a7e839997705e75e0bcc9a1">00854</a>     <span class="keyword">protected</span> function <a class="code" href="classCPSFacebook.html#a719203fb2a7e839997705e75e0bcc9a1">_getUrl</a>( $name, $path = null, $paramList = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>() )
<a name="l00855"></a>00855     {
<a name="l00856"></a>00856         $_url = self::$_DOMAIN_MAP[$name];
<a name="l00857"></a>00857 
<a name="l00858"></a>00858         <span class="keywordflow">if</span> ( null != $path )
<a name="l00859"></a>00859         {
<a name="l00860"></a>00860             <span class="keywordflow">if</span> ( $path[0] == <span class="charliteral">&#39;/&#39;</span> )
<a name="l00861"></a>00861                 $path = substr( $path, 1 );
<a name="l00862"></a>00862 
<a name="l00863"></a>00863             $_url .= $path;
<a name="l00864"></a>00864         }
<a name="l00865"></a>00865 
<a name="l00866"></a>00866         <span class="keywordflow">if</span> ( $paramList ) $_url .= <span class="charliteral">&#39;?&#39;</span> . http_build_query( $paramList );
<a name="l00867"></a>00867 
<a name="l00868"></a>00868         <span class="keywordflow">return</span> $_url;
<a name="l00869"></a>00869     }
<a name="l00870"></a>00870 
<a name="l00877"></a><a class="code" href="classCPSFacebook.html#a1d2b68391ad44fe79ecef5ecd09feec3">00877</a>     <span class="keyword">protected</span> function <a class="code" href="classCPSFacebook.html#a1d2b68391ad44fe79ecef5ecd09feec3">_getCurrentUrl</a>()
<a name="l00878"></a>00878     {
<a name="l00879"></a>00879         $_proto = PS::o( $_SERVER, <span class="stringliteral">&#39;HTTPS&#39;</span> ) == <span class="stringliteral">&#39;on&#39;</span> ? <span class="stringliteral">&#39;https://&#39;</span> : <span class="stringliteral">&#39;http://&#39;</span>;
<a name="l00880"></a>00880         $_currentUrl = $_proto . $_SERVER[<span class="stringliteral">&#39;HTTP_HOST&#39;</span>] . $_SERVER[<span class="stringliteral">&#39;REQUEST_URI&#39;</span>];
<a name="l00881"></a>00881         $_parts = parse_url( $_currentUrl );
<a name="l00882"></a>00882 
<a name="l00883"></a>00883         <span class="comment">//  Drop known fb params</span>
<a name="l00884"></a>00884         $_query = null;
<a name="l00885"></a>00885 
<a name="l00886"></a>00886         <span class="keywordflow">if</span> ( ! empty( $_parts[<span class="stringliteral">&#39;query&#39;</span>] ) )
<a name="l00887"></a>00887         {
<a name="l00888"></a>00888             $_paramList = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>();
<a name="l00889"></a>00889 
<a name="l00890"></a>00890             parse_str( $_parts[<span class="stringliteral">&#39;query&#39;</span>], $_paramList );
<a name="l00891"></a>00891 
<a name="l00892"></a>00892             <span class="keywordflow">foreach</span> ( self::$_DROP_QUERY_PARAMS as $_key )
<a name="l00893"></a>00893                 unset( $_paramList[$_key] );
<a name="l00894"></a>00894 
<a name="l00895"></a>00895             <span class="keywordflow">if</span> ( ! empty( $_paramList ) )
<a name="l00896"></a>00896                 $_query = <span class="charliteral">&#39;?&#39;</span> . http_build_query( $_paramList );
<a name="l00897"></a>00897         }
<a name="l00898"></a>00898 
<a name="l00899"></a>00899         <span class="comment">//  use port if non default</span>
<a name="l00900"></a>00900         $_port = isset( $_parts[<span class="stringliteral">&#39;port&#39;</span>] ) &amp;&amp; ( ( $_proto === <span class="stringliteral">&#39;http://&#39;</span> &amp;&amp; $_parts[<span class="stringliteral">&#39;port&#39;</span>] !== 80 ) || ( $_proto === <span class="stringliteral">&#39;https://&#39;</span> &amp;&amp; $_parts[<span class="stringliteral">&#39;port&#39;</span>] !== 443 ) ) ? <span class="charliteral">&#39;:&#39;</span> . $_parts[<span class="stringliteral">&#39;port&#39;</span>] : <span class="stringliteral">&#39;&#39;</span>;
<a name="l00901"></a>00901 
<a name="l00902"></a>00902         <span class="comment">//  Rebuild</span>
<a name="l00903"></a>00903         <span class="keywordflow">return</span> $_proto . $_parts[<span class="stringliteral">&#39;host&#39;</span>] . $_port . $_parts[<span class="stringliteral">&#39;path&#39;</span>] . $_query;
<a name="l00904"></a>00904     }
<a name="l00905"></a>00905 
<a name="l00913"></a><a class="code" href="classCPSFacebook.html#a9a1bb3c0a4009df8453e84cb39506723">00913</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classCPSFacebook.html#a9a1bb3c0a4009df8453e84cb39506723">_generateSignature</a>( $paramList, $_secretKey )
<a name="l00914"></a>00914     {
<a name="l00915"></a>00915         <span class="comment">//  Work with sorted data</span>
<a name="l00916"></a>00916         ksort( $paramList );
<a name="l00917"></a>00917 
<a name="l00918"></a>00918         <span class="comment">//  Generate the base string</span>
<a name="l00919"></a>00919         $_baseString = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00920"></a>00920 
<a name="l00921"></a>00921         <span class="keywordflow">foreach</span> ( $paramList as $_key =&gt; $_value )
<a name="l00922"></a>00922             $_baseString .= $_key . <span class="charliteral">&#39;=&#39;</span> . $_value;
<a name="l00923"></a>00923 
<a name="l00924"></a>00924         $_baseString .= $_secretKey;
<a name="l00925"></a>00925 
<a name="l00926"></a>00926         <span class="keywordflow">return</span> md5( $_baseString );
<a name="l00927"></a>00927     }
<a name="l00928"></a>00928 
<a name="l00937"></a><a class="code" href="classCPSFacebook.html#a7cc54c00b8b799176e515bd2d26a6868">00937</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classCPSFacebook.html#a7cc54c00b8b799176e515bd2d26a6868">_base64UrlDecode</a>( $source )
<a name="l00938"></a>00938     {
<a name="l00939"></a>00939         <span class="keywordflow">return</span> base64_decode( strtr( $source, <span class="stringliteral">&#39;-_&#39;</span>, <span class="stringliteral">&#39;+/&#39;</span> ) );
<a name="l00940"></a>00940     }
<a name="l00941"></a>00941 
<a name="l00946"></a><a class="code" href="classCPSFacebook.html#ad8d438fe02fb781abe815fd5972795ff">00946</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classCPSFacebook.html#ad8d438fe02fb781abe815fd5972795ff">_getUnsignedSession</a>()
<a name="l00947"></a>00947     {
<a name="l00948"></a>00948         <span class="keywordflow">if</span> ( isset( $_REQUEST[<span class="stringliteral">&#39;fb_sig_user&#39;</span>] ) )
<a name="l00949"></a>00949         {
<a name="l00950"></a>00950             <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>();
<a name="l00951"></a>00951 
<a name="l00952"></a>00952             <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>[<span class="stringliteral">&#39;uid&#39;</span>] = PS::o( $_REQUEST, <span class="stringliteral">&#39;fb_sig_user&#39;</span> );
<a name="l00953"></a>00953             <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>[<span class="stringliteral">&#39;access_token&#39;</span>] = $this-&gt;_appId . <span class="charliteral">&#39;|&#39;</span> . PS::o( $_REQUEST, <span class="stringliteral">&#39;fb_sig_session_key&#39;</span> );
<a name="l00954"></a>00954             <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>[<span class="stringliteral">&#39;expires&#39;</span>] = PS::o( $_REQUEST, <span class="stringliteral">&#39;fb_sig_expires&#39;</span> );
<a name="l00955"></a>00955             <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>[<span class="stringliteral">&#39;base_domain&#39;</span>] = PS::o( $_REQUEST, <span class="stringliteral">&#39;fb_sig_base_domain&#39;</span> );
<a name="l00956"></a>00956             <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>[<span class="stringliteral">&#39;secret&#39;</span>] = PS::o( $_REQUEST, <span class="stringliteral">&#39;fb_sig_ss&#39;</span> );
<a name="l00957"></a>00957 
<a name="l00958"></a>00958             <span class="keywordflow">if</span> ( null !== ( <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>[<span class="stringliteral">&#39;session_key&#39;</span>] = PS::o( $_REQUEST, <span class="stringliteral">&#39;fb_sig_session_key&#39;</span> ) ) )
<a name="l00959"></a>00959             {
<a name="l00960"></a>00960                 ksort( <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> );
<a name="l00961"></a>00961 
<a name="l00962"></a>00962                 <span class="comment">// generate the base string</span>
<a name="l00963"></a>00963                 $_baseString = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00964"></a>00964 
<a name="l00965"></a>00965                 <span class="keywordflow">foreach</span> ( <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a> as $_key =&gt; $_value )
<a name="l00966"></a>00966                     $_baseString .= $_key . <span class="charliteral">&#39;=&#39;</span> . $_value;
<a name="l00967"></a>00967 
<a name="l00968"></a>00968                 $_baseString .= $this-&gt;_apiSecretKey;
<a name="l00969"></a>00969                 <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>[<span class="stringliteral">&#39;sig&#39;</span>] = md5( $_baseString );
<a name="l00970"></a>00970             }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972             <span class="keywordflow">return</span> <a class="code" href="classCPSFacebook.html#ad0641deaf4d314f034a134efaa6fbff0">$_session</a>;
<a name="l00973"></a>00973         }
<a name="l00974"></a>00974     }
<a name="l00975"></a>00975 
<a name="l00976"></a>00976 }
<a name="l00977"></a>00977 
<a name="l00996"></a><a class="code" href="classCPSFacebookApiException.html">00996</a> <span class="keyword">class </span><a class="code" href="classCPSFacebookApiException.html">CPSFacebookApiException</a> <span class="keyword">extends</span> <a class="code" href="classCPSException.html">CPSException</a>
<a name="l00997"></a>00997 {
<a name="l00998"></a>00998     <span class="comment">//********************************************************************************</span>
<a name="l00999"></a>00999     <span class="comment">//* Member Variables</span>
<a name="l01000"></a>01000     <span class="comment">//********************************************************************************</span>
<a name="l01001"></a>01001 
<a name="l01005"></a><a class="code" href="classCPSFacebookApiException.html#a4880874cac761eb1c11879f22950db5b">01005</a>     <span class="keyword">protected</span> <a class="code" href="classCPSFacebookApiException.html#a4880874cac761eb1c11879f22950db5b">$_result</a>;
<a name="l01006"></a><a class="code" href="classCPSFacebookApiException.html#ae077eb8a032a325ceb939bfabfa5f472">01006</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebookApiException.html#ae077eb8a032a325ceb939bfabfa5f472">getResult</a>() { <span class="keywordflow">return</span> $this-&gt;_result; }
<a name="l01007"></a>01007 
<a name="l01008"></a>01008     <span class="comment">//********************************************************************************</span>
<a name="l01009"></a>01009     <span class="comment">//* Public Methods</span>
<a name="l01010"></a>01010     <span class="comment">//********************************************************************************</span>
<a name="l01011"></a>01011 
<a name="l01016"></a><a class="code" href="classCPSFacebookApiException.html#aa7d9da69694e5a4bf2f0c1d7e85eb0f1">01016</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebookApiException.html#aa7d9da69694e5a4bf2f0c1d7e85eb0f1">__construct</a>( $result )
<a name="l01017"></a>01017     {
<a name="l01018"></a>01018         $this-&gt;_result = $result;
<a name="l01019"></a>01019         $_code = PS::o( <a class="code" href="classCPSFacebookApiException.html#a4880874cac761eb1c11879f22950db5b">$_result</a>, <span class="stringliteral">&#39;error_code&#39;</span>, 0 );
<a name="l01020"></a>01020 
<a name="l01021"></a>01021         <span class="keywordflow">if</span> ( isset( $result[<span class="stringliteral">&#39;error_description&#39;</span>] ) )
<a name="l01022"></a>01022         {
<a name="l01023"></a>01023             <span class="comment">//  OAuth 2.0 Draft 10 style</span>
<a name="l01024"></a>01024             $_message = $result[<span class="stringliteral">&#39;error_description&#39;</span>];
<a name="l01025"></a>01025         }
<a name="l01026"></a>01026         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset( $result[<span class="stringliteral">&#39;error&#39;</span>] ) &amp;&amp; is_array( $result[<span class="stringliteral">&#39;error&#39;</span>] ) )
<a name="l01027"></a>01027         {
<a name="l01028"></a>01028             <span class="comment">// OAuth 2.0 Draft 00 style</span>
<a name="l01029"></a>01029             $_message = $result[<span class="stringliteral">&#39;error&#39;</span>][<span class="stringliteral">&#39;message&#39;</span>];
<a name="l01030"></a>01030         }
<a name="l01031"></a>01031         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( isset( $result[<span class="stringliteral">&#39;error_msg&#39;</span>] ) )
<a name="l01032"></a>01032         {
<a name="l01033"></a>01033             <span class="comment">// Rest server style</span>
<a name="l01034"></a>01034             $_message = $result[<span class="stringliteral">&#39;error_msg&#39;</span>];
<a name="l01035"></a>01035         }
<a name="l01036"></a>01036         <span class="keywordflow">else</span>
<a name="l01037"></a>01037         {
<a name="l01038"></a>01038             $_message = <span class="stringliteral">&#39;Unknown Error. Check getResult()&#39;</span>;
<a name="l01039"></a>01039         }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041         <a class="code" href="classCPSFacebookApiException.html#aa7d9da69694e5a4bf2f0c1d7e85eb0f1">parent::__construct</a>( $_message, $_code );
<a name="l01042"></a>01042     }
<a name="l01043"></a>01043 
<a name="l01049"></a><a class="code" href="classCPSFacebookApiException.html#a830b5c75df72b32396701bc563fbe3c7">01049</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebookApiException.html#a830b5c75df72b32396701bc563fbe3c7">getType</a>()
<a name="l01050"></a>01050     {
<a name="l01051"></a>01051         <span class="keywordflow">if</span> ( isset( $this-&gt;_result[<span class="stringliteral">&#39;error&#39;</span>] ) )
<a name="l01052"></a>01052         {
<a name="l01053"></a>01053             $_error = $this-&gt;_result[<span class="stringliteral">&#39;error&#39;</span>];
<a name="l01054"></a>01054             <span class="keywordflow">if</span> ( is_string( $_error ) )
<a name="l01055"></a>01055             {
<a name="l01056"></a>01056                 <span class="comment">// OAuth 2.0 Draft 10 style</span>
<a name="l01057"></a>01057                 <span class="keywordflow">return</span> $_error;
<a name="l01058"></a>01058             }
<a name="l01059"></a>01059             <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( is_array( $_error ) )
<a name="l01060"></a>01060             {
<a name="l01061"></a>01061                 <span class="comment">// OAuth 2.0 Draft 00 style</span>
<a name="l01062"></a>01062                 <span class="keywordflow">if</span> ( isset( $_error[<span class="stringliteral">&#39;type&#39;</span>] ) )
<a name="l01063"></a>01063                 {
<a name="l01064"></a>01064                     <span class="keywordflow">return</span> $_error[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l01065"></a>01065                 }
<a name="l01066"></a>01066             }
<a name="l01067"></a>01067         }
<a name="l01068"></a>01068 
<a name="l01069"></a>01069         <span class="keywordflow">return</span> <span class="stringliteral">&#39;Exception&#39;</span>;
<a name="l01070"></a>01070     }
<a name="l01071"></a>01071 
<a name="l01076"></a><a class="code" href="classCPSFacebookApiException.html#a7516ca30af0db3cdbf9a7739b48ce91d">01076</a>     <span class="keyword">public</span> function <a class="code" href="classCPSFacebookApiException.html#a7516ca30af0db3cdbf9a7739b48ce91d">__toString</a>()
<a name="l01077"></a>01077     {
<a name="l01078"></a>01078         $_temp = $this-&gt;<a class="code" href="classCPSFacebookApiException.html#a830b5c75df72b32396701bc563fbe3c7">getType</a>() . <span class="stringliteral">&#39;: &#39;</span> . ( $this-&gt;code != 0 ? $this-&gt;code . <span class="stringliteral">&#39;: &#39;</span> : <span class="stringliteral">&#39;&#39;</span> ) . $this-&gt;message;
<a name="l01079"></a>01079     }
<a name="l01080"></a>01080 
<a name="l01081"></a>01081 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Mar 24 2011 20:11:38 for "The Yii Extension Library Of Doom!" by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
