<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>&quot;The Yii Extension Library Of Doom!&quot;: CPSModelCommand Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structure&nbsp;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&nbsp;Fields</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Data Fields</a> &#124;
<a href="#pro-methods">Protected Member Functions</a>  </div>
  <div class="headertitle">
<h1>CPSModelCommand Class Reference</h1>  </div>
</div>
<div class="contents">
<!-- doxytag: class="CPSModelCommand" --><!-- doxytag: inherits="CPSConsoleCommand" --><div class="dynheader">
Inheritance diagram for CPSModelCommand:</div>
<div class="dyncontent">
<div class="center"><img src="classCPSModelCommand__inherit__graph.png" border="0" usemap="#CPSModelCommand_inherit__map" alt="Inheritance graph"/></div>
<map name="CPSModelCommand_inherit__map" id="CPSModelCommand_inherit__map">
<area shape="rect" id="node11" href="classCPSCodeTableCommand.html" title="CPSCodeTableCommand" alt="" coords="5,392,184,421"/><area shape="rect" id="node15" href="classPSModelCommand.html" title="PSModelCommand" alt="" coords="208,392,352,421"/><area shape="rect" id="node2" href="classCPSConsoleCommand.html" title="CPSConsoleCommand" alt="" coords="104,237,269,267"/><area shape="rect" id="node4" href="classCPSComponent.html" title="CPSComponent" alt="" coords="125,160,248,189"/><area shape="rect" id="node6" href="interfaceIPSComponent.html" title="IPSComponent" alt="" coords="128,83,245,112"/><area shape="rect" id="node8" href="interfaceIPSBase.html" title="IPSBase" alt="" coords="149,5,224,35"/><area shape="rect" id="node13" href="classPSCodeTableCommand.html" title="PSCodeTableCommand" alt="" coords="9,469,180,499"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for CPSModelCommand:</div>
<div class="dyncontent">
<div class="center"><img src="classCPSModelCommand__coll__graph.png" border="0" usemap="#CPSModelCommand_coll__map" alt="Collaboration graph"/></div>
<map name="CPSModelCommand_coll__map" id="CPSModelCommand_coll__map">
<area shape="rect" id="node2" href="classCPSConsoleCommand.html" title="CPSConsoleCommand" alt="" coords="5,237,171,267"/><area shape="rect" id="node4" href="classCPSComponent.html" title="CPSComponent" alt="" coords="27,160,149,189"/><area shape="rect" id="node6" href="interfaceIPSComponent.html" title="IPSComponent" alt="" coords="29,83,147,112"/><area shape="rect" id="node8" href="interfaceIPSBase.html" title="IPSBase" alt="" coords="51,5,125,35"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCPSModelCommand.html#a4be4055f3361d4800e16bc2e2e38cda6">init</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCPSModelCommand.html#a330e31e8c3572ce01a4e1c8485c6aedd">run</a> ($arArgs)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCPSModelCommand.html#afae31a43a5d0c7b44333eba3cc20f70e">generateModel</a> ($sView, $arParams)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCPSModelCommand.html#a4cc928ef4def3a84c181608d31bf7608">getHelp</a> ()</td></tr>
<tr><td colspan="2"><h2><a name="pub-attribs"></a>
Data Fields</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCPSModelCommand.html#af71005841ce53adac00581ab0ba24c1f">VERSION</a> = '1.0.6'</td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCPSModelCommand.html#a9bc05d24f230cd747c52f296785addf7">getClassName</a> ($sTable)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCPSModelCommand.html#a44e4634608e647ea2224d25ecb599087">isRelationTable</a> ($oTable)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCPSModelCommand.html#a6e265367e1344ab4817a0f31a6025892">generateRelations</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCPSModelCommand.html#af175be165627c37bf50c6332fa2c6fed">generateClassName</a> ($sTable)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCPSModelCommand.html#a89ac3c8019aec5f4b1b91f5e1203ce1c">generateClassNames</a> ($oSchema, $sPattern=null)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCPSModelCommand.html#aa2e3086ca2c90c8a7cd1bd18fc7f39b7">generateRelationName</a> ($sTableName, $sFKName, $bMultiple)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Command that generates a Pogostick Yii Model </p>

<p>Definition at line <a class="el" href="CPSModelCommand_8php_source.html#l00026">26</a> of file <a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="af175be165627c37bf50c6332fa2c6fed"></a><!-- doxytag: member="CPSModelCommand::generateClassName" ref="af175be165627c37bf50c6332fa2c6fed" args="($sTable)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">generateClassName </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>sTable</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Generates model class name based on a table name</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>string</em>&nbsp;</td><td>the table name </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>string the generated model class name </dd></dl>

<p>Reimplemented in <a class="el" href="classCPSCodeTableCommand.html#af175be165627c37bf50c6332fa2c6fed">CPSCodeTableCommand</a>.</p>

<p>Definition at line <a class="el" href="CPSModelCommand_8php_source.html#l00466">466</a> of file <a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a>.</p>

<p><div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">return</span> str_replace( <span class="charliteral">&#39; &#39;</span>, <span class="stringliteral">&#39;&#39;</span>,
            ucwords(
                trim(
                    strtolower(
                        str_replace( <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;_&#39;</span> ), <span class="charliteral">&#39; &#39;</span>,
                            preg_replace( <span class="stringliteral">&#39;/(?&lt;![A-Z])[A-Z]/&#39;</span>, <span class="stringliteral">&#39; \0&#39;</span>, $sTable )
                        )
                    )
                )
            )
        );
    }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a89ac3c8019aec5f4b1b91f5e1203ce1c"></a><!-- doxytag: member="CPSModelCommand::generateClassNames" ref="a89ac3c8019aec5f4b1b91f5e1203ce1c" args="($oSchema, $sPattern=null)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">generateClassNames </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>oSchema</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>sPattern</em> = <code>null</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Generates the mapping table between table names and class names.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>CDbSchema</em>&nbsp;</td><td>the database schema </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>string</em>&nbsp;</td><td>a regular expression that may be used to filter table names </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="classCPSCodeTableCommand.html#a89ac3c8019aec5f4b1b91f5e1203ce1c">CPSCodeTableCommand</a>.</p>

<p>Definition at line <a class="el" href="CPSModelCommand_8php_source.html#l00487">487</a> of file <a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a>.</p>

<p><div class="fragment"><pre class="fragment">    {
        $_arTables = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>();
        
        <span class="keywordflow">foreach</span> ( $oSchema-&gt;getTableNames() as $_sTableName )
        {
            <span class="keywordflow">if</span> ( $sPattern === null ) 
                $_arTables[ $_sTableName ] = $this-&gt;<a class="code" href="classCPSModelCommand.html#af175be165627c37bf50c6332fa2c6fed">generateClassName</a>( $_sTableName );
            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( preg_match( $sPattern, $_sTableName, $_arMatches ) )
            {
                <span class="keywordflow">if</span> ( count( $_arMatches ) &gt; 1 &amp;&amp; ! empty( $_arMatches[ 1 ] ) )
                    $_sClassName = $this-&gt;<a class="code" href="classCPSModelCommand.html#af175be165627c37bf50c6332fa2c6fed">generateClassName</a>( $_arMatches[ 1 ] );
                <span class="keywordflow">else</span>
                    $_sClassName = $this-&gt;<a class="code" href="classCPSModelCommand.html#af175be165627c37bf50c6332fa2c6fed">generateClassName</a>( $_arMatches[ 0 ] );
                    
                $_arTables[ $_sTableName ] = PS::nvl( $_sClassName, $_sTableName );
            }
        }
        
        $this-&gt;tables = $_arTables;
    }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCPSModelCommand_a89ac3c8019aec5f4b1b91f5e1203ce1c_icgraph.png" border="0" usemap="#classCPSModelCommand_a89ac3c8019aec5f4b1b91f5e1203ce1c_icgraph" alt=""/></div>
<map name="classCPSModelCommand_a89ac3c8019aec5f4b1b91f5e1203ce1c_icgraph" id="classCPSModelCommand_a89ac3c8019aec5f4b1b91f5e1203ce1c_icgraph">
<area shape="rect" id="node3" href="classCPSModelCommand.html#a330e31e8c3572ce01a4e1c8485c6aedd" title="run" alt="" coords="213,5,256,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afae31a43a5d0c7b44333eba3cc20f70e"></a><!-- doxytag: member="CPSModelCommand::generateModel" ref="afae31a43a5d0c7b44333eba3cc20f70e" args="($sView, $arParams)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">generateModel </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>sView</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>arParams</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Generate a model</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>string</em>&nbsp;</td><td>$sView </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>array</em>&nbsp;</td><td>$arParams </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>string </dd></dl>

<p>Reimplemented in <a class="el" href="classCPSCodeTableCommand.html#afae31a43a5d0c7b44333eba3cc20f70e">CPSCodeTableCommand</a>.</p>

<p>Definition at line <a class="el" href="CPSModelCommand_8php_source.html#l00209">209</a> of file <a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a>.</p>

<p><div class="fragment"><pre class="fragment">    {
        $_arRules = $_arLabels = $_arRelations = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>();
        list( $_sClassName, $_sTableName, $_sBaseClass, $this-&gt;databaseName ) = $arParams;

        $_sContents = file_get_contents( $sView );

        <span class="comment">//  No table? Try view...</span>
        <span class="keywordflow">if</span> ( null !== ( $_oTable = $this-&gt;schema-&gt;getTable( $_sTableName ) ) )
        {
            $_arRequired = $_arIntegers = $_arNumerical = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>();
            
            <span class="keywordflow">foreach</span> ( $_oTable-&gt;columns as $_oColumn )
            {
                <a class="code" href="gii_2model_2templates_2default_2model_8php.html#a92ae3eac75e60335c146412727e9aa46">$label</a> = ucwords( trim( strtolower( str_replace( <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;_&#39;</span> ), <span class="charliteral">&#39; &#39;</span>, preg_replace( <span class="stringliteral">&#39;/(?&lt;![A-Z])[A-Z]/&#39;</span>, <span class="stringliteral">&#39; \0&#39;</span>, $_oColumn-&gt;name ) ) ) ) );
                <a class="code" href="gii_2model_2templates_2default_2model_8php.html#a92ae3eac75e60335c146412727e9aa46">$label</a> = preg_replace( <span class="stringliteral">&#39;/\s+/&#39;</span>, <span class="charliteral">&#39; &#39;</span>, <a class="code" href="gii_2model_2templates_2default_2model_8php.html#a92ae3eac75e60335c146412727e9aa46">$label</a> );
                
                <span class="keywordflow">if</span> ( strcasecmp( substr( <a class="code" href="gii_2model_2templates_2default_2model_8php.html#a92ae3eac75e60335c146412727e9aa46">$label</a>, -3 ),<span class="stringliteral">&#39; id&#39;</span> ) === 0 ) <a class="code" href="gii_2model_2templates_2default_2model_8php.html#a92ae3eac75e60335c146412727e9aa46">$label</a> = substr( <a class="code" href="gii_2model_2templates_2default_2model_8php.html#a92ae3eac75e60335c146412727e9aa46">$label</a>, 0, -3 );
                $_arLabels[ $_oColumn-&gt;name ] = <a class="code" href="gii_2model_2templates_2default_2model_8php.html#a92ae3eac75e60335c146412727e9aa46">$label</a>;
                
                <span class="keywordflow">if</span> ( $_oColumn-&gt;isPrimaryKey &amp;&amp; $_oTable-&gt;sequenceName !== null || $_oColumn-&gt;isForeignKey )
                    <span class="keywordflow">continue</span>;
                    
                <span class="keywordflow">if</span> ( ! $_oColumn-&gt;allowNull &amp;&amp; $_oColumn-&gt;defaultValue === null ) $_arRequired[] = $_oColumn-&gt;name;
                
                <span class="keywordflow">switch</span> ( $_oColumn-&gt;type )
                {
                    <span class="keywordflow">case</span> <span class="stringliteral">&#39;integer&#39;</span>:
                        $_arIntegers[] = $_oColumn-&gt;name;
                        <span class="keywordflow">break</span>;
                        
                    <span class="keywordflow">case</span> <span class="stringliteral">&#39;double&#39;</span>:
                        $_arNumerical[] = $_oColumn-&gt;name;
                        <span class="keywordflow">break</span>;
                        
                    <span class="keywordflow">case</span> <span class="stringliteral">&#39;string&#39;</span>:
                        <span class="keywordflow">if</span> ( $_oColumn-&gt;size &gt; 0 )
                            $_arRules[] = <span class="stringliteral">&quot;array( &#39;{$_oColumn-&gt;name}&#39;, &#39;length&#39;, &#39;max&#39; =&gt; {$_oColumn-&gt;size} )&quot;</span>;
                         <span class="keywordflow">break</span>;
                }
            }
            
            <span class="keywordflow">if</span> ( $_arRequired !== <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>() ) $_arRules[] = <span class="stringliteral">&quot;array( &#39;&quot;</span> . implode( <span class="stringliteral">&#39;, &#39;</span>, $_arRequired ) . <span class="stringliteral">&quot;&#39;, &#39;required&#39; )&quot;</span>;
            <span class="keywordflow">if</span> ( $_arIntegers !== <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>() ) $_arRules[] = <span class="stringliteral">&quot;array( &#39;&quot;</span> . implode( <span class="stringliteral">&#39;, &#39;</span>, $_arIntegers ) . <span class="stringliteral">&quot;&#39;, &#39;numerical&#39;, &#39;integerOnly&#39; =&gt; true )&quot;</span>;
            <span class="keywordflow">if</span> ( $_arNumerical !== <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>() ) $_arRules[] = <span class="stringliteral">&quot;array( &#39;&quot;</span> . implode( <span class="stringliteral">&#39;, &#39;</span>, $_arNumerical ) . <span class="stringliteral">&quot;&#39;, &#39;numerical&#39; )&quot;</span>;

            <span class="keywordflow">if</span> ( isset( $this-&gt;relations[ $_sClassName ] ) &amp;&amp; is_array( $this-&gt;relations[ $_sClassName ] ) )
                $_arRelations = $this-&gt;relations[ $_sClassName ];
        }
        <span class="keywordflow">else</span>
            $this-&gt;<a class="code" href="classCPSConsoleCommand.html#ada6d688818556d18ca730d6db08126d0">echoString</a>( <span class="stringliteral">&quot;The table \&quot;{$_sTableName}\&quot; cannot be accessed&quot;</span>, <span class="stringliteral">&#39;Warning&#39;</span> );

        <span class="comment">// fall back to default ones</span>
        <span class="keywordflow">if</span> ( ! is_file( $sView ) ) $sView = YII_PATH . <span class="stringliteral">&#39;/cli/views/shell/model/&#39;</span> . basename( $sView );
        
        <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCPSConsoleCommand.html#af9088b5fcf43bd1aafd2f2bccd952dbf">renderFile</a>( $sView, 
            <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
                <span class="stringliteral">&#39;className&#39;</span> =&gt; $_sClassName,
                <span class="stringliteral">&#39;tableName&#39;</span> =&gt; $_sTableName,
                <span class="stringliteral">&#39;baseClass&#39;</span> =&gt; $_sBaseClass,
                <span class="stringliteral">&#39;dbToUse&#39;</span> =&gt; $this-&gt;databaseName,
                <span class="stringliteral">&#39;columns&#39;</span>=&gt; PS::nvl( $_oTable-&gt;columns, <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>() ),
                <span class="stringliteral">&#39;rules&#39;</span> =&gt; $_arRules,
                <span class="stringliteral">&#39;labels&#39;</span> =&gt; $_arLabels,
                <span class="stringliteral">&#39;relations&#39;</span> =&gt; $_arRelations,
            ),
            <span class="keyword">true</span>
        );
    }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCPSModelCommand_afae31a43a5d0c7b44333eba3cc20f70e_cgraph.png" border="0" usemap="#classCPSModelCommand_afae31a43a5d0c7b44333eba3cc20f70e_cgraph" alt=""/></div>
<map name="classCPSModelCommand_afae31a43a5d0c7b44333eba3cc20f70e_cgraph" id="classCPSModelCommand_afae31a43a5d0c7b44333eba3cc20f70e_cgraph">
<area shape="rect" id="node3" href="classCPSConsoleCommand.html#ada6d688818556d18ca730d6db08126d0" title="CPSConsoleCommand::echoString" alt="" coords="173,5,416,35"/><area shape="rect" id="node7" href="classCPSConsoleCommand.html#af9088b5fcf43bd1aafd2f2bccd952dbf" title="CPSConsoleCommand::renderFile" alt="" coords="177,59,412,88"/><area shape="rect" id="node5" href="classCPSConsoleCommand.html#aaa50ba36c35f01c685fd00371b247b35" title="CPSConsoleCommand::bold" alt="" coords="465,5,665,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa2e3086ca2c90c8a7cd1bd18fc7f39b7"></a><!-- doxytag: member="CPSModelCommand::generateRelationName" ref="aa2e3086ca2c90c8a7cd1bd18fc7f39b7" args="($sTableName, $sFKName, $bMultiple)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">generateRelationName </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>sTableName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>sFKName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>bMultiple</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Generate a name for use as a relation name (inside relations() function in a model).</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>string</em>&nbsp;</td><td>the name of the table to hold the relation </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>string</em>&nbsp;</td><td>the foreign key name </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>boolean</em>&nbsp;</td><td>whether the relation would contain multiple objects </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="classCPSCodeTableCommand.html#aa2e3086ca2c90c8a7cd1bd18fc7f39b7">CPSCodeTableCommand</a>.</p>

<p>Definition at line <a class="el" href="CPSModelCommand_8php_source.html#l00516">516</a> of file <a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a>.</p>

<p><div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">if</span> ( strcasecmp( substr( $sFKName, -2 ), <span class="stringliteral">&#39;id&#39;</span> ) === 0 &amp;&amp; strcasecmp( $sFKName, <span class="stringliteral">&#39;id&#39;</span> ) )
            $_sRelationName = rtrim( substr( $sFKName, 0, -2 ), <span class="charliteral">&#39;_&#39;</span> );
        <span class="keywordflow">else</span>
            $_sRelationName = $sFKName;
            
        $_sRelationName[ 0 ] = strtolower( $_sRelationName );

        $_sRawName = $_sRelationName;
        
        <span class="keywordflow">if</span> ( $bMultiple ) $_sRelationName = $this-&gt;<a class="code" href="classCPSConsoleCommand.html#a58127876ddedbfbce1ae272364764aac">pluralize</a>( $_sRelationName );

        $_oTable = $this-&gt;schema-&gt;getTable( $sTableName );
        
        $_i = 0;
        
        <span class="keywordflow">while</span> ( isset( $_oTable-&gt;columns[ $_sRelationName ] ) )
            $_sRelationName = $_sRawName . ( $_i++ );
            
        <span class="keywordflow">return</span> $_sRelationName;
    }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a6e265367e1344ab4817a0f31a6025892"></a><!-- doxytag: member="CPSModelCommand::generateRelations" ref="a6e265367e1344ab4817a0f31a6025892" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">generateRelations </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Generate code to put in ActiveRecord class's relations() function.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>array indexed by table names, each entry contains array of php code to go in appropriate ActiveRecord class. Empty array is returned if database couldn't be connected. </dd></dl>

<p>Reimplemented in <a class="el" href="classCPSCodeTableCommand.html#a6e265367e1344ab4817a0f31a6025892">CPSCodeTableCommand</a>.</p>

<p>Definition at line <a class="el" href="CPSModelCommand_8php_source.html#l00408">408</a> of file <a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a>.</p>

<p><div class="fragment"><pre class="fragment">    {
        $_arRelations = $_arClasses = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>();
        
        <span class="keywordflow">foreach</span> ( $this-&gt;schema-&gt;getTables() as $_oTable )
        {
            $_sTableName = $_oTable-&gt;name;

            <span class="keywordflow">if</span> ( $this-&gt;<a class="code" href="classCPSModelCommand.html#a44e4634608e647ea2224d25ecb599087">isRelationTable</a>( $_oTable ) )
            {
                $_arPK = $_oTable-&gt;primaryKey;
                $_arFK = $_oTable-&gt;foreignKeys;

                $_sTableParent = $_arFK[ $_arPK[ 1 ]][ 0 ];
                $_sTableChild = $_arFK[ $_arPK[ 0 ]][ 0 ];
                
                $_sParentClassName = $this-&gt;<a class="code" href="classCPSModelCommand.html#a9bc05d24f230cd747c52f296785addf7">getClassName</a>( $_sTableParent );
                $_sChildClassName = $this-&gt;<a class="code" href="classCPSModelCommand.html#a9bc05d24f230cd747c52f296785addf7">getClassName</a>( $_sTableChild );

                $_sRelationName = $this-&gt;<a class="code" href="classCPSModelCommand.html#aa2e3086ca2c90c8a7cd1bd18fc7f39b7">generateRelationName</a>( $_sTableParent, $_sTableChild, <span class="keyword">true</span> );
                $_arRelations[ $_sParentClassName ][ $_sRelationName ] = <span class="stringliteral">&quot;array( self::MANY_MANY, &#39;$_sChildClassName&#39;, &#39;$_sTableName( $_arPK[0], $_arPK[1] )&#39; )&quot;</span>;

                $_sRelationName  =$this-&gt;<a class="code" href="classCPSModelCommand.html#aa2e3086ca2c90c8a7cd1bd18fc7f39b7">generateRelationName</a>( $_sTableChild, $_sTableParent, <span class="keyword">true</span> );
                $_arRelations[ $_sChildClassName ][ $_sRelationName ] = <span class="stringliteral">&quot;array( self::MANY_MANY, &#39;$_sParentClassName&#39;, &#39;$_sTableName( $_arPK[0], $_arPK[1] )&#39; )&quot;</span>;
            }
            <span class="keywordflow">else</span>
            {
                $_arClasses[ $_sTableName ] = $_sClassName = $this-&gt;<a class="code" href="classCPSModelCommand.html#a9bc05d24f230cd747c52f296785addf7">getClassName</a>( $_sTableName );
                
                <span class="keywordflow">foreach</span> ( $_oTable-&gt;foreignKeys as $_sFKName =&gt; $_arFKEntry )
                {
                    <span class="comment">//  Put table and key name in variables for easier reading</span>
                    $_sParentTableName = $_arFKEntry[ 0 ]; <span class="comment">// Table name that current fk references to</span>
                    $_sParentTableKey = $_arFKEntry[ 1 ];   <span class="comment">// Key in that table being referenced</span>
                    $_sParentClassName = $this-&gt;<a class="code" href="classCPSModelCommand.html#a9bc05d24f230cd747c52f296785addf7">getClassName</a>( $_sParentTableName );

                    <span class="comment">//  Add relation for this table</span>
                    $_sRelationName = $this-&gt;<a class="code" href="classCPSModelCommand.html#aa2e3086ca2c90c8a7cd1bd18fc7f39b7">generateRelationName</a>( $_sTableName, $_sFKName, <span class="keyword">false</span> );
                    $_arRelations[ $_sClassName ][ $_sRelationName ] = <span class="stringliteral">&quot;array( self::BELONGS_TO, &#39;$_sParentClassName&#39;, &#39;$_sFKName&#39; )&quot;</span>;

                    <span class="comment">//  Add relation for the referenced table</span>
                    $_sRelationType = $_oTable-&gt;primaryKey === $_sFKName ? <span class="stringliteral">&#39;HAS_ONE&#39;</span> : <span class="stringliteral">&#39;HAS_MANY&#39;</span>;
                    $_sRelationName = $this-&gt;<a class="code" href="classCPSModelCommand.html#aa2e3086ca2c90c8a7cd1bd18fc7f39b7">generateRelationName</a>( $_sParentTableName, $_sTableName, $_sRelationType === <span class="stringliteral">&#39;HAS_MANY&#39;</span> );
                    $_arRelations[ $_sParentClassName ][ $_sRelationName ] = <span class="stringliteral">&quot;array( self::$_sRelationType, &#39;$_sClassName&#39;, &#39;$_sFKName&#39; )&quot;</span>;
                }
            }
        }
        
        $this-&gt;relations = $_arRelations;
        $this-&gt;classes = $_arClasses;
    }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCPSModelCommand_a6e265367e1344ab4817a0f31a6025892_icgraph.png" border="0" usemap="#classCPSModelCommand_a6e265367e1344ab4817a0f31a6025892_icgraph" alt=""/></div>
<map name="classCPSModelCommand_a6e265367e1344ab4817a0f31a6025892_icgraph" id="classCPSModelCommand_a6e265367e1344ab4817a0f31a6025892_icgraph">
<area shape="rect" id="node3" href="classCPSModelCommand.html#a330e31e8c3572ce01a4e1c8485c6aedd" title="run" alt="" coords="192,5,235,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9bc05d24f230cd747c52f296785addf7"></a><!-- doxytag: member="CPSModelCommand::getClassName" ref="a9bc05d24f230cd747c52f296785addf7" args="($sTable)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getClassName </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>sTable</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Gets the name of class given a table name</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>string</em>&nbsp;</td><td>$sTable </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented in <a class="el" href="classCPSCodeTableCommand.html#a9bc05d24f230cd747c52f296785addf7">CPSCodeTableCommand</a>.</p>

<p>Definition at line <a class="el" href="CPSModelCommand_8php_source.html#l00379">379</a> of file <a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a>.</p>

<p><div class="fragment"><pre class="fragment">    {
        <span class="keywordflow">return</span> PS::nvl( $this-&gt;tables[ $sTable ], $this-&gt;<a class="code" href="classCPSModelCommand.html#af175be165627c37bf50c6332fa2c6fed">generateClassName</a>( $sTable ) );
    }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a4cc928ef4def3a84c181608d31bf7608"></a><!-- doxytag: member="CPSModelCommand::getHelp" ref="a4cc928ef4def3a84c181608d31bf7608" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getHelp </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Shows the usage </p>

<p>Reimplemented from <a class="el" href="classCPSConsoleCommand.html#a4cc928ef4def3a84c181608d31bf7608">CPSConsoleCommand</a>.</p>

<p>Reimplemented in <a class="el" href="classCPSCodeTableCommand.html#a4cc928ef4def3a84c181608d31bf7608">CPSCodeTableCommand</a>.</p>

<p>Definition at line <a class="el" href="CPSModelCommand_8php_source.html#l00283">283</a> of file <a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a>.</p>

<p><div class="fragment"><pre class="fragment">    {
        $_sName = $this-&gt;<a class="code" href="classCPSConsoleCommand.html#aaa50ba36c35f01c685fd00371b247b35">bold</a>( $this-&gt;name );
        $_sOptions = $this-&gt;<a class="code" href="classCPSConsoleCommand.html#abf0b96b21351ca3f777c8d6c78535ffe">getDisplayOptions</a>();
        
        <span class="keywordflow">return</span> &lt;&lt;&lt;EOD
USAGE
    \033[1mpsmodel\033[0m &lt;\033[1mclass-name\033[0m&gt; [\033[1mtable-name\033[0m] [options]
    
This command generates a model <span class="keyword">class </span>with the specified class name.

PARAMETERS
 * <span class="keyword">class</span>-name: required, model <span class="keyword">class </span>name. By default, the generated
   model class file will be placed under the directory aliased as
   &#39;application.models&#39;. To override this default, specify the class
   name in terms of a path alias, e.g., &#39;application.somewhere.ClassName&#39;.

   If the model class belongs to a module, it should be specified
   as &#39;ModuleID.models.ClassName&#39;.

   If the class name ends with &#39;*<span class="stringliteral">&#39;, then a model class will be generated</span>
<span class="stringliteral">   for EVERY table in the database.</span>
<span class="stringliteral"></span>
<span class="stringliteral">   If the class name contains a regular expression deliminated by slashes,</span>
<span class="stringliteral">   then a model class will be generated for those tables whose name</span>
<span class="stringliteral">   matches the regular expression. If the regular expression contains</span>
<span class="stringliteral">   sub-patterns, the first sub-pattern will be used to generate the model</span>
<span class="stringliteral">   class name.</span>
<span class="stringliteral"></span>
<span class="stringliteral"> * table-name: optional, the associated database table name. If not given,</span>
<span class="stringliteral">   it is assumed to be the model class name.</span>
<span class="stringliteral"></span>
<span class="stringliteral">   Note, when the class name ends with &#39;</span>*<span class="stringliteral">&#39;, this parameter will be</span>
<span class="stringliteral">   ignored.</span>
<span class="stringliteral"></span>
<span class="stringliteral">OPTIONS</span>
<span class="stringliteral"></span>
<span class="stringliteral">  -f, --force                  if the model class exists, you will be able to </span>
<span class="stringliteral">                                   optionally overwrite it.</span>
<span class="stringliteral">                                   </span>
<span class="stringliteral">  -d, --database               The database component to use. </span>
<span class="stringliteral">                                   Defaults to &#39;</span>db<span class="stringliteral">&#39;</span>
<span class="stringliteral">                                   </span>
<span class="stringliteral">  -b, --base-class             The base class to use for generated models. </span>
<span class="stringliteral">                                   Defaults to &#39;</span><a class="code" href="classCPSModel.html">CPSModel</a><span class="stringliteral">&#39;</span>
<span class="stringliteral">                                   </span>
<span class="stringliteral">  -n, --template-name          The name of the template to use. </span>
<span class="stringliteral">                                   Defaults to &#39;</span>model.php<span class="stringliteral">&#39;</span>
<span class="stringliteral">                                   </span>
<span class="stringliteral">  -t, --template-path          The template path to use.</span>
<span class="stringliteral"></span>
<span class="stringliteral">{$_sOptions}</span>
<span class="stringliteral">EXAMPLES</span>
<span class="stringliteral"> * Generates the Post model:</span>
<span class="stringliteral">        {$_sName} Post</span>
<span class="stringliteral"></span>
<span class="stringliteral"> * Generates the Post model using component db_posts:</span>
<span class="stringliteral">        {$_sName} Post -d=db_posts</span>
<span class="stringliteral"></span>
<span class="stringliteral"> * Generates the Post model which is associated with table &#39;</span>posts<span class="stringliteral">&#39;:</span>
<span class="stringliteral">        {$_sName} Post posts</span>
<span class="stringliteral"></span>
<span class="stringliteral"> * Generates the Post model which should belong to module &#39;</span>admin<span class="stringliteral">&#39;:</span>
<span class="stringliteral">        {$_sName} admin.models.Post</span>
<span class="stringliteral"></span>
<span class="stringliteral"> * Generates a model class for every table in the current database:</span>
<span class="stringliteral">        {$_sName} *</span>
<span class="stringliteral"></span>
<span class="stringliteral"> * Generates a model class for every table based on CSubClass:</span>
<span class="stringliteral">        {$_sName} * -b=CSubClass</span>
<span class="stringliteral"></span>
<span class="stringliteral"> * Same as above, but the model class files should be generated</span>
<span class="stringliteral">   under &#39;</span><span class="keyword">protected</span>/models2<span class="stringliteral">&#39;:</span>
<span class="stringliteral">        {$_sName} application.models2.*</span>
<span class="stringliteral"></span>
<span class="stringliteral"> * Generates a model class for every table whose name is prefixed</span>
<span class="stringliteral">   with &#39;</span>tbl_<span class="stringliteral">&#39; in the current database. The model class will not</span>
<span class="stringliteral">   contain the table prefix.</span>
<span class="stringliteral">        {$_sName} /^tbl_(.*)$/</span>
<span class="stringliteral"></span>
<span class="stringliteral"> * Same as above, but the model class files should be generated</span>
<span class="stringliteral">   under &#39;</span><span class="keyword">protected</span>/models2<span class="stringliteral">&#39;:</span>
<span class="stringliteral">        {$_sName} application.models2./^tbl_(.*)$/</span>
<span class="stringliteral"></span>
<span class="stringliteral">EOD;</span>
<span class="stringliteral">    }</span>
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCPSModelCommand_a4cc928ef4def3a84c181608d31bf7608_cgraph.png" border="0" usemap="#classCPSModelCommand_a4cc928ef4def3a84c181608d31bf7608_cgraph" alt=""/></div>
<map name="classCPSModelCommand_a4cc928ef4def3a84c181608d31bf7608_cgraph" id="classCPSModelCommand_a4cc928ef4def3a84c181608d31bf7608_cgraph">
<area shape="rect" id="node3" href="classCPSConsoleCommand.html#aaa50ba36c35f01c685fd00371b247b35" title="CPSConsoleCommand::bold" alt="" coords="171,5,371,35"/><area shape="rect" id="node5" href="classCPSConsoleCommand.html#abf0b96b21351ca3f777c8d6c78535ffe" title="CPSConsoleCommand::getDisplayOptions" alt="" coords="125,59,416,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCPSModelCommand_a4cc928ef4def3a84c181608d31bf7608_icgraph.png" border="0" usemap="#classCPSModelCommand_a4cc928ef4def3a84c181608d31bf7608_icgraph" alt=""/></div>
<map name="classCPSModelCommand_a4cc928ef4def3a84c181608d31bf7608_icgraph" id="classCPSModelCommand_a4cc928ef4def3a84c181608d31bf7608_icgraph">
<area shape="rect" id="node3" href="classCPSModelCommand.html#a330e31e8c3572ce01a4e1c8485c6aedd" title="run" alt="" coords="125,5,168,35"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a4be4055f3361d4800e16bc2e2e38cda6"></a><!-- doxytag: member="CPSModelCommand::init" ref="a4be4055f3361d4800e16bc2e2e38cda6" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">init </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Initialize the command </p>

<p>Reimplemented from <a class="el" href="classCPSConsoleCommand.html#a4be4055f3361d4800e16bc2e2e38cda6">CPSConsoleCommand</a>.</p>

<p>Reimplemented in <a class="el" href="classCPSCodeTableCommand.html#a4be4055f3361d4800e16bc2e2e38cda6">CPSCodeTableCommand</a>.</p>

<p>Definition at line <a class="el" href="CPSModelCommand_8php_source.html#l00045">45</a> of file <a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a>.</p>

<p><div class="fragment"><pre class="fragment">    {
        <a class="code" href="classCPSModelCommand.html#a4be4055f3361d4800e16bc2e2e38cda6">parent::init</a>();
        
        <span class="comment">//  Add our options</span>
        $this-&gt;addOptions( self::getBaseOptions() );

        <span class="comment">//  Set base values</span>
        $this-&gt;baseClass = <span class="stringliteral">&#39;CPSModel&#39;</span>;
        $this-&gt;templatePath = Yii::getPathOfAlias( <span class="stringliteral">&#39;pogostick.templates&#39;</span> );
        $this-&gt;templateName = <span class="stringliteral">&#39;model.php&#39;</span>;
<span class="comment">//      $this-&gt;name = &#39;psmodel&#39;;</span>
    }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a44e4634608e647ea2224d25ecb599087"></a><!-- doxytag: member="CPSModelCommand::isRelationTable" ref="a44e4634608e647ea2224d25ecb599087" args="($oTable)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">isRelationTable </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>oTable</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Checks if the given table is a "many to many" helper table.</p>
<p>Their PK has 2 fields, and both of those fields are also FK to other separate tables.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>CDbTableSchema</em>&nbsp;</td><td>table to inspect </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>boolean true if table matches description of helpter table. </dd></dl>

<p>Reimplemented in <a class="el" href="classCPSCodeTableCommand.html#a44e4634608e647ea2224d25ecb599087">CPSCodeTableCommand</a>.</p>

<p>Definition at line <a class="el" href="CPSModelCommand_8php_source.html#l00392">392</a> of file <a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a>.</p>

<p><div class="fragment"><pre class="fragment">    {
        $_sPK = $oTable-&gt;primaryKey;
        
        <span class="keywordflow">return</span> ( count( $_sPK ) === 2 <span class="comment">// we want 2 columns</span>
            &amp;&amp; isset( $oTable-&gt;foreignKeys[ $_sPK[ 0 ] ], $oTable-&gt;foreignKeys[ $_sPK[ 1 ] ] )  <span class="comment">// Both PKs there...</span>
            &amp;&amp; $oTable-&gt;foreignKeys[ $_sPK[ 0 ] ][ 0 ] !== $oTable-&gt;foreignKeys[ $_sPK[ 1 ]][ 0 ] ); <span class="comment">// and the foreign keys point different tables</span>
    }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a330e31e8c3572ce01a4e1c8485c6aedd"></a><!-- doxytag: member="CPSModelCommand::run" ref="a330e31e8c3572ce01a4e1c8485c6aedd" args="($arArgs)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">run </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>arArgs</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Execute the action. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>array</em>&nbsp;</td><td>$arArgs command line parameters specific for this command </td></tr>
  </table>
  </dd>
</dl>

<p>Reimplemented from <a class="el" href="classCPSConsoleCommand.html#acd971ca71798c549bd4f74ed4ee6729e">CPSConsoleCommand</a>.</p>

<p>Reimplemented in <a class="el" href="classCPSCodeTableCommand.html#a330e31e8c3572ce01a4e1c8485c6aedd">CPSCodeTableCommand</a>.</p>

<p>Definition at line <a class="el" href="CPSModelCommand_8php_source.html#l00063">63</a> of file <a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a>.</p>

<p><div class="fragment"><pre class="fragment">    {
        <span class="comment">//  Our base path...</span>
        $_sBasePath = Yii::getPathOfAlias( <span class="stringliteral">&#39;application.models&#39;</span> );
        
        <span class="comment">//  Process arguments...</span>
        $arArgs = $this-&gt;<a class="code" href="classCPSConsoleCommand.html#a886e39444aaa31abaf173a819b4be205">processArguments</a>( $arArgs );
        
        <span class="comment">//  Check args...</span>
        <span class="keywordflow">if</span> ( ! ( $_sClassName = PS::o( $arArgs, 0, null ) ) )
        {
            echo <span class="stringliteral">&quot;\033[1mError\033[0m: model class name is required.\n&quot;</span>;
            echo $this-&gt;<a class="code" href="classCPSModelCommand.html#a4cc928ef4def3a84c181608d31bf7608">getHelp</a>();
            <span class="keywordflow">return</span>;
        }

        <span class="comment">//  Process the model name...</span>
        <span class="keywordflow">if</span> ( ! preg_match(<span class="stringliteral">&#39;/^[\w\.\-\*]*(.*?)$/&#39;</span>, $_sClassName, $_arMatches ) )
        {
            echo <span class="stringliteral">&quot;\033[1mError\033[0m: model class \&quot;&quot;</span> . $_sClassName . <span class="stringliteral">&quot;\&quot; is invalid.\n&quot;</span>;
            <span class="keywordflow">return</span>;
        }

        <span class="comment">//  Get database set up</span>
        <span class="keywordflow">if</span> ( ! $this-&gt;<a class="code" href="classCPSConsoleCommand.html#a1cad0fdd11c50e747a10b8b23556e596">getDbConnection</a>() )
            <span class="keywordflow">return</span>;

        <span class="comment">//  Without regular expressions</span>
        <span class="keywordflow">if</span> ( empty( $_arMatches[ 1 ] ) )
        {
            $this-&gt;<a class="code" href="classCPSModelCommand.html#a89ac3c8019aec5f4b1b91f5e1203ce1c">generateClassNames</a>( $this-&gt;schema );
            
            <span class="keywordflow">if</span> ( ( $_iPos = strrpos( $_sClassName, <span class="charliteral">&#39;.&#39;</span> ) ) !== <span class="keyword">false</span> )
            {
                <span class="comment">//  i.e. module.models.* becomes base=module.models, class=*</span>
                $_sBasePath = Yii::getPathOfAlias( substr( $_sClassName, 0, $_iPos ) );
                $_sClassName = substr( $_sClassName, $_iPos + 1 );
            }

            <span class="comment">//  Generate all models</span>
            <span class="keywordflow">if</span> ( $_sClassName == <span class="charliteral">&#39;*&#39;</span> ) 
                $this-&gt;<a class="code" href="classCPSModelCommand.html#a6e265367e1344ab4817a0f31a6025892">generateRelations</a>();
            <span class="keywordflow">else</span>
            {
                $_sTableName = PS::nvl( $arArgs[ 1 ], $_sClassName );
                $_arTables = $this-&gt;tables;
                $_arTables[ $_sTableName ] = $_sClassName;
                $this-&gt;tables = $_arTables;
                $this-&gt;<a class="code" href="classCPSModelCommand.html#a6e265367e1344ab4817a0f31a6025892">generateRelations</a>();
                $this-&gt;classes = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( $_sTableName =&gt; $_sClassName );
            }
        }
        <span class="keywordflow">else</span>  <span class="comment">// with regular expressions</span>
        {
            $_sPattern = $_arMatches[ 1 ];
            
            <span class="keywordflow">if</span> ( <span class="keyword">false</span> !== ( $_iPos = strrpos( $_sClassFile, $_sPattern ) ) )
                $_sBasePath = Yii::getPathOfAlias( rtrim( substr( $_sClassName, 0, $_iPos ), <span class="charliteral">&#39;.&#39;</span> ) );
            <span class="keywordflow">else</span>
                $_sBasePath = Yii::getPathOfAlias( <span class="stringliteral">&#39;application.models&#39;</span> );
            
            <span class="comment">// only regexp is given</span>
            $this-&gt;<a class="code" href="classCPSModelCommand.html#a89ac3c8019aec5f4b1b91f5e1203ce1c">generateClassNames</a>( $this-&gt;schema, $_sPattern );
            $_arClasses = $this-&gt;tables;
            $this-&gt;<a class="code" href="classCPSModelCommand.html#a6e265367e1344ab4817a0f31a6025892">generateRelations</a>();
            $this-&gt;classes = $_arClasses;
        }

        $this-&gt;<a class="code" href="classCPSConsoleCommand.html#a243b35d1b1d2d43971e40d1382536c31">displayParameters</a>( <span class="stringliteral">&#39;Model Generator&#39;</span>, <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( <span class="stringliteral">&#39;Output Path&#39;</span> =&gt; $_sBasePath ) );
            
        <span class="keywordflow">if</span> ( count( $this-&gt;classes ) &gt; 1 )
        {
            $_i = 1;
            
            echo <span class="stringliteral">&quot;\nModel classes matching your criteria:\n&quot;</span>;
            echo <span class="stringliteral">&quot;============================================================\n\n&quot;</span>;
            
            <span class="keywordflow">foreach</span> ( $this-&gt;classes as $_sTableName =&gt; $_sClassName )
                echo <span class="stringliteral">&quot;    &quot;</span> . ( $_i++ ) . <span class="stringliteral">&quot;. &quot;</span> . $this-&gt;<a class="code" href="classCPSConsoleCommand.html#aaa50ba36c35f01c685fd00371b247b35">bold</a>( $_sClassName ) . <span class="stringliteral">&quot; ({$_sTableName})\n&quot;</span>;
            
            $_sPrompt = <span class="stringliteral">&quot;\nDo you want to generate these classes? [\033[1mY\033[0mes|\033[1mN\033[0mo] &quot;</span>;
            
            <span class="keywordflow">while</span> ( $_sPrompt )
            {
                echo <span class="stringliteral">&quot;$_sPrompt&quot;</span>;
                
                <span class="keywordflow">switch</span> ( substr( strtolower( trim( fgets( STDIN ) ) ), 0, 1 ) )
                {
                    <span class="keywordflow">case</span> <span class="charliteral">&#39;y&#39;</span>:
                        <span class="comment">//  We got the answer we want!</span>
                        <span class="keywordflow">break</span> 2;
                        
                    <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:
                    <span class="keywordflow">case</span> <span class="charliteral">&#39;q&#39;</span>:
                        <span class="keywordflow">return</span>;
                }
            }
            
            echo <span class="stringliteral">&quot;\n&quot;</span>;
        }

        $_arParams = $_arFiles = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>();
        $_arClasses = $this-&gt;classes;
        $_sModelTemplate = $this-&gt;templatePath . DIRECTORY_SEPARATOR . $this-&gt;templateName;
        
        <span class="keywordflow">foreach</span> ( $this-&gt;classes as $_sTableName =&gt; $_sClassName )
        {
            $_sClassFile = $_sBasePath . DIRECTORY_SEPARATOR . $_sClassName . <span class="stringliteral">&#39;.php&#39;</span>;
            
            $_arParams[ $_sClassName . <span class="stringliteral">&#39;.php&#39;</span> ] = <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>(
                <span class="stringliteral">&#39;source&#39;</span> =&gt; $_sModelTemplate,
                <span class="stringliteral">&#39;target&#39;</span> =&gt; $_sClassFile,
                <span class="stringliteral">&#39;callback&#39;</span> =&gt; <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( $this, <span class="stringliteral">&#39;generateModel&#39;</span> ),
                <span class="stringliteral">&#39;params&#39;</span> =&gt; <a class="code" href="admin_8php.html#a2394bd91cde70158acb50a4a7f860ab5">array</a>( $_sClassName, $_sTableName, $this-&gt;baseClass, $this-&gt;databaseName ),
            );

            <span class="keywordflow">if</span> ( strlen( $_sClassName ) &gt; $this-&gt;colWidth ) $this-&gt;colWidth = strlen( $_sClassName );
        }

        <span class="comment">//  Load them all up</span>
        $_arParams = $this-&gt;<a class="code" href="classCPSConsoleCommand.html#af999d4abb0f04b22df2e4c8b6084d942">copyFiles</a>( $_arParams );
        
        echo $this-&gt;<a class="code" href="classCPSConsoleCommand.html#a330ea7ca53549b94a76544ae38e7e538">getResultDisplay</a>( $_arParams, <span class="keyword">true</span>, $_iGen );

        <span class="keywordflow">if</span> ( $_iGen )
        {
            echo &lt;&lt;&lt;EOD
============================================================

If you have a <span class="stringliteral">&#39;{$this-&gt;databaseName}&#39;</span> database connection, you 
may test any generated models now with the following commands:

    \$_oModel = {$_sClassName}::model()-&gt;find();
    print_r( \$_oModel );

EOD;
        }
    }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCPSModelCommand_a330e31e8c3572ce01a4e1c8485c6aedd_cgraph.png" border="0" usemap="#classCPSModelCommand_a330e31e8c3572ce01a4e1c8485c6aedd_cgraph" alt=""/></div>
<map name="classCPSModelCommand_a330e31e8c3572ce01a4e1c8485c6aedd_cgraph" id="classCPSModelCommand_a330e31e8c3572ce01a4e1c8485c6aedd_cgraph">
<area shape="rect" id="node3" href="classCPSConsoleCommand.html#aaa50ba36c35f01c685fd00371b247b35" title="CPSConsoleCommand::bold" alt="" coords="1391,158,1591,188"/><area shape="rect" id="node5" href="classCPSConsoleCommand.html#af999d4abb0f04b22df2e4c8b6084d942" title="CPSConsoleCommand::copyFiles" alt="" coords="129,82,359,112"/><area shape="rect" id="node16" href="classCPSConsoleCommand.html#a243b35d1b1d2d43971e40d1382536c31" title="CPSConsoleCommand::displayParameters" alt="" coords="99,136,389,165"/><area shape="rect" id="node18" href="classCPSModelCommand.html#a89ac3c8019aec5f4b1b91f5e1203ce1c" title="generateClassNames" alt="" coords="164,189,324,218"/><area shape="rect" id="node20" href="classCPSModelCommand.html#a6e265367e1344ab4817a0f31a6025892" title="generateRelations" alt="" coords="176,242,312,272"/><area shape="rect" id="node22" href="classCPSConsoleCommand.html#a1cad0fdd11c50e747a10b8b23556e596" title="CPSConsoleCommand::getDbConnection" alt="" coords="101,296,387,325"/><area shape="rect" id="node24" href="classCPSModelCommand.html#a4cc928ef4def3a84c181608d31bf7608" title="getHelp" alt="" coords="208,349,280,378"/><area shape="rect" id="node29" href="classCPSConsoleCommand.html#a330ea7ca53549b94a76544ae38e7e538" title="CPSConsoleCommand::getResultDisplay" alt="" coords="105,402,383,432"/><area shape="rect" id="node31" href="classCPSConsoleCommand.html#a886e39444aaa31abaf173a819b4be205" title="CPSConsoleCommand::processArguments" alt="" coords="97,456,391,485"/><area shape="rect" id="node7" href="classCPSConsoleCommand.html#a6a11a38d5810015be61ef7984ab418eb" title="CPSConsoleCommand::boldEchoString" alt="" coords="780,133,1049,162"/><area shape="rect" id="node9" href="classCPSConsoleCommand.html#ada6d688818556d18ca730d6db08126d0" title="CPSConsoleCommand::echoString" alt="" coords="1099,158,1341,188"/><area shape="rect" id="node13" href="classCPSConsoleCommand.html#abb9234be873ca733205fa23f41ce37b5" title="CPSConsoleCommand::ensureDirectory" alt="" coords="448,133,723,162"/><area shape="rect" id="node27" href="classCPSConsoleCommand.html#abf0b96b21351ca3f777c8d6c78535ffe" title="CPSConsoleCommand::getDisplayOptions" alt="" coords="440,349,731,378"/><area shape="rect" id="node33" href="classCPSTransform.html#a47574be513de930ec832fce1062dd033" title="CPSTransform::underscorize" alt="" coords="485,456,685,485"/></map>
</div>
</p>

</div>
</div>
<hr/><h2>Field Documentation</h2>
<a class="anchor" id="af71005841ce53adac00581ab0ba24c1f"></a><!-- doxytag: member="CPSModelCommand::VERSION" ref="af71005841ce53adac00581ab0ba24c1f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classCPSModelCommand.html#af71005841ce53adac00581ab0ba24c1f">VERSION</a> = '1.0.6'</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Our version </p>

<p>Reimplemented from <a class="el" href="classCPSConsoleCommand.html#af71005841ce53adac00581ab0ba24c1f">CPSConsoleCommand</a>.</p>

<p>Reimplemented in <a class="el" href="classCPSCodeTableCommand.html#af71005841ce53adac00581ab0ba24c1f">CPSCodeTableCommand</a>.</p>

<p>Definition at line <a class="el" href="CPSModelCommand_8php_source.html#l00035">35</a> of file <a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>/usr/local/yiixl/lib/original/commands/<a class="el" href="CPSModelCommand_8php_source.html">CPSModelCommand.php</a></li>
</ul>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Thu Mar 24 2011 20:11:41 for "The Yii Extension Library Of Doom!" by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
